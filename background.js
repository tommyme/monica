"use strict";(()=>{var ov=Object.create;var Vs=Object.defineProperty;var av=Object.getOwnPropertyDescriptor;var uv=Object.getOwnPropertyNames;var cv=Object.getPrototypeOf,lv=Object.prototype.hasOwnProperty;var pv=(u,r,s)=>r in u?Vs(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s;var dr=(u,r)=>()=>(r||u((r={exports:{}}).exports,r),r.exports);var dv=(u,r,s,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let p of uv(r))!lv.call(u,p)&&p!==s&&Vs(u,p,{get:()=>r[p],enumerable:!(a=av(r,p))||a.enumerable});return u};var b=(u,r,s)=>(s=u!=null?ov(cv(u)):{},dv(r||!u||!u.__esModule?Vs(s,"default",{value:u,enumerable:!0}):s,u));var nt=(u,r,s)=>(pv(u,typeof r!="symbol"?r+"":r,s),s);var I=dr(()=>{"use strict";globalThis&&(globalThis.__aichat_envvars__={dev:!1,prod:!0,host:"https://monica.im",project:"monica"})});var ec=dr((Qs,zs)=>{var Lv=b(I());(function(u,r){typeof Qs=="object"&&typeof zs<"u"?zs.exports=r():typeof define=="function"&&define.amd?define(r):(u=typeof globalThis<"u"?globalThis:u||self).dayjs=r()})(Qs,function(){"use strict";var u=1e3,r=6e4,s=36e5,a="millisecond",p="second",g="minute",C="hour",x="day",T="week",D="month",$="quarter",O="year",y="date",v="Invalid Date",P=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,F=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,H={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(q){var G=["th","st","nd","rd"],E=q%100;return"["+q+(G[(E-20)%10]||G[E]||G[0])+"]"}},N=function(q,G,E){var U=String(q);return!U||U.length>=G?q:""+Array(G+1-U.length).join(E)+q},Q={s:N,z:function(q){var G=-q.utcOffset(),E=Math.abs(G),U=Math.floor(E/60),R=E%60;return(G<=0?"+":"-")+N(U,2,"0")+":"+N(R,2,"0")},m:function q(G,E){if(G.date()<E.date())return-q(E,G);var U=12*(E.year()-G.year())+(E.month()-G.month()),R=G.clone().add(U,D),J=E-R<0,re=G.clone().add(U+(J?-1:1),D);return+(-(U+(E-R)/(J?R-re:re-R))||0)},a:function(q){return q<0?Math.ceil(q)||0:Math.floor(q)},p:function(q){return{M:D,y:O,w:T,d:x,D:y,h:C,m:g,s:p,ms:a,Q:$}[q]||String(q||"").toLowerCase().replace(/s$/,"")},u:function(q){return q===void 0}},j="en",k={};k[j]=H;var L=function(q){return q instanceof W},V=function q(G,E,U){var R;if(!G)return j;if(typeof G=="string"){var J=G.toLowerCase();k[J]&&(R=J),E&&(k[J]=E,R=J);var re=G.split("-");if(!R&&re.length>1)return q(re[0])}else{var he=G.name;k[he]=G,R=he}return!U&&R&&(j=R),R||!U&&j},K=function(q,G){if(L(q))return q.clone();var E=typeof G=="object"?G:{};return E.date=q,E.args=arguments,new W(E)},Y=Q;Y.l=V,Y.i=L,Y.w=function(q,G){return K(q,{locale:G.$L,utc:G.$u,x:G.$x,$offset:G.$offset})};var W=function(){function q(E){this.$L=V(E.locale,null,!0),this.parse(E)}var G=q.prototype;return G.parse=function(E){this.$d=function(U){var R=U.date,J=U.utc;if(R===null)return new Date(NaN);if(Y.u(R))return new Date;if(R instanceof Date)return new Date(R);if(typeof R=="string"&&!/Z$/i.test(R)){var re=R.match(P);if(re){var he=re[2]-1||0,ve=(re[7]||"0").substring(0,3);return J?new Date(Date.UTC(re[1],he,re[3]||1,re[4]||0,re[5]||0,re[6]||0,ve)):new Date(re[1],he,re[3]||1,re[4]||0,re[5]||0,re[6]||0,ve)}}return new Date(R)}(E),this.$x=E.x||{},this.init()},G.init=function(){var E=this.$d;this.$y=E.getFullYear(),this.$M=E.getMonth(),this.$D=E.getDate(),this.$W=E.getDay(),this.$H=E.getHours(),this.$m=E.getMinutes(),this.$s=E.getSeconds(),this.$ms=E.getMilliseconds()},G.$utils=function(){return Y},G.isValid=function(){return this.$d.toString()!==v},G.isSame=function(E,U){var R=K(E);return this.startOf(U)<=R&&R<=this.endOf(U)},G.isAfter=function(E,U){return K(E)<this.startOf(U)},G.isBefore=function(E,U){return this.endOf(U)<K(E)},G.$g=function(E,U,R){return Y.u(E)?this[U]:this.set(R,E)},G.unix=function(){return Math.floor(this.valueOf()/1e3)},G.valueOf=function(){return this.$d.getTime()},G.startOf=function(E,U){var R=this,J=!!Y.u(U)||U,re=Y.p(E),he=function(pt,Me){var It=Y.w(R.$u?Date.UTC(R.$y,Me,pt):new Date(R.$y,Me,pt),R);return J?It:It.endOf(x)},ve=function(pt,Me){return Y.w(R.toDate()[pt].apply(R.toDate("s"),(J?[0,0,0,0]:[23,59,59,999]).slice(Me)),R)},Ae=this.$W,Ue=this.$M,wt=this.$D,Be="set"+(this.$u?"UTC":"");switch(re){case O:return J?he(1,0):he(31,11);case D:return J?he(1,Ue):he(0,Ue+1);case T:var kt=this.$locale().weekStart||0,pn=(Ae<kt?Ae+7:Ae)-kt;return he(J?wt-pn:wt+(6-pn),Ue);case x:case y:return ve(Be+"Hours",0);case C:return ve(Be+"Minutes",1);case g:return ve(Be+"Seconds",2);case p:return ve(Be+"Milliseconds",3);default:return this.clone()}},G.endOf=function(E){return this.startOf(E,!1)},G.$set=function(E,U){var R,J=Y.p(E),re="set"+(this.$u?"UTC":""),he=(R={},R[x]=re+"Date",R[y]=re+"Date",R[D]=re+"Month",R[O]=re+"FullYear",R[C]=re+"Hours",R[g]=re+"Minutes",R[p]=re+"Seconds",R[a]=re+"Milliseconds",R)[J],ve=J===x?this.$D+(U-this.$W):U;if(J===D||J===O){var Ae=this.clone().set(y,1);Ae.$d[he](ve),Ae.init(),this.$d=Ae.set(y,Math.min(this.$D,Ae.daysInMonth())).$d}else he&&this.$d[he](ve);return this.init(),this},G.set=function(E,U){return this.clone().$set(E,U)},G.get=function(E){return this[Y.p(E)]()},G.add=function(E,U){var R,J=this;E=Number(E);var re=Y.p(U),he=function(Ue){var wt=K(J);return Y.w(wt.date(wt.date()+Math.round(Ue*E)),J)};if(re===D)return this.set(D,this.$M+E);if(re===O)return this.set(O,this.$y+E);if(re===x)return he(1);if(re===T)return he(7);var ve=(R={},R[g]=r,R[C]=s,R[p]=u,R)[re]||1,Ae=this.$d.getTime()+E*ve;return Y.w(Ae,this)},G.subtract=function(E,U){return this.add(-1*E,U)},G.format=function(E){var U=this,R=this.$locale();if(!this.isValid())return R.invalidDate||v;var J=E||"YYYY-MM-DDTHH:mm:ssZ",re=Y.z(this),he=this.$H,ve=this.$m,Ae=this.$M,Ue=R.weekdays,wt=R.months,Be=function(Me,It,Yt,Mt){return Me&&(Me[It]||Me(U,J))||Yt[It].slice(0,Mt)},kt=function(Me){return Y.s(he%12||12,Me,"0")},pn=R.meridiem||function(Me,It,Yt){var Mt=Me<12?"AM":"PM";return Yt?Mt.toLowerCase():Mt},pt={YY:String(this.$y).slice(-2),YYYY:this.$y,M:Ae+1,MM:Y.s(Ae+1,2,"0"),MMM:Be(R.monthsShort,Ae,wt,3),MMMM:Be(wt,Ae),D:this.$D,DD:Y.s(this.$D,2,"0"),d:String(this.$W),dd:Be(R.weekdaysMin,this.$W,Ue,2),ddd:Be(R.weekdaysShort,this.$W,Ue,3),dddd:Ue[this.$W],H:String(he),HH:Y.s(he,2,"0"),h:kt(1),hh:kt(2),a:pn(he,ve,!0),A:pn(he,ve,!1),m:String(ve),mm:Y.s(ve,2,"0"),s:String(this.$s),ss:Y.s(this.$s,2,"0"),SSS:Y.s(this.$ms,3,"0"),Z:re};return J.replace(F,function(Me,It){return It||pt[Me]||re.replace(":","")})},G.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},G.diff=function(E,U,R){var J,re=Y.p(U),he=K(E),ve=(he.utcOffset()-this.utcOffset())*r,Ae=this-he,Ue=Y.m(this,he);return Ue=(J={},J[O]=Ue/12,J[D]=Ue,J[$]=Ue/3,J[T]=(Ae-ve)/6048e5,J[x]=(Ae-ve)/864e5,J[C]=Ae/s,J[g]=Ae/r,J[p]=Ae/u,J)[re]||Ae,R?Ue:Y.a(Ue)},G.daysInMonth=function(){return this.endOf(D).$D},G.$locale=function(){return k[this.$L]},G.locale=function(E,U){if(!E)return this.$L;var R=this.clone(),J=V(E,U,!0);return J&&(R.$L=J),R},G.clone=function(){return Y.w(this.$d,this)},G.toDate=function(){return new Date(this.valueOf())},G.toJSON=function(){return this.isValid()?this.toISOString():null},G.toISOString=function(){return this.$d.toISOString()},G.toString=function(){return this.$d.toUTCString()},q}(),ie=W.prototype;return K.prototype=ie,[["$ms",a],["$s",p],["$m",g],["$H",C],["$W",x],["$M",D],["$y",O],["$D",y]].forEach(function(q){ie[q[1]]=function(G){return this.$g(G,q[0],q[1])}}),K.extend=function(q,G){return q.$i||(q(G,W,K),q.$i=!0),K},K.locale=V,K.isDayjs=L,K.unix=function(q){return K(1e3*q)},K.en=k[j],K.Ls=k,K.p={},K})});var tc=dr((Ys,Js)=>{var Dv=b(I());(function(u,r){typeof Ys=="object"&&typeof Js<"u"?Js.exports=r():typeof define=="function"&&define.amd?define(r):(u=typeof globalThis<"u"?globalThis:u||self).dayjs_plugin_relativeTime=r()})(Ys,function(){"use strict";return function(u,r,s){u=u||{};var a=r.prototype,p={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function g(x,T,D,$){return a.fromToBase(x,T,D,$)}s.en.relativeTime=p,a.fromToBase=function(x,T,D,$,O){for(var y,v,P,F=D.$locale().relativeTime||p,H=u.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],N=H.length,Q=0;Q<N;Q+=1){var j=H[Q];j.d&&(y=$?s(x).diff(D,j.d,!0):D.diff(x,j.d,!0));var k=(u.rounding||Math.round)(Math.abs(y));if(P=y>0,k<=j.r||!j.r){k<=1&&Q>0&&(j=H[Q-1]);var L=F[j.l];O&&(k=O(""+k)),v=typeof L=="string"?L.replace("%d",k):L(k,T,j.l,P);break}}if(T)return v;var V=P?F.future:F.past;return typeof V=="function"?V(v):V.replace("%s",v)},a.to=function(x,T){return g(x,T,this,!0)},a.from=function(x,T){return g(x,T,this)};var C=function(x){return x.$u?s.utc():s()};a.toNow=function(x){return this.to(C(this),x)},a.fromNow=function(x){return this.from(C(this),x)}}})});var rt=dr((eo,rc)=>{var Jv=b(I());(function(u,r){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],r);else if(typeof eo<"u")r(rc);else{var s={exports:{}};r(s),u.browser=s.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:eo,function(u){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let r="The message port closed before a response was received.",s=a=>{let p={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(p).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class g extends WeakMap{constructor(L,V=void 0){super(V),this.createItem=L}get(L){return this.has(L)||this.set(L,this.createItem(L)),super.get(L)}}let C=k=>k&&typeof k=="object"&&typeof k.then=="function",x=(k,L)=>(...V)=>{a.runtime.lastError?k.reject(new Error(a.runtime.lastError.message)):L.singleCallbackArg||V.length<=1&&L.singleCallbackArg!==!1?k.resolve(V[0]):k.resolve(V)},T=k=>k==1?"argument":"arguments",D=(k,L)=>function(K,...Y){if(Y.length<L.minArgs)throw new Error(`Expected at least ${L.minArgs} ${T(L.minArgs)} for ${k}(), got ${Y.length}`);if(Y.length>L.maxArgs)throw new Error(`Expected at most ${L.maxArgs} ${T(L.maxArgs)} for ${k}(), got ${Y.length}`);return new Promise((W,ie)=>{if(L.fallbackToNoCallback)try{K[k](...Y,x({resolve:W,reject:ie},L))}catch(q){console.warn(`${k} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,q),K[k](...Y),L.fallbackToNoCallback=!1,L.noCallback=!0,W()}else L.noCallback?(K[k](...Y),W()):K[k](...Y,x({resolve:W,reject:ie},L))})},$=(k,L,V)=>new Proxy(L,{apply(K,Y,W){return V.call(Y,k,...W)}}),O=Function.call.bind(Object.prototype.hasOwnProperty),y=(k,L={},V={})=>{let K=Object.create(null),Y={has(ie,q){return q in k||q in K},get(ie,q,G){if(q in K)return K[q];if(!(q in k))return;let E=k[q];if(typeof E=="function")if(typeof L[q]=="function")E=$(k,k[q],L[q]);else if(O(V,q)){let U=D(q,V[q]);E=$(k,k[q],U)}else E=E.bind(k);else if(typeof E=="object"&&E!==null&&(O(L,q)||O(V,q)))E=y(E,L[q],V[q]);else if(O(V,"*"))E=y(E,L[q],V["*"]);else return Object.defineProperty(K,q,{configurable:!0,enumerable:!0,get(){return k[q]},set(U){k[q]=U}}),E;return K[q]=E,E},set(ie,q,G,E){return q in K?K[q]=G:k[q]=G,!0},defineProperty(ie,q,G){return Reflect.defineProperty(K,q,G)},deleteProperty(ie,q){return Reflect.deleteProperty(K,q)}},W=Object.create(k);return new Proxy(W,Y)},v=k=>({addListener(L,V,...K){L.addListener(k.get(V),...K)},hasListener(L,V){return L.hasListener(k.get(V))},removeListener(L,V){L.removeListener(k.get(V))}}),P=new g(k=>typeof k!="function"?k:function(V){let K=y(V,{},{getContent:{minArgs:0,maxArgs:0}});k(K)}),F=new g(k=>typeof k!="function"?k:function(V,K,Y){let W=!1,ie,q=new Promise(R=>{ie=function(J){W=!0,R(J)}}),G;try{G=k(V,K,ie)}catch(R){G=Promise.reject(R)}let E=G!==!0&&C(G);if(G!==!0&&!E&&!W)return!1;let U=R=>{R.then(J=>{Y(J)},J=>{let re;J&&(J instanceof Error||typeof J.message=="string")?re=J.message:re="An unexpected error occurred",Y({__mozWebExtensionPolyfillReject__:!0,message:re})}).catch(J=>{console.error("Failed to send onMessage rejected reply",J)})};return U(E?G:q),!0}),H=({reject:k,resolve:L},V)=>{a.runtime.lastError?a.runtime.lastError.message===r?L():k(new Error(a.runtime.lastError.message)):V&&V.__mozWebExtensionPolyfillReject__?k(new Error(V.message)):L(V)},N=(k,L,V,...K)=>{if(K.length<L.minArgs)throw new Error(`Expected at least ${L.minArgs} ${T(L.minArgs)} for ${k}(), got ${K.length}`);if(K.length>L.maxArgs)throw new Error(`Expected at most ${L.maxArgs} ${T(L.maxArgs)} for ${k}(), got ${K.length}`);return new Promise((Y,W)=>{let ie=H.bind(null,{resolve:Y,reject:W});K.push(ie),V.sendMessage(...K)})},Q={devtools:{network:{onRequestFinished:v(P)}},runtime:{onMessage:v(F),onMessageExternal:v(F),sendMessage:N.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:N.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},j={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return p.privacy={network:{"*":j},services:{"*":j},websites:{"*":j}},y(a,Q,p)};u.exports=s(chrome)}else u.exports=globalThis.browser})});var ai=dr((qn,fr)=>{var fC=b(I());(function(){var u,r="4.17.21",s=200,a="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",g="Invalid `variable` option passed into `_.template`",C="__lodash_hash_undefined__",x=500,T="__lodash_placeholder__",D=1,$=2,O=4,y=1,v=2,P=1,F=2,H=4,N=8,Q=16,j=32,k=64,L=128,V=256,K=512,Y=30,W="...",ie=800,q=16,G=1,E=2,U=3,R=1/0,J=9007199254740991,re=17976931348623157e292,he=0/0,ve=4294967295,Ae=ve-1,Ue=ve>>>1,wt=[["ary",L],["bind",P],["bindKey",F],["curry",N],["curryRight",Q],["flip",K],["partial",j],["partialRight",k],["rearg",V]],Be="[object Arguments]",kt="[object Array]",pn="[object AsyncFunction]",pt="[object Boolean]",Me="[object Date]",It="[object DOMException]",Yt="[object Error]",Mt="[object Function]",yo="[object GeneratorFunction]",_t="[object Map]",Kn="[object Number]",xc="[object Null]",Ot="[object Object]",_o="[object Promise]",Tc="[object Proxy]",Qn="[object RegExp]",bt="[object Set]",zn="[object String]",vr="[object Symbol]",Sc="[object Undefined]",Yn="[object WeakMap]",Ac="[object WeakSet]",Jn="[object ArrayBuffer]",Tn="[object DataView]",Si="[object Float32Array]",Ai="[object Float64Array]",wi="[object Int8Array]",ki="[object Int16Array]",Ii="[object Int32Array]",Pi="[object Uint8Array]",Ri="[object Uint8ClampedArray]",Ei="[object Uint16Array]",Mi="[object Uint32Array]",wc=/\b__p \+= '';/g,kc=/\b(__p \+=) '' \+/g,Ic=/(__e\(.*?\)|\b__t\)) \+\n'';/g,bo=/&(?:amp|lt|gt|quot|#39);/g,xo=/[&<>"']/g,Pc=RegExp(bo.source),Rc=RegExp(xo.source),Ec=/<%-([\s\S]+?)%>/g,Mc=/<%([\s\S]+?)%>/g,To=/<%=([\s\S]+?)%>/g,Oc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Lc=/^\w*$/,Dc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Oi=/[\\^$.*+?()[\]{}|]/g,Uc=RegExp(Oi.source),Li=/^\s+/,Nc=/\s/,qc=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Gc=/\{\n\/\* \[wrapped with (.+)\] \*/,Fc=/,? & /,Bc=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,$c=/[()=,{}\[\]\/\s]/,Wc=/\\(\\)?/g,Hc=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,So=/\w*$/,Vc=/^[-+]0x[0-9a-f]+$/i,Kc=/^0b[01]+$/i,Qc=/^\[object .+?Constructor\]$/,zc=/^0o[0-7]+$/i,Yc=/^(?:0|[1-9]\d*)$/,Jc=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Cr=/($^)/,Xc=/['\n\r\u2028\u2029\\]/g,yr="\\ud800-\\udfff",Zc="\\u0300-\\u036f",jc="\\ufe20-\\ufe2f",el="\\u20d0-\\u20ff",Ao=Zc+jc+el,wo="\\u2700-\\u27bf",ko="a-z\\xdf-\\xf6\\xf8-\\xff",tl="\\xac\\xb1\\xd7\\xf7",nl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rl="\\u2000-\\u206f",il=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Io="A-Z\\xc0-\\xd6\\xd8-\\xde",Po="\\ufe0e\\ufe0f",Ro=tl+nl+rl+il,Di="['\u2019]",sl="["+yr+"]",Eo="["+Ro+"]",_r="["+Ao+"]",Mo="\\d+",ol="["+wo+"]",Oo="["+ko+"]",Lo="[^"+yr+Ro+Mo+wo+ko+Io+"]",Ui="\\ud83c[\\udffb-\\udfff]",al="(?:"+_r+"|"+Ui+")",Do="[^"+yr+"]",Ni="(?:\\ud83c[\\udde6-\\uddff]){2}",qi="[\\ud800-\\udbff][\\udc00-\\udfff]",Sn="["+Io+"]",Uo="\\u200d",No="(?:"+Oo+"|"+Lo+")",ul="(?:"+Sn+"|"+Lo+")",qo="(?:"+Di+"(?:d|ll|m|re|s|t|ve))?",Go="(?:"+Di+"(?:D|LL|M|RE|S|T|VE))?",Fo=al+"?",Bo="["+Po+"]?",cl="(?:"+Uo+"(?:"+[Do,Ni,qi].join("|")+")"+Bo+Fo+")*",ll="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",pl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",$o=Bo+Fo+cl,dl="(?:"+[ol,Ni,qi].join("|")+")"+$o,fl="(?:"+[Do+_r+"?",_r,Ni,qi,sl].join("|")+")",gl=RegExp(Di,"g"),hl=RegExp(_r,"g"),Gi=RegExp(Ui+"(?="+Ui+")|"+fl+$o,"g"),ml=RegExp([Sn+"?"+Oo+"+"+qo+"(?="+[Eo,Sn,"$"].join("|")+")",ul+"+"+Go+"(?="+[Eo,Sn+No,"$"].join("|")+")",Sn+"?"+No+"+"+qo,Sn+"+"+Go,pl,ll,Mo,dl].join("|"),"g"),vl=RegExp("["+Uo+yr+Ao+Po+"]"),Cl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,yl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],_l=-1,Se={};Se[Si]=Se[Ai]=Se[wi]=Se[ki]=Se[Ii]=Se[Pi]=Se[Ri]=Se[Ei]=Se[Mi]=!0,Se[Be]=Se[kt]=Se[Jn]=Se[pt]=Se[Tn]=Se[Me]=Se[Yt]=Se[Mt]=Se[_t]=Se[Kn]=Se[Ot]=Se[Qn]=Se[bt]=Se[zn]=Se[Yn]=!1;var xe={};xe[Be]=xe[kt]=xe[Jn]=xe[Tn]=xe[pt]=xe[Me]=xe[Si]=xe[Ai]=xe[wi]=xe[ki]=xe[Ii]=xe[_t]=xe[Kn]=xe[Ot]=xe[Qn]=xe[bt]=xe[zn]=xe[vr]=xe[Pi]=xe[Ri]=xe[Ei]=xe[Mi]=!0,xe[Yt]=xe[Mt]=xe[Yn]=!1;var bl={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},xl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Tl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Sl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Al=parseFloat,wl=parseInt,Wo=typeof global=="object"&&global&&global.Object===Object&&global,kl=typeof self=="object"&&self&&self.Object===Object&&self,Ne=Wo||kl||Function("return this")(),Fi=typeof qn=="object"&&qn&&!qn.nodeType&&qn,dn=Fi&&typeof fr=="object"&&fr&&!fr.nodeType&&fr,Ho=dn&&dn.exports===Fi,Bi=Ho&&Wo.process,dt=function(){try{var h=dn&&dn.require&&dn.require("util").types;return h||Bi&&Bi.binding&&Bi.binding("util")}catch{}}(),Vo=dt&&dt.isArrayBuffer,Ko=dt&&dt.isDate,Qo=dt&&dt.isMap,zo=dt&&dt.isRegExp,Yo=dt&&dt.isSet,Jo=dt&&dt.isTypedArray;function it(h,S,_){switch(_.length){case 0:return h.call(S);case 1:return h.call(S,_[0]);case 2:return h.call(S,_[0],_[1]);case 3:return h.call(S,_[0],_[1],_[2])}return h.apply(S,_)}function Il(h,S,_,z){for(var se=-1,Ce=h==null?0:h.length;++se<Ce;){var Le=h[se];S(z,Le,_(Le),h)}return z}function ft(h,S){for(var _=-1,z=h==null?0:h.length;++_<z&&S(h[_],_,h)!==!1;);return h}function Pl(h,S){for(var _=h==null?0:h.length;_--&&S(h[_],_,h)!==!1;);return h}function Xo(h,S){for(var _=-1,z=h==null?0:h.length;++_<z;)if(!S(h[_],_,h))return!1;return!0}function Jt(h,S){for(var _=-1,z=h==null?0:h.length,se=0,Ce=[];++_<z;){var Le=h[_];S(Le,_,h)&&(Ce[se++]=Le)}return Ce}function br(h,S){var _=h==null?0:h.length;return!!_&&An(h,S,0)>-1}function $i(h,S,_){for(var z=-1,se=h==null?0:h.length;++z<se;)if(_(S,h[z]))return!0;return!1}function we(h,S){for(var _=-1,z=h==null?0:h.length,se=Array(z);++_<z;)se[_]=S(h[_],_,h);return se}function Xt(h,S){for(var _=-1,z=S.length,se=h.length;++_<z;)h[se+_]=S[_];return h}function Wi(h,S,_,z){var se=-1,Ce=h==null?0:h.length;for(z&&Ce&&(_=h[++se]);++se<Ce;)_=S(_,h[se],se,h);return _}function Rl(h,S,_,z){var se=h==null?0:h.length;for(z&&se&&(_=h[--se]);se--;)_=S(_,h[se],se,h);return _}function Hi(h,S){for(var _=-1,z=h==null?0:h.length;++_<z;)if(S(h[_],_,h))return!0;return!1}var El=Vi("length");function Ml(h){return h.split("")}function Ol(h){return h.match(Bc)||[]}function Zo(h,S,_){var z;return _(h,function(se,Ce,Le){if(S(se,Ce,Le))return z=Ce,!1}),z}function xr(h,S,_,z){for(var se=h.length,Ce=_+(z?1:-1);z?Ce--:++Ce<se;)if(S(h[Ce],Ce,h))return Ce;return-1}function An(h,S,_){return S===S?Vl(h,S,_):xr(h,jo,_)}function Ll(h,S,_,z){for(var se=_-1,Ce=h.length;++se<Ce;)if(z(h[se],S))return se;return-1}function jo(h){return h!==h}function ea(h,S){var _=h==null?0:h.length;return _?Qi(h,S)/_:he}function Vi(h){return function(S){return S==null?u:S[h]}}function Ki(h){return function(S){return h==null?u:h[S]}}function ta(h,S,_,z,se){return se(h,function(Ce,Le,be){_=z?(z=!1,Ce):S(_,Ce,Le,be)}),_}function Dl(h,S){var _=h.length;for(h.sort(S);_--;)h[_]=h[_].value;return h}function Qi(h,S){for(var _,z=-1,se=h.length;++z<se;){var Ce=S(h[z]);Ce!==u&&(_=_===u?Ce:_+Ce)}return _}function zi(h,S){for(var _=-1,z=Array(h);++_<h;)z[_]=S(_);return z}function Ul(h,S){return we(S,function(_){return[_,h[_]]})}function na(h){return h&&h.slice(0,oa(h)+1).replace(Li,"")}function st(h){return function(S){return h(S)}}function Yi(h,S){return we(S,function(_){return h[_]})}function Xn(h,S){return h.has(S)}function ra(h,S){for(var _=-1,z=h.length;++_<z&&An(S,h[_],0)>-1;);return _}function ia(h,S){for(var _=h.length;_--&&An(S,h[_],0)>-1;);return _}function Nl(h,S){for(var _=h.length,z=0;_--;)h[_]===S&&++z;return z}var ql=Ki(bl),Gl=Ki(xl);function Fl(h){return"\\"+Sl[h]}function Bl(h,S){return h==null?u:h[S]}function wn(h){return vl.test(h)}function $l(h){return Cl.test(h)}function Wl(h){for(var S,_=[];!(S=h.next()).done;)_.push(S.value);return _}function Ji(h){var S=-1,_=Array(h.size);return h.forEach(function(z,se){_[++S]=[se,z]}),_}function sa(h,S){return function(_){return h(S(_))}}function Zt(h,S){for(var _=-1,z=h.length,se=0,Ce=[];++_<z;){var Le=h[_];(Le===S||Le===T)&&(h[_]=T,Ce[se++]=_)}return Ce}function Tr(h){var S=-1,_=Array(h.size);return h.forEach(function(z){_[++S]=z}),_}function Hl(h){var S=-1,_=Array(h.size);return h.forEach(function(z){_[++S]=[z,z]}),_}function Vl(h,S,_){for(var z=_-1,se=h.length;++z<se;)if(h[z]===S)return z;return-1}function Kl(h,S,_){for(var z=_+1;z--;)if(h[z]===S)return z;return z}function kn(h){return wn(h)?zl(h):El(h)}function xt(h){return wn(h)?Yl(h):Ml(h)}function oa(h){for(var S=h.length;S--&&Nc.test(h.charAt(S)););return S}var Ql=Ki(Tl);function zl(h){for(var S=Gi.lastIndex=0;Gi.test(h);)++S;return S}function Yl(h){return h.match(Gi)||[]}function Jl(h){return h.match(ml)||[]}var Xl=function h(S){S=S==null?Ne:jt.defaults(Ne.Object(),S,jt.pick(Ne,yl));var _=S.Array,z=S.Date,se=S.Error,Ce=S.Function,Le=S.Math,be=S.Object,Xi=S.RegExp,Zl=S.String,gt=S.TypeError,Sr=_.prototype,jl=Ce.prototype,In=be.prototype,Ar=S["__core-js_shared__"],wr=jl.toString,_e=In.hasOwnProperty,ep=0,aa=function(){var e=/[^.]+$/.exec(Ar&&Ar.keys&&Ar.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),kr=In.toString,tp=wr.call(be),np=Ne._,rp=Xi("^"+wr.call(_e).replace(Oi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ir=Ho?S.Buffer:u,en=S.Symbol,Pr=S.Uint8Array,ua=Ir?Ir.allocUnsafe:u,Rr=sa(be.getPrototypeOf,be),ca=be.create,la=In.propertyIsEnumerable,Er=Sr.splice,pa=en?en.isConcatSpreadable:u,Zn=en?en.iterator:u,fn=en?en.toStringTag:u,Mr=function(){try{var e=Cn(be,"defineProperty");return e({},"",{}),e}catch{}}(),ip=S.clearTimeout!==Ne.clearTimeout&&S.clearTimeout,sp=z&&z.now!==Ne.Date.now&&z.now,op=S.setTimeout!==Ne.setTimeout&&S.setTimeout,Or=Le.ceil,Lr=Le.floor,Zi=be.getOwnPropertySymbols,ap=Ir?Ir.isBuffer:u,da=S.isFinite,up=Sr.join,cp=sa(be.keys,be),De=Le.max,$e=Le.min,lp=z.now,pp=S.parseInt,fa=Le.random,dp=Sr.reverse,ji=Cn(S,"DataView"),jn=Cn(S,"Map"),es=Cn(S,"Promise"),Pn=Cn(S,"Set"),er=Cn(S,"WeakMap"),tr=Cn(be,"create"),Dr=er&&new er,Rn={},fp=yn(ji),gp=yn(jn),hp=yn(es),mp=yn(Pn),vp=yn(er),Ur=en?en.prototype:u,nr=Ur?Ur.valueOf:u,ga=Ur?Ur.toString:u;function c(e){if(Ie(e)&&!oe(e)&&!(e instanceof de)){if(e instanceof ht)return e;if(_e.call(e,"__wrapped__"))return hu(e)}return new ht(e)}var En=function(){function e(){}return function(t){if(!ke(t))return{};if(ca)return ca(t);e.prototype=t;var n=new e;return e.prototype=u,n}}();function Nr(){}function ht(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=u}c.templateSettings={escape:Ec,evaluate:Mc,interpolate:To,variable:"",imports:{_:c}},c.prototype=Nr.prototype,c.prototype.constructor=c,ht.prototype=En(Nr.prototype),ht.prototype.constructor=ht;function de(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ve,this.__views__=[]}function Cp(){var e=new de(this.__wrapped__);return e.__actions__=Ze(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ze(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ze(this.__views__),e}function yp(){if(this.__filtered__){var e=new de(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function _p(){var e=this.__wrapped__.value(),t=this.__dir__,n=oe(e),i=t<0,o=n?e.length:0,l=Md(0,o,this.__views__),d=l.start,f=l.end,m=f-d,A=i?f:d-1,w=this.__iteratees__,M=w.length,B=0,X=$e(m,this.__takeCount__);if(!n||!i&&o==m&&X==m)return qa(e,this.__actions__);var te=[];e:for(;m--&&B<X;){A+=t;for(var ce=-1,ne=e[A];++ce<M;){var pe=w[ce],fe=pe.iteratee,ut=pe.type,Xe=fe(ne);if(ut==E)ne=Xe;else if(!Xe){if(ut==G)continue e;break e}}te[B++]=ne}return te}de.prototype=En(Nr.prototype),de.prototype.constructor=de;function gn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function bp(){this.__data__=tr?tr(null):{},this.size=0}function xp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Tp(e){var t=this.__data__;if(tr){var n=t[e];return n===C?u:n}return _e.call(t,e)?t[e]:u}function Sp(e){var t=this.__data__;return tr?t[e]!==u:_e.call(t,e)}function Ap(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=tr&&t===u?C:t,this}gn.prototype.clear=bp,gn.prototype.delete=xp,gn.prototype.get=Tp,gn.prototype.has=Sp,gn.prototype.set=Ap;function Lt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function wp(){this.__data__=[],this.size=0}function kp(e){var t=this.__data__,n=qr(t,e);if(n<0)return!1;var i=t.length-1;return n==i?t.pop():Er.call(t,n,1),--this.size,!0}function Ip(e){var t=this.__data__,n=qr(t,e);return n<0?u:t[n][1]}function Pp(e){return qr(this.__data__,e)>-1}function Rp(e,t){var n=this.__data__,i=qr(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}Lt.prototype.clear=wp,Lt.prototype.delete=kp,Lt.prototype.get=Ip,Lt.prototype.has=Pp,Lt.prototype.set=Rp;function Dt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Ep(){this.size=0,this.__data__={hash:new gn,map:new(jn||Lt),string:new gn}}function Mp(e){var t=Jr(this,e).delete(e);return this.size-=t?1:0,t}function Op(e){return Jr(this,e).get(e)}function Lp(e){return Jr(this,e).has(e)}function Dp(e,t){var n=Jr(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}Dt.prototype.clear=Ep,Dt.prototype.delete=Mp,Dt.prototype.get=Op,Dt.prototype.has=Lp,Dt.prototype.set=Dp;function hn(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Dt;++t<n;)this.add(e[t])}function Up(e){return this.__data__.set(e,C),this}function Np(e){return this.__data__.has(e)}hn.prototype.add=hn.prototype.push=Up,hn.prototype.has=Np;function Tt(e){var t=this.__data__=new Lt(e);this.size=t.size}function qp(){this.__data__=new Lt,this.size=0}function Gp(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Fp(e){return this.__data__.get(e)}function Bp(e){return this.__data__.has(e)}function $p(e,t){var n=this.__data__;if(n instanceof Lt){var i=n.__data__;if(!jn||i.length<s-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new Dt(i)}return n.set(e,t),this.size=n.size,this}Tt.prototype.clear=qp,Tt.prototype.delete=Gp,Tt.prototype.get=Fp,Tt.prototype.has=Bp,Tt.prototype.set=$p;function ha(e,t){var n=oe(e),i=!n&&_n(e),o=!n&&!i&&on(e),l=!n&&!i&&!o&&Dn(e),d=n||i||o||l,f=d?zi(e.length,Zl):[],m=f.length;for(var A in e)(t||_e.call(e,A))&&!(d&&(A=="length"||o&&(A=="offset"||A=="parent")||l&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||Gt(A,m)))&&f.push(A);return f}function ma(e){var t=e.length;return t?e[ps(0,t-1)]:u}function Wp(e,t){return Xr(Ze(e),mn(t,0,e.length))}function Hp(e){return Xr(Ze(e))}function ts(e,t,n){(n!==u&&!St(e[t],n)||n===u&&!(t in e))&&Ut(e,t,n)}function rr(e,t,n){var i=e[t];(!(_e.call(e,t)&&St(i,n))||n===u&&!(t in e))&&Ut(e,t,n)}function qr(e,t){for(var n=e.length;n--;)if(St(e[n][0],t))return n;return-1}function Vp(e,t,n,i){return tn(e,function(o,l,d){t(i,o,n(o),d)}),i}function va(e,t){return e&&Rt(t,qe(t),e)}function Kp(e,t){return e&&Rt(t,et(t),e)}function Ut(e,t,n){t=="__proto__"&&Mr?Mr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ns(e,t){for(var n=-1,i=t.length,o=_(i),l=e==null;++n<i;)o[n]=l?u:Us(e,t[n]);return o}function mn(e,t,n){return e===e&&(n!==u&&(e=e<=n?e:n),t!==u&&(e=e>=t?e:t)),e}function mt(e,t,n,i,o,l){var d,f=t&D,m=t&$,A=t&O;if(n&&(d=o?n(e,i,o,l):n(e)),d!==u)return d;if(!ke(e))return e;var w=oe(e);if(w){if(d=Ld(e),!f)return Ze(e,d)}else{var M=We(e),B=M==Mt||M==yo;if(on(e))return Ba(e,f);if(M==Ot||M==Be||B&&!o){if(d=m||B?{}:ou(e),!f)return m?Td(e,Kp(d,e)):xd(e,va(d,e))}else{if(!xe[M])return o?e:{};d=Dd(e,M,f)}}l||(l=new Tt);var X=l.get(e);if(X)return X;l.set(e,d),Du(e)?e.forEach(function(ne){d.add(mt(ne,t,n,ne,e,l))}):Ou(e)&&e.forEach(function(ne,pe){d.set(pe,mt(ne,t,n,pe,e,l))});var te=A?m?xs:bs:m?et:qe,ce=w?u:te(e);return ft(ce||e,function(ne,pe){ce&&(pe=ne,ne=e[pe]),rr(d,pe,mt(ne,t,n,pe,e,l))}),d}function Qp(e){var t=qe(e);return function(n){return Ca(n,e,t)}}function Ca(e,t,n){var i=n.length;if(e==null)return!i;for(e=be(e);i--;){var o=n[i],l=t[o],d=e[o];if(d===u&&!(o in e)||!l(d))return!1}return!0}function ya(e,t,n){if(typeof e!="function")throw new gt(p);return lr(function(){e.apply(u,n)},t)}function ir(e,t,n,i){var o=-1,l=br,d=!0,f=e.length,m=[],A=t.length;if(!f)return m;n&&(t=we(t,st(n))),i?(l=$i,d=!1):t.length>=s&&(l=Xn,d=!1,t=new hn(t));e:for(;++o<f;){var w=e[o],M=n==null?w:n(w);if(w=i||w!==0?w:0,d&&M===M){for(var B=A;B--;)if(t[B]===M)continue e;m.push(w)}else l(t,M,i)||m.push(w)}return m}var tn=Ka(Pt),_a=Ka(is,!0);function zp(e,t){var n=!0;return tn(e,function(i,o,l){return n=!!t(i,o,l),n}),n}function Gr(e,t,n){for(var i=-1,o=e.length;++i<o;){var l=e[i],d=t(l);if(d!=null&&(f===u?d===d&&!at(d):n(d,f)))var f=d,m=l}return m}function Yp(e,t,n,i){var o=e.length;for(n=ue(n),n<0&&(n=-n>o?0:o+n),i=i===u||i>o?o:ue(i),i<0&&(i+=o),i=n>i?0:Nu(i);n<i;)e[n++]=t;return e}function ba(e,t){var n=[];return tn(e,function(i,o,l){t(i,o,l)&&n.push(i)}),n}function Ge(e,t,n,i,o){var l=-1,d=e.length;for(n||(n=Nd),o||(o=[]);++l<d;){var f=e[l];t>0&&n(f)?t>1?Ge(f,t-1,n,i,o):Xt(o,f):i||(o[o.length]=f)}return o}var rs=Qa(),xa=Qa(!0);function Pt(e,t){return e&&rs(e,t,qe)}function is(e,t){return e&&xa(e,t,qe)}function Fr(e,t){return Jt(t,function(n){return Ft(e[n])})}function vn(e,t){t=rn(t,e);for(var n=0,i=t.length;e!=null&&n<i;)e=e[Et(t[n++])];return n&&n==i?e:u}function Ta(e,t,n){var i=t(e);return oe(e)?i:Xt(i,n(e))}function Ye(e){return e==null?e===u?Sc:xc:fn&&fn in be(e)?Ed(e):Hd(e)}function ss(e,t){return e>t}function Jp(e,t){return e!=null&&_e.call(e,t)}function Xp(e,t){return e!=null&&t in be(e)}function Zp(e,t,n){return e>=$e(t,n)&&e<De(t,n)}function os(e,t,n){for(var i=n?$i:br,o=e[0].length,l=e.length,d=l,f=_(l),m=1/0,A=[];d--;){var w=e[d];d&&t&&(w=we(w,st(t))),m=$e(w.length,m),f[d]=!n&&(t||o>=120&&w.length>=120)?new hn(d&&w):u}w=e[0];var M=-1,B=f[0];e:for(;++M<o&&A.length<m;){var X=w[M],te=t?t(X):X;if(X=n||X!==0?X:0,!(B?Xn(B,te):i(A,te,n))){for(d=l;--d;){var ce=f[d];if(!(ce?Xn(ce,te):i(e[d],te,n)))continue e}B&&B.push(te),A.push(X)}}return A}function jp(e,t,n,i){return Pt(e,function(o,l,d){t(i,n(o),l,d)}),i}function sr(e,t,n){t=rn(t,e),e=lu(e,t);var i=e==null?e:e[Et(Ct(t))];return i==null?u:it(i,e,n)}function Sa(e){return Ie(e)&&Ye(e)==Be}function ed(e){return Ie(e)&&Ye(e)==Jn}function td(e){return Ie(e)&&Ye(e)==Me}function or(e,t,n,i,o){return e===t?!0:e==null||t==null||!Ie(e)&&!Ie(t)?e!==e&&t!==t:nd(e,t,n,i,or,o)}function nd(e,t,n,i,o,l){var d=oe(e),f=oe(t),m=d?kt:We(e),A=f?kt:We(t);m=m==Be?Ot:m,A=A==Be?Ot:A;var w=m==Ot,M=A==Ot,B=m==A;if(B&&on(e)){if(!on(t))return!1;d=!0,w=!1}if(B&&!w)return l||(l=new Tt),d||Dn(e)?ru(e,t,n,i,o,l):Pd(e,t,m,n,i,o,l);if(!(n&y)){var X=w&&_e.call(e,"__wrapped__"),te=M&&_e.call(t,"__wrapped__");if(X||te){var ce=X?e.value():e,ne=te?t.value():t;return l||(l=new Tt),o(ce,ne,n,i,l)}}return B?(l||(l=new Tt),Rd(e,t,n,i,o,l)):!1}function rd(e){return Ie(e)&&We(e)==_t}function as(e,t,n,i){var o=n.length,l=o,d=!i;if(e==null)return!l;for(e=be(e);o--;){var f=n[o];if(d&&f[2]?f[1]!==e[f[0]]:!(f[0]in e))return!1}for(;++o<l;){f=n[o];var m=f[0],A=e[m],w=f[1];if(d&&f[2]){if(A===u&&!(m in e))return!1}else{var M=new Tt;if(i)var B=i(A,w,m,e,t,M);if(!(B===u?or(w,A,y|v,i,M):B))return!1}}return!0}function Aa(e){if(!ke(e)||Gd(e))return!1;var t=Ft(e)?rp:Qc;return t.test(yn(e))}function id(e){return Ie(e)&&Ye(e)==Qn}function sd(e){return Ie(e)&&We(e)==bt}function od(e){return Ie(e)&&ri(e.length)&&!!Se[Ye(e)]}function wa(e){return typeof e=="function"?e:e==null?tt:typeof e=="object"?oe(e)?Pa(e[0],e[1]):Ia(e):zu(e)}function us(e){if(!cr(e))return cp(e);var t=[];for(var n in be(e))_e.call(e,n)&&n!="constructor"&&t.push(n);return t}function ad(e){if(!ke(e))return Wd(e);var t=cr(e),n=[];for(var i in e)i=="constructor"&&(t||!_e.call(e,i))||n.push(i);return n}function cs(e,t){return e<t}function ka(e,t){var n=-1,i=je(e)?_(e.length):[];return tn(e,function(o,l,d){i[++n]=t(o,l,d)}),i}function Ia(e){var t=Ss(e);return t.length==1&&t[0][2]?uu(t[0][0],t[0][1]):function(n){return n===e||as(n,e,t)}}function Pa(e,t){return ws(e)&&au(t)?uu(Et(e),t):function(n){var i=Us(n,e);return i===u&&i===t?Ns(n,e):or(t,i,y|v)}}function Br(e,t,n,i,o){e!==t&&rs(t,function(l,d){if(o||(o=new Tt),ke(l))ud(e,t,d,n,Br,i,o);else{var f=i?i(Is(e,d),l,d+"",e,t,o):u;f===u&&(f=l),ts(e,d,f)}},et)}function ud(e,t,n,i,o,l,d){var f=Is(e,n),m=Is(t,n),A=d.get(m);if(A){ts(e,n,A);return}var w=l?l(f,m,n+"",e,t,d):u,M=w===u;if(M){var B=oe(m),X=!B&&on(m),te=!B&&!X&&Dn(m);w=m,B||X||te?oe(f)?w=f:Pe(f)?w=Ze(f):X?(M=!1,w=Ba(m,!0)):te?(M=!1,w=$a(m,!0)):w=[]:pr(m)||_n(m)?(w=f,_n(f)?w=qu(f):(!ke(f)||Ft(f))&&(w=ou(m))):M=!1}M&&(d.set(m,w),o(w,m,i,l,d),d.delete(m)),ts(e,n,w)}function Ra(e,t){var n=e.length;if(n)return t+=t<0?n:0,Gt(t,n)?e[t]:u}function Ea(e,t,n){t.length?t=we(t,function(l){return oe(l)?function(d){return vn(d,l.length===1?l[0]:l)}:l}):t=[tt];var i=-1;t=we(t,st(ee()));var o=ka(e,function(l,d,f){var m=we(t,function(A){return A(l)});return{criteria:m,index:++i,value:l}});return Dl(o,function(l,d){return bd(l,d,n)})}function cd(e,t){return Ma(e,t,function(n,i){return Ns(e,i)})}function Ma(e,t,n){for(var i=-1,o=t.length,l={};++i<o;){var d=t[i],f=vn(e,d);n(f,d)&&ar(l,rn(d,e),f)}return l}function ld(e){return function(t){return vn(t,e)}}function ls(e,t,n,i){var o=i?Ll:An,l=-1,d=t.length,f=e;for(e===t&&(t=Ze(t)),n&&(f=we(e,st(n)));++l<d;)for(var m=0,A=t[l],w=n?n(A):A;(m=o(f,w,m,i))>-1;)f!==e&&Er.call(f,m,1),Er.call(e,m,1);return e}function Oa(e,t){for(var n=e?t.length:0,i=n-1;n--;){var o=t[n];if(n==i||o!==l){var l=o;Gt(o)?Er.call(e,o,1):gs(e,o)}}return e}function ps(e,t){return e+Lr(fa()*(t-e+1))}function pd(e,t,n,i){for(var o=-1,l=De(Or((t-e)/(n||1)),0),d=_(l);l--;)d[i?l:++o]=e,e+=n;return d}function ds(e,t){var n="";if(!e||t<1||t>J)return n;do t%2&&(n+=e),t=Lr(t/2),t&&(e+=e);while(t);return n}function le(e,t){return Ps(cu(e,t,tt),e+"")}function dd(e){return ma(Un(e))}function fd(e,t){var n=Un(e);return Xr(n,mn(t,0,n.length))}function ar(e,t,n,i){if(!ke(e))return e;t=rn(t,e);for(var o=-1,l=t.length,d=l-1,f=e;f!=null&&++o<l;){var m=Et(t[o]),A=n;if(m==="__proto__"||m==="constructor"||m==="prototype")return e;if(o!=d){var w=f[m];A=i?i(w,m,f):u,A===u&&(A=ke(w)?w:Gt(t[o+1])?[]:{})}rr(f,m,A),f=f[m]}return e}var La=Dr?function(e,t){return Dr.set(e,t),e}:tt,gd=Mr?function(e,t){return Mr(e,"toString",{configurable:!0,enumerable:!1,value:Gs(t),writable:!0})}:tt;function hd(e){return Xr(Un(e))}function vt(e,t,n){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),n=n>o?o:n,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var l=_(o);++i<o;)l[i]=e[i+t];return l}function md(e,t){var n;return tn(e,function(i,o,l){return n=t(i,o,l),!n}),!!n}function $r(e,t,n){var i=0,o=e==null?i:e.length;if(typeof t=="number"&&t===t&&o<=Ue){for(;i<o;){var l=i+o>>>1,d=e[l];d!==null&&!at(d)&&(n?d<=t:d<t)?i=l+1:o=l}return o}return fs(e,t,tt,n)}function fs(e,t,n,i){var o=0,l=e==null?0:e.length;if(l===0)return 0;t=n(t);for(var d=t!==t,f=t===null,m=at(t),A=t===u;o<l;){var w=Lr((o+l)/2),M=n(e[w]),B=M!==u,X=M===null,te=M===M,ce=at(M);if(d)var ne=i||te;else A?ne=te&&(i||B):f?ne=te&&B&&(i||!X):m?ne=te&&B&&!X&&(i||!ce):X||ce?ne=!1:ne=i?M<=t:M<t;ne?o=w+1:l=w}return $e(l,Ae)}function Da(e,t){for(var n=-1,i=e.length,o=0,l=[];++n<i;){var d=e[n],f=t?t(d):d;if(!n||!St(f,m)){var m=f;l[o++]=d===0?0:d}}return l}function Ua(e){return typeof e=="number"?e:at(e)?he:+e}function ot(e){if(typeof e=="string")return e;if(oe(e))return we(e,ot)+"";if(at(e))return ga?ga.call(e):"";var t=e+"";return t=="0"&&1/e==-R?"-0":t}function nn(e,t,n){var i=-1,o=br,l=e.length,d=!0,f=[],m=f;if(n)d=!1,o=$i;else if(l>=s){var A=t?null:kd(e);if(A)return Tr(A);d=!1,o=Xn,m=new hn}else m=t?[]:f;e:for(;++i<l;){var w=e[i],M=t?t(w):w;if(w=n||w!==0?w:0,d&&M===M){for(var B=m.length;B--;)if(m[B]===M)continue e;t&&m.push(M),f.push(w)}else o(m,M,n)||(m!==f&&m.push(M),f.push(w))}return f}function gs(e,t){return t=rn(t,e),e=lu(e,t),e==null||delete e[Et(Ct(t))]}function Na(e,t,n,i){return ar(e,t,n(vn(e,t)),i)}function Wr(e,t,n,i){for(var o=e.length,l=i?o:-1;(i?l--:++l<o)&&t(e[l],l,e););return n?vt(e,i?0:l,i?l+1:o):vt(e,i?l+1:0,i?o:l)}function qa(e,t){var n=e;return n instanceof de&&(n=n.value()),Wi(t,function(i,o){return o.func.apply(o.thisArg,Xt([i],o.args))},n)}function hs(e,t,n){var i=e.length;if(i<2)return i?nn(e[0]):[];for(var o=-1,l=_(i);++o<i;)for(var d=e[o],f=-1;++f<i;)f!=o&&(l[o]=ir(l[o]||d,e[f],t,n));return nn(Ge(l,1),t,n)}function Ga(e,t,n){for(var i=-1,o=e.length,l=t.length,d={};++i<o;){var f=i<l?t[i]:u;n(d,e[i],f)}return d}function ms(e){return Pe(e)?e:[]}function vs(e){return typeof e=="function"?e:tt}function rn(e,t){return oe(e)?e:ws(e,t)?[e]:gu(ye(e))}var vd=le;function sn(e,t,n){var i=e.length;return n=n===u?i:n,!t&&n>=i?e:vt(e,t,n)}var Fa=ip||function(e){return Ne.clearTimeout(e)};function Ba(e,t){if(t)return e.slice();var n=e.length,i=ua?ua(n):new e.constructor(n);return e.copy(i),i}function Cs(e){var t=new e.constructor(e.byteLength);return new Pr(t).set(new Pr(e)),t}function Cd(e,t){var n=t?Cs(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function yd(e){var t=new e.constructor(e.source,So.exec(e));return t.lastIndex=e.lastIndex,t}function _d(e){return nr?be(nr.call(e)):{}}function $a(e,t){var n=t?Cs(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Wa(e,t){if(e!==t){var n=e!==u,i=e===null,o=e===e,l=at(e),d=t!==u,f=t===null,m=t===t,A=at(t);if(!f&&!A&&!l&&e>t||l&&d&&m&&!f&&!A||i&&d&&m||!n&&m||!o)return 1;if(!i&&!l&&!A&&e<t||A&&n&&o&&!i&&!l||f&&n&&o||!d&&o||!m)return-1}return 0}function bd(e,t,n){for(var i=-1,o=e.criteria,l=t.criteria,d=o.length,f=n.length;++i<d;){var m=Wa(o[i],l[i]);if(m){if(i>=f)return m;var A=n[i];return m*(A=="desc"?-1:1)}}return e.index-t.index}function Ha(e,t,n,i){for(var o=-1,l=e.length,d=n.length,f=-1,m=t.length,A=De(l-d,0),w=_(m+A),M=!i;++f<m;)w[f]=t[f];for(;++o<d;)(M||o<l)&&(w[n[o]]=e[o]);for(;A--;)w[f++]=e[o++];return w}function Va(e,t,n,i){for(var o=-1,l=e.length,d=-1,f=n.length,m=-1,A=t.length,w=De(l-f,0),M=_(w+A),B=!i;++o<w;)M[o]=e[o];for(var X=o;++m<A;)M[X+m]=t[m];for(;++d<f;)(B||o<l)&&(M[X+n[d]]=e[o++]);return M}function Ze(e,t){var n=-1,i=e.length;for(t||(t=_(i));++n<i;)t[n]=e[n];return t}function Rt(e,t,n,i){var o=!n;n||(n={});for(var l=-1,d=t.length;++l<d;){var f=t[l],m=i?i(n[f],e[f],f,n,e):u;m===u&&(m=e[f]),o?Ut(n,f,m):rr(n,f,m)}return n}function xd(e,t){return Rt(e,As(e),t)}function Td(e,t){return Rt(e,iu(e),t)}function Hr(e,t){return function(n,i){var o=oe(n)?Il:Vp,l=t?t():{};return o(n,e,ee(i,2),l)}}function Mn(e){return le(function(t,n){var i=-1,o=n.length,l=o>1?n[o-1]:u,d=o>2?n[2]:u;for(l=e.length>3&&typeof l=="function"?(o--,l):u,d&&Je(n[0],n[1],d)&&(l=o<3?u:l,o=1),t=be(t);++i<o;){var f=n[i];f&&e(t,f,i,l)}return t})}function Ka(e,t){return function(n,i){if(n==null)return n;if(!je(n))return e(n,i);for(var o=n.length,l=t?o:-1,d=be(n);(t?l--:++l<o)&&i(d[l],l,d)!==!1;);return n}}function Qa(e){return function(t,n,i){for(var o=-1,l=be(t),d=i(t),f=d.length;f--;){var m=d[e?f:++o];if(n(l[m],m,l)===!1)break}return t}}function Sd(e,t,n){var i=t&P,o=ur(e);function l(){var d=this&&this!==Ne&&this instanceof l?o:e;return d.apply(i?n:this,arguments)}return l}function za(e){return function(t){t=ye(t);var n=wn(t)?xt(t):u,i=n?n[0]:t.charAt(0),o=n?sn(n,1).join(""):t.slice(1);return i[e]()+o}}function On(e){return function(t){return Wi(Ku(Vu(t).replace(gl,"")),e,"")}}function ur(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=En(e.prototype),i=e.apply(n,t);return ke(i)?i:n}}function Ad(e,t,n){var i=ur(e);function o(){for(var l=arguments.length,d=_(l),f=l,m=Ln(o);f--;)d[f]=arguments[f];var A=l<3&&d[0]!==m&&d[l-1]!==m?[]:Zt(d,m);if(l-=A.length,l<n)return ja(e,t,Vr,o.placeholder,u,d,A,u,u,n-l);var w=this&&this!==Ne&&this instanceof o?i:e;return it(w,this,d)}return o}function Ya(e){return function(t,n,i){var o=be(t);if(!je(t)){var l=ee(n,3);t=qe(t),n=function(f){return l(o[f],f,o)}}var d=e(t,n,i);return d>-1?o[l?t[d]:d]:u}}function Ja(e){return qt(function(t){var n=t.length,i=n,o=ht.prototype.thru;for(e&&t.reverse();i--;){var l=t[i];if(typeof l!="function")throw new gt(p);if(o&&!d&&Yr(l)=="wrapper")var d=new ht([],!0)}for(i=d?i:n;++i<n;){l=t[i];var f=Yr(l),m=f=="wrapper"?Ts(l):u;m&&ks(m[0])&&m[1]==(L|N|j|V)&&!m[4].length&&m[9]==1?d=d[Yr(m[0])].apply(d,m[3]):d=l.length==1&&ks(l)?d[f]():d.thru(l)}return function(){var A=arguments,w=A[0];if(d&&A.length==1&&oe(w))return d.plant(w).value();for(var M=0,B=n?t[M].apply(this,A):w;++M<n;)B=t[M].call(this,B);return B}})}function Vr(e,t,n,i,o,l,d,f,m,A){var w=t&L,M=t&P,B=t&F,X=t&(N|Q),te=t&K,ce=B?u:ur(e);function ne(){for(var pe=arguments.length,fe=_(pe),ut=pe;ut--;)fe[ut]=arguments[ut];if(X)var Xe=Ln(ne),ct=Nl(fe,Xe);if(i&&(fe=Ha(fe,i,o,X)),l&&(fe=Va(fe,l,d,X)),pe-=ct,X&&pe<A){var Re=Zt(fe,Xe);return ja(e,t,Vr,ne.placeholder,n,fe,Re,f,m,A-pe)}var At=M?n:this,$t=B?At[e]:e;return pe=fe.length,f?fe=Vd(fe,f):te&&pe>1&&fe.reverse(),w&&m<pe&&(fe.length=m),this&&this!==Ne&&this instanceof ne&&($t=ce||ur($t)),$t.apply(At,fe)}return ne}function Xa(e,t){return function(n,i){return jp(n,e,t(i),{})}}function Kr(e,t){return function(n,i){var o;if(n===u&&i===u)return t;if(n!==u&&(o=n),i!==u){if(o===u)return i;typeof n=="string"||typeof i=="string"?(n=ot(n),i=ot(i)):(n=Ua(n),i=Ua(i)),o=e(n,i)}return o}}function ys(e){return qt(function(t){return t=we(t,st(ee())),le(function(n){var i=this;return e(t,function(o){return it(o,i,n)})})})}function Qr(e,t){t=t===u?" ":ot(t);var n=t.length;if(n<2)return n?ds(t,e):t;var i=ds(t,Or(e/kn(t)));return wn(t)?sn(xt(i),0,e).join(""):i.slice(0,e)}function wd(e,t,n,i){var o=t&P,l=ur(e);function d(){for(var f=-1,m=arguments.length,A=-1,w=i.length,M=_(w+m),B=this&&this!==Ne&&this instanceof d?l:e;++A<w;)M[A]=i[A];for(;m--;)M[A++]=arguments[++f];return it(B,o?n:this,M)}return d}function Za(e){return function(t,n,i){return i&&typeof i!="number"&&Je(t,n,i)&&(n=i=u),t=Bt(t),n===u?(n=t,t=0):n=Bt(n),i=i===u?t<n?1:-1:Bt(i),pd(t,n,i,e)}}function zr(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=yt(t),n=yt(n)),e(t,n)}}function ja(e,t,n,i,o,l,d,f,m,A){var w=t&N,M=w?d:u,B=w?u:d,X=w?l:u,te=w?u:l;t|=w?j:k,t&=~(w?k:j),t&H||(t&=~(P|F));var ce=[e,t,o,X,M,te,B,f,m,A],ne=n.apply(u,ce);return ks(e)&&pu(ne,ce),ne.placeholder=i,du(ne,e,t)}function _s(e){var t=Le[e];return function(n,i){if(n=yt(n),i=i==null?0:$e(ue(i),292),i&&da(n)){var o=(ye(n)+"e").split("e"),l=t(o[0]+"e"+(+o[1]+i));return o=(ye(l)+"e").split("e"),+(o[0]+"e"+(+o[1]-i))}return t(n)}}var kd=Pn&&1/Tr(new Pn([,-0]))[1]==R?function(e){return new Pn(e)}:$s;function eu(e){return function(t){var n=We(t);return n==_t?Ji(t):n==bt?Hl(t):Ul(t,e(t))}}function Nt(e,t,n,i,o,l,d,f){var m=t&F;if(!m&&typeof e!="function")throw new gt(p);var A=i?i.length:0;if(A||(t&=~(j|k),i=o=u),d=d===u?d:De(ue(d),0),f=f===u?f:ue(f),A-=o?o.length:0,t&k){var w=i,M=o;i=o=u}var B=m?u:Ts(e),X=[e,t,n,i,o,w,M,l,d,f];if(B&&$d(X,B),e=X[0],t=X[1],n=X[2],i=X[3],o=X[4],f=X[9]=X[9]===u?m?0:e.length:De(X[9]-A,0),!f&&t&(N|Q)&&(t&=~(N|Q)),!t||t==P)var te=Sd(e,t,n);else t==N||t==Q?te=Ad(e,t,f):(t==j||t==(P|j))&&!o.length?te=wd(e,t,n,i):te=Vr.apply(u,X);var ce=B?La:pu;return du(ce(te,X),e,t)}function tu(e,t,n,i){return e===u||St(e,In[n])&&!_e.call(i,n)?t:e}function nu(e,t,n,i,o,l){return ke(e)&&ke(t)&&(l.set(t,e),Br(e,t,u,nu,l),l.delete(t)),e}function Id(e){return pr(e)?u:e}function ru(e,t,n,i,o,l){var d=n&y,f=e.length,m=t.length;if(f!=m&&!(d&&m>f))return!1;var A=l.get(e),w=l.get(t);if(A&&w)return A==t&&w==e;var M=-1,B=!0,X=n&v?new hn:u;for(l.set(e,t),l.set(t,e);++M<f;){var te=e[M],ce=t[M];if(i)var ne=d?i(ce,te,M,t,e,l):i(te,ce,M,e,t,l);if(ne!==u){if(ne)continue;B=!1;break}if(X){if(!Hi(t,function(pe,fe){if(!Xn(X,fe)&&(te===pe||o(te,pe,n,i,l)))return X.push(fe)})){B=!1;break}}else if(!(te===ce||o(te,ce,n,i,l))){B=!1;break}}return l.delete(e),l.delete(t),B}function Pd(e,t,n,i,o,l,d){switch(n){case Tn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Jn:return!(e.byteLength!=t.byteLength||!l(new Pr(e),new Pr(t)));case pt:case Me:case Kn:return St(+e,+t);case Yt:return e.name==t.name&&e.message==t.message;case Qn:case zn:return e==t+"";case _t:var f=Ji;case bt:var m=i&y;if(f||(f=Tr),e.size!=t.size&&!m)return!1;var A=d.get(e);if(A)return A==t;i|=v,d.set(e,t);var w=ru(f(e),f(t),i,o,l,d);return d.delete(e),w;case vr:if(nr)return nr.call(e)==nr.call(t)}return!1}function Rd(e,t,n,i,o,l){var d=n&y,f=bs(e),m=f.length,A=bs(t),w=A.length;if(m!=w&&!d)return!1;for(var M=m;M--;){var B=f[M];if(!(d?B in t:_e.call(t,B)))return!1}var X=l.get(e),te=l.get(t);if(X&&te)return X==t&&te==e;var ce=!0;l.set(e,t),l.set(t,e);for(var ne=d;++M<m;){B=f[M];var pe=e[B],fe=t[B];if(i)var ut=d?i(fe,pe,B,t,e,l):i(pe,fe,B,e,t,l);if(!(ut===u?pe===fe||o(pe,fe,n,i,l):ut)){ce=!1;break}ne||(ne=B=="constructor")}if(ce&&!ne){var Xe=e.constructor,ct=t.constructor;Xe!=ct&&"constructor"in e&&"constructor"in t&&!(typeof Xe=="function"&&Xe instanceof Xe&&typeof ct=="function"&&ct instanceof ct)&&(ce=!1)}return l.delete(e),l.delete(t),ce}function qt(e){return Ps(cu(e,u,Cu),e+"")}function bs(e){return Ta(e,qe,As)}function xs(e){return Ta(e,et,iu)}var Ts=Dr?function(e){return Dr.get(e)}:$s;function Yr(e){for(var t=e.name+"",n=Rn[t],i=_e.call(Rn,t)?n.length:0;i--;){var o=n[i],l=o.func;if(l==null||l==e)return o.name}return t}function Ln(e){var t=_e.call(c,"placeholder")?c:e;return t.placeholder}function ee(){var e=c.iteratee||Fs;return e=e===Fs?wa:e,arguments.length?e(arguments[0],arguments[1]):e}function Jr(e,t){var n=e.__data__;return qd(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Ss(e){for(var t=qe(e),n=t.length;n--;){var i=t[n],o=e[i];t[n]=[i,o,au(o)]}return t}function Cn(e,t){var n=Bl(e,t);return Aa(n)?n:u}function Ed(e){var t=_e.call(e,fn),n=e[fn];try{e[fn]=u;var i=!0}catch{}var o=kr.call(e);return i&&(t?e[fn]=n:delete e[fn]),o}var As=Zi?function(e){return e==null?[]:(e=be(e),Jt(Zi(e),function(t){return la.call(e,t)}))}:Ws,iu=Zi?function(e){for(var t=[];e;)Xt(t,As(e)),e=Rr(e);return t}:Ws,We=Ye;(ji&&We(new ji(new ArrayBuffer(1)))!=Tn||jn&&We(new jn)!=_t||es&&We(es.resolve())!=_o||Pn&&We(new Pn)!=bt||er&&We(new er)!=Yn)&&(We=function(e){var t=Ye(e),n=t==Ot?e.constructor:u,i=n?yn(n):"";if(i)switch(i){case fp:return Tn;case gp:return _t;case hp:return _o;case mp:return bt;case vp:return Yn}return t});function Md(e,t,n){for(var i=-1,o=n.length;++i<o;){var l=n[i],d=l.size;switch(l.type){case"drop":e+=d;break;case"dropRight":t-=d;break;case"take":t=$e(t,e+d);break;case"takeRight":e=De(e,t-d);break}}return{start:e,end:t}}function Od(e){var t=e.match(Gc);return t?t[1].split(Fc):[]}function su(e,t,n){t=rn(t,e);for(var i=-1,o=t.length,l=!1;++i<o;){var d=Et(t[i]);if(!(l=e!=null&&n(e,d)))break;e=e[d]}return l||++i!=o?l:(o=e==null?0:e.length,!!o&&ri(o)&&Gt(d,o)&&(oe(e)||_n(e)))}function Ld(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&_e.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function ou(e){return typeof e.constructor=="function"&&!cr(e)?En(Rr(e)):{}}function Dd(e,t,n){var i=e.constructor;switch(t){case Jn:return Cs(e);case pt:case Me:return new i(+e);case Tn:return Cd(e,n);case Si:case Ai:case wi:case ki:case Ii:case Pi:case Ri:case Ei:case Mi:return $a(e,n);case _t:return new i;case Kn:case zn:return new i(e);case Qn:return yd(e);case bt:return new i;case vr:return _d(e)}}function Ud(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(qc,`{
/* [wrapped with `+t+`] */
`)}function Nd(e){return oe(e)||_n(e)||!!(pa&&e&&e[pa])}function Gt(e,t){var n=typeof e;return t=t??J,!!t&&(n=="number"||n!="symbol"&&Yc.test(e))&&e>-1&&e%1==0&&e<t}function Je(e,t,n){if(!ke(n))return!1;var i=typeof t;return(i=="number"?je(n)&&Gt(t,n.length):i=="string"&&t in n)?St(n[t],e):!1}function ws(e,t){if(oe(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||at(e)?!0:Lc.test(e)||!Oc.test(e)||t!=null&&e in be(t)}function qd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ks(e){var t=Yr(e),n=c[t];if(typeof n!="function"||!(t in de.prototype))return!1;if(e===n)return!0;var i=Ts(n);return!!i&&e===i[0]}function Gd(e){return!!aa&&aa in e}var Fd=Ar?Ft:Hs;function cr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||In;return e===n}function au(e){return e===e&&!ke(e)}function uu(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==u||e in be(n))}}function Bd(e){var t=ti(e,function(i){return n.size===x&&n.clear(),i}),n=t.cache;return t}function $d(e,t){var n=e[1],i=t[1],o=n|i,l=o<(P|F|L),d=i==L&&n==N||i==L&&n==V&&e[7].length<=t[8]||i==(L|V)&&t[7].length<=t[8]&&n==N;if(!(l||d))return e;i&P&&(e[2]=t[2],o|=n&P?0:H);var f=t[3];if(f){var m=e[3];e[3]=m?Ha(m,f,t[4]):f,e[4]=m?Zt(e[3],T):t[4]}return f=t[5],f&&(m=e[5],e[5]=m?Va(m,f,t[6]):f,e[6]=m?Zt(e[5],T):t[6]),f=t[7],f&&(e[7]=f),i&L&&(e[8]=e[8]==null?t[8]:$e(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=o,e}function Wd(e){var t=[];if(e!=null)for(var n in be(e))t.push(n);return t}function Hd(e){return kr.call(e)}function cu(e,t,n){return t=De(t===u?e.length-1:t,0),function(){for(var i=arguments,o=-1,l=De(i.length-t,0),d=_(l);++o<l;)d[o]=i[t+o];o=-1;for(var f=_(t+1);++o<t;)f[o]=i[o];return f[t]=n(d),it(e,this,f)}}function lu(e,t){return t.length<2?e:vn(e,vt(t,0,-1))}function Vd(e,t){for(var n=e.length,i=$e(t.length,n),o=Ze(e);i--;){var l=t[i];e[i]=Gt(l,n)?o[l]:u}return e}function Is(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var pu=fu(La),lr=op||function(e,t){return Ne.setTimeout(e,t)},Ps=fu(gd);function du(e,t,n){var i=t+"";return Ps(e,Ud(i,Kd(Od(i),n)))}function fu(e){var t=0,n=0;return function(){var i=lp(),o=q-(i-n);if(n=i,o>0){if(++t>=ie)return arguments[0]}else t=0;return e.apply(u,arguments)}}function Xr(e,t){var n=-1,i=e.length,o=i-1;for(t=t===u?i:t;++n<t;){var l=ps(n,o),d=e[l];e[l]=e[n],e[n]=d}return e.length=t,e}var gu=Bd(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Dc,function(n,i,o,l){t.push(o?l.replace(Wc,"$1"):i||n)}),t});function Et(e){if(typeof e=="string"||at(e))return e;var t=e+"";return t=="0"&&1/e==-R?"-0":t}function yn(e){if(e!=null){try{return wr.call(e)}catch{}try{return e+""}catch{}}return""}function Kd(e,t){return ft(wt,function(n){var i="_."+n[0];t&n[1]&&!br(e,i)&&e.push(i)}),e.sort()}function hu(e){if(e instanceof de)return e.clone();var t=new ht(e.__wrapped__,e.__chain__);return t.__actions__=Ze(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Qd(e,t,n){(n?Je(e,t,n):t===u)?t=1:t=De(ue(t),0);var i=e==null?0:e.length;if(!i||t<1)return[];for(var o=0,l=0,d=_(Or(i/t));o<i;)d[l++]=vt(e,o,o+=t);return d}function zd(e){for(var t=-1,n=e==null?0:e.length,i=0,o=[];++t<n;){var l=e[t];l&&(o[i++]=l)}return o}function Yd(){var e=arguments.length;if(!e)return[];for(var t=_(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Xt(oe(n)?Ze(n):[n],Ge(t,1))}var Jd=le(function(e,t){return Pe(e)?ir(e,Ge(t,1,Pe,!0)):[]}),Xd=le(function(e,t){var n=Ct(t);return Pe(n)&&(n=u),Pe(e)?ir(e,Ge(t,1,Pe,!0),ee(n,2)):[]}),Zd=le(function(e,t){var n=Ct(t);return Pe(n)&&(n=u),Pe(e)?ir(e,Ge(t,1,Pe,!0),u,n):[]});function jd(e,t,n){var i=e==null?0:e.length;return i?(t=n||t===u?1:ue(t),vt(e,t<0?0:t,i)):[]}function ef(e,t,n){var i=e==null?0:e.length;return i?(t=n||t===u?1:ue(t),t=i-t,vt(e,0,t<0?0:t)):[]}function tf(e,t){return e&&e.length?Wr(e,ee(t,3),!0,!0):[]}function nf(e,t){return e&&e.length?Wr(e,ee(t,3),!0):[]}function rf(e,t,n,i){var o=e==null?0:e.length;return o?(n&&typeof n!="number"&&Je(e,t,n)&&(n=0,i=o),Yp(e,t,n,i)):[]}function mu(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var o=n==null?0:ue(n);return o<0&&(o=De(i+o,0)),xr(e,ee(t,3),o)}function vu(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var o=i-1;return n!==u&&(o=ue(n),o=n<0?De(i+o,0):$e(o,i-1)),xr(e,ee(t,3),o,!0)}function Cu(e){var t=e==null?0:e.length;return t?Ge(e,1):[]}function sf(e){var t=e==null?0:e.length;return t?Ge(e,R):[]}function of(e,t){var n=e==null?0:e.length;return n?(t=t===u?1:ue(t),Ge(e,t)):[]}function af(e){for(var t=-1,n=e==null?0:e.length,i={};++t<n;){var o=e[t];i[o[0]]=o[1]}return i}function yu(e){return e&&e.length?e[0]:u}function uf(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var o=n==null?0:ue(n);return o<0&&(o=De(i+o,0)),An(e,t,o)}function cf(e){var t=e==null?0:e.length;return t?vt(e,0,-1):[]}var lf=le(function(e){var t=we(e,ms);return t.length&&t[0]===e[0]?os(t):[]}),pf=le(function(e){var t=Ct(e),n=we(e,ms);return t===Ct(n)?t=u:n.pop(),n.length&&n[0]===e[0]?os(n,ee(t,2)):[]}),df=le(function(e){var t=Ct(e),n=we(e,ms);return t=typeof t=="function"?t:u,t&&n.pop(),n.length&&n[0]===e[0]?os(n,u,t):[]});function ff(e,t){return e==null?"":up.call(e,t)}function Ct(e){var t=e==null?0:e.length;return t?e[t-1]:u}function gf(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var o=i;return n!==u&&(o=ue(n),o=o<0?De(i+o,0):$e(o,i-1)),t===t?Kl(e,t,o):xr(e,jo,o,!0)}function hf(e,t){return e&&e.length?Ra(e,ue(t)):u}var mf=le(_u);function _u(e,t){return e&&e.length&&t&&t.length?ls(e,t):e}function vf(e,t,n){return e&&e.length&&t&&t.length?ls(e,t,ee(n,2)):e}function Cf(e,t,n){return e&&e.length&&t&&t.length?ls(e,t,u,n):e}var yf=qt(function(e,t){var n=e==null?0:e.length,i=ns(e,t);return Oa(e,we(t,function(o){return Gt(o,n)?+o:o}).sort(Wa)),i});function _f(e,t){var n=[];if(!(e&&e.length))return n;var i=-1,o=[],l=e.length;for(t=ee(t,3);++i<l;){var d=e[i];t(d,i,e)&&(n.push(d),o.push(i))}return Oa(e,o),n}function Rs(e){return e==null?e:dp.call(e)}function bf(e,t,n){var i=e==null?0:e.length;return i?(n&&typeof n!="number"&&Je(e,t,n)?(t=0,n=i):(t=t==null?0:ue(t),n=n===u?i:ue(n)),vt(e,t,n)):[]}function xf(e,t){return $r(e,t)}function Tf(e,t,n){return fs(e,t,ee(n,2))}function Sf(e,t){var n=e==null?0:e.length;if(n){var i=$r(e,t);if(i<n&&St(e[i],t))return i}return-1}function Af(e,t){return $r(e,t,!0)}function wf(e,t,n){return fs(e,t,ee(n,2),!0)}function kf(e,t){var n=e==null?0:e.length;if(n){var i=$r(e,t,!0)-1;if(St(e[i],t))return i}return-1}function If(e){return e&&e.length?Da(e):[]}function Pf(e,t){return e&&e.length?Da(e,ee(t,2)):[]}function Rf(e){var t=e==null?0:e.length;return t?vt(e,1,t):[]}function Ef(e,t,n){return e&&e.length?(t=n||t===u?1:ue(t),vt(e,0,t<0?0:t)):[]}function Mf(e,t,n){var i=e==null?0:e.length;return i?(t=n||t===u?1:ue(t),t=i-t,vt(e,t<0?0:t,i)):[]}function Of(e,t){return e&&e.length?Wr(e,ee(t,3),!1,!0):[]}function Lf(e,t){return e&&e.length?Wr(e,ee(t,3)):[]}var Df=le(function(e){return nn(Ge(e,1,Pe,!0))}),Uf=le(function(e){var t=Ct(e);return Pe(t)&&(t=u),nn(Ge(e,1,Pe,!0),ee(t,2))}),Nf=le(function(e){var t=Ct(e);return t=typeof t=="function"?t:u,nn(Ge(e,1,Pe,!0),u,t)});function qf(e){return e&&e.length?nn(e):[]}function Gf(e,t){return e&&e.length?nn(e,ee(t,2)):[]}function Ff(e,t){return t=typeof t=="function"?t:u,e&&e.length?nn(e,u,t):[]}function Es(e){if(!(e&&e.length))return[];var t=0;return e=Jt(e,function(n){if(Pe(n))return t=De(n.length,t),!0}),zi(t,function(n){return we(e,Vi(n))})}function bu(e,t){if(!(e&&e.length))return[];var n=Es(e);return t==null?n:we(n,function(i){return it(t,u,i)})}var Bf=le(function(e,t){return Pe(e)?ir(e,t):[]}),$f=le(function(e){return hs(Jt(e,Pe))}),Wf=le(function(e){var t=Ct(e);return Pe(t)&&(t=u),hs(Jt(e,Pe),ee(t,2))}),Hf=le(function(e){var t=Ct(e);return t=typeof t=="function"?t:u,hs(Jt(e,Pe),u,t)}),Vf=le(Es);function Kf(e,t){return Ga(e||[],t||[],rr)}function Qf(e,t){return Ga(e||[],t||[],ar)}var zf=le(function(e){var t=e.length,n=t>1?e[t-1]:u;return n=typeof n=="function"?(e.pop(),n):u,bu(e,n)});function xu(e){var t=c(e);return t.__chain__=!0,t}function Yf(e,t){return t(e),e}function Zr(e,t){return t(e)}var Jf=qt(function(e){var t=e.length,n=t?e[0]:0,i=this.__wrapped__,o=function(l){return ns(l,e)};return t>1||this.__actions__.length||!(i instanceof de)||!Gt(n)?this.thru(o):(i=i.slice(n,+n+(t?1:0)),i.__actions__.push({func:Zr,args:[o],thisArg:u}),new ht(i,this.__chain__).thru(function(l){return t&&!l.length&&l.push(u),l}))});function Xf(){return xu(this)}function Zf(){return new ht(this.value(),this.__chain__)}function jf(){this.__values__===u&&(this.__values__=Uu(this.value()));var e=this.__index__>=this.__values__.length,t=e?u:this.__values__[this.__index__++];return{done:e,value:t}}function eg(){return this}function tg(e){for(var t,n=this;n instanceof Nr;){var i=hu(n);i.__index__=0,i.__values__=u,t?o.__wrapped__=i:t=i;var o=i;n=n.__wrapped__}return o.__wrapped__=e,t}function ng(){var e=this.__wrapped__;if(e instanceof de){var t=e;return this.__actions__.length&&(t=new de(this)),t=t.reverse(),t.__actions__.push({func:Zr,args:[Rs],thisArg:u}),new ht(t,this.__chain__)}return this.thru(Rs)}function rg(){return qa(this.__wrapped__,this.__actions__)}var ig=Hr(function(e,t,n){_e.call(e,n)?++e[n]:Ut(e,n,1)});function sg(e,t,n){var i=oe(e)?Xo:zp;return n&&Je(e,t,n)&&(t=u),i(e,ee(t,3))}function og(e,t){var n=oe(e)?Jt:ba;return n(e,ee(t,3))}var ag=Ya(mu),ug=Ya(vu);function cg(e,t){return Ge(jr(e,t),1)}function lg(e,t){return Ge(jr(e,t),R)}function pg(e,t,n){return n=n===u?1:ue(n),Ge(jr(e,t),n)}function Tu(e,t){var n=oe(e)?ft:tn;return n(e,ee(t,3))}function Su(e,t){var n=oe(e)?Pl:_a;return n(e,ee(t,3))}var dg=Hr(function(e,t,n){_e.call(e,n)?e[n].push(t):Ut(e,n,[t])});function fg(e,t,n,i){e=je(e)?e:Un(e),n=n&&!i?ue(n):0;var o=e.length;return n<0&&(n=De(o+n,0)),ii(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&An(e,t,n)>-1}var gg=le(function(e,t,n){var i=-1,o=typeof t=="function",l=je(e)?_(e.length):[];return tn(e,function(d){l[++i]=o?it(t,d,n):sr(d,t,n)}),l}),hg=Hr(function(e,t,n){Ut(e,n,t)});function jr(e,t){var n=oe(e)?we:ka;return n(e,ee(t,3))}function mg(e,t,n,i){return e==null?[]:(oe(t)||(t=t==null?[]:[t]),n=i?u:n,oe(n)||(n=n==null?[]:[n]),Ea(e,t,n))}var vg=Hr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function Cg(e,t,n){var i=oe(e)?Wi:ta,o=arguments.length<3;return i(e,ee(t,4),n,o,tn)}function yg(e,t,n){var i=oe(e)?Rl:ta,o=arguments.length<3;return i(e,ee(t,4),n,o,_a)}function _g(e,t){var n=oe(e)?Jt:ba;return n(e,ni(ee(t,3)))}function bg(e){var t=oe(e)?ma:dd;return t(e)}function xg(e,t,n){(n?Je(e,t,n):t===u)?t=1:t=ue(t);var i=oe(e)?Wp:fd;return i(e,t)}function Tg(e){var t=oe(e)?Hp:hd;return t(e)}function Sg(e){if(e==null)return 0;if(je(e))return ii(e)?kn(e):e.length;var t=We(e);return t==_t||t==bt?e.size:us(e).length}function Ag(e,t,n){var i=oe(e)?Hi:md;return n&&Je(e,t,n)&&(t=u),i(e,ee(t,3))}var wg=le(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Je(e,t[0],t[1])?t=[]:n>2&&Je(t[0],t[1],t[2])&&(t=[t[0]]),Ea(e,Ge(t,1),[])}),ei=sp||function(){return Ne.Date.now()};function kg(e,t){if(typeof t!="function")throw new gt(p);return e=ue(e),function(){if(--e<1)return t.apply(this,arguments)}}function Au(e,t,n){return t=n?u:t,t=e&&t==null?e.length:t,Nt(e,L,u,u,u,u,t)}function wu(e,t){var n;if(typeof t!="function")throw new gt(p);return e=ue(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=u),n}}var Ms=le(function(e,t,n){var i=P;if(n.length){var o=Zt(n,Ln(Ms));i|=j}return Nt(e,i,t,n,o)}),ku=le(function(e,t,n){var i=P|F;if(n.length){var o=Zt(n,Ln(ku));i|=j}return Nt(t,i,e,n,o)});function Iu(e,t,n){t=n?u:t;var i=Nt(e,N,u,u,u,u,u,t);return i.placeholder=Iu.placeholder,i}function Pu(e,t,n){t=n?u:t;var i=Nt(e,Q,u,u,u,u,u,t);return i.placeholder=Pu.placeholder,i}function Ru(e,t,n){var i,o,l,d,f,m,A=0,w=!1,M=!1,B=!0;if(typeof e!="function")throw new gt(p);t=yt(t)||0,ke(n)&&(w=!!n.leading,M="maxWait"in n,l=M?De(yt(n.maxWait)||0,t):l,B="trailing"in n?!!n.trailing:B);function X(Re){var At=i,$t=o;return i=o=u,A=Re,d=e.apply($t,At),d}function te(Re){return A=Re,f=lr(pe,t),w?X(Re):d}function ce(Re){var At=Re-m,$t=Re-A,Yu=t-At;return M?$e(Yu,l-$t):Yu}function ne(Re){var At=Re-m,$t=Re-A;return m===u||At>=t||At<0||M&&$t>=l}function pe(){var Re=ei();if(ne(Re))return fe(Re);f=lr(pe,ce(Re))}function fe(Re){return f=u,B&&i?X(Re):(i=o=u,d)}function ut(){f!==u&&Fa(f),A=0,i=m=o=f=u}function Xe(){return f===u?d:fe(ei())}function ct(){var Re=ei(),At=ne(Re);if(i=arguments,o=this,m=Re,At){if(f===u)return te(m);if(M)return Fa(f),f=lr(pe,t),X(m)}return f===u&&(f=lr(pe,t)),d}return ct.cancel=ut,ct.flush=Xe,ct}var Ig=le(function(e,t){return ya(e,1,t)}),Pg=le(function(e,t,n){return ya(e,yt(t)||0,n)});function Rg(e){return Nt(e,K)}function ti(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new gt(p);var n=function(){var i=arguments,o=t?t.apply(this,i):i[0],l=n.cache;if(l.has(o))return l.get(o);var d=e.apply(this,i);return n.cache=l.set(o,d)||l,d};return n.cache=new(ti.Cache||Dt),n}ti.Cache=Dt;function ni(e){if(typeof e!="function")throw new gt(p);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Eg(e){return wu(2,e)}var Mg=vd(function(e,t){t=t.length==1&&oe(t[0])?we(t[0],st(ee())):we(Ge(t,1),st(ee()));var n=t.length;return le(function(i){for(var o=-1,l=$e(i.length,n);++o<l;)i[o]=t[o].call(this,i[o]);return it(e,this,i)})}),Os=le(function(e,t){var n=Zt(t,Ln(Os));return Nt(e,j,u,t,n)}),Eu=le(function(e,t){var n=Zt(t,Ln(Eu));return Nt(e,k,u,t,n)}),Og=qt(function(e,t){return Nt(e,V,u,u,u,t)});function Lg(e,t){if(typeof e!="function")throw new gt(p);return t=t===u?t:ue(t),le(e,t)}function Dg(e,t){if(typeof e!="function")throw new gt(p);return t=t==null?0:De(ue(t),0),le(function(n){var i=n[t],o=sn(n,0,t);return i&&Xt(o,i),it(e,this,o)})}function Ug(e,t,n){var i=!0,o=!0;if(typeof e!="function")throw new gt(p);return ke(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),Ru(e,t,{leading:i,maxWait:t,trailing:o})}function Ng(e){return Au(e,1)}function qg(e,t){return Os(vs(t),e)}function Gg(){if(!arguments.length)return[];var e=arguments[0];return oe(e)?e:[e]}function Fg(e){return mt(e,O)}function Bg(e,t){return t=typeof t=="function"?t:u,mt(e,O,t)}function $g(e){return mt(e,D|O)}function Wg(e,t){return t=typeof t=="function"?t:u,mt(e,D|O,t)}function Hg(e,t){return t==null||Ca(e,t,qe(t))}function St(e,t){return e===t||e!==e&&t!==t}var Vg=zr(ss),Kg=zr(function(e,t){return e>=t}),_n=Sa(function(){return arguments}())?Sa:function(e){return Ie(e)&&_e.call(e,"callee")&&!la.call(e,"callee")},oe=_.isArray,Qg=Vo?st(Vo):ed;function je(e){return e!=null&&ri(e.length)&&!Ft(e)}function Pe(e){return Ie(e)&&je(e)}function zg(e){return e===!0||e===!1||Ie(e)&&Ye(e)==pt}var on=ap||Hs,Yg=Ko?st(Ko):td;function Jg(e){return Ie(e)&&e.nodeType===1&&!pr(e)}function Xg(e){if(e==null)return!0;if(je(e)&&(oe(e)||typeof e=="string"||typeof e.splice=="function"||on(e)||Dn(e)||_n(e)))return!e.length;var t=We(e);if(t==_t||t==bt)return!e.size;if(cr(e))return!us(e).length;for(var n in e)if(_e.call(e,n))return!1;return!0}function Zg(e,t){return or(e,t)}function jg(e,t,n){n=typeof n=="function"?n:u;var i=n?n(e,t):u;return i===u?or(e,t,u,n):!!i}function Ls(e){if(!Ie(e))return!1;var t=Ye(e);return t==Yt||t==It||typeof e.message=="string"&&typeof e.name=="string"&&!pr(e)}function eh(e){return typeof e=="number"&&da(e)}function Ft(e){if(!ke(e))return!1;var t=Ye(e);return t==Mt||t==yo||t==pn||t==Tc}function Mu(e){return typeof e=="number"&&e==ue(e)}function ri(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ke(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ie(e){return e!=null&&typeof e=="object"}var Ou=Qo?st(Qo):rd;function th(e,t){return e===t||as(e,t,Ss(t))}function nh(e,t,n){return n=typeof n=="function"?n:u,as(e,t,Ss(t),n)}function rh(e){return Lu(e)&&e!=+e}function ih(e){if(Fd(e))throw new se(a);return Aa(e)}function sh(e){return e===null}function oh(e){return e==null}function Lu(e){return typeof e=="number"||Ie(e)&&Ye(e)==Kn}function pr(e){if(!Ie(e)||Ye(e)!=Ot)return!1;var t=Rr(e);if(t===null)return!0;var n=_e.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&wr.call(n)==tp}var Ds=zo?st(zo):id;function ah(e){return Mu(e)&&e>=-J&&e<=J}var Du=Yo?st(Yo):sd;function ii(e){return typeof e=="string"||!oe(e)&&Ie(e)&&Ye(e)==zn}function at(e){return typeof e=="symbol"||Ie(e)&&Ye(e)==vr}var Dn=Jo?st(Jo):od;function uh(e){return e===u}function ch(e){return Ie(e)&&We(e)==Yn}function lh(e){return Ie(e)&&Ye(e)==Ac}var ph=zr(cs),dh=zr(function(e,t){return e<=t});function Uu(e){if(!e)return[];if(je(e))return ii(e)?xt(e):Ze(e);if(Zn&&e[Zn])return Wl(e[Zn]());var t=We(e),n=t==_t?Ji:t==bt?Tr:Un;return n(e)}function Bt(e){if(!e)return e===0?e:0;if(e=yt(e),e===R||e===-R){var t=e<0?-1:1;return t*re}return e===e?e:0}function ue(e){var t=Bt(e),n=t%1;return t===t?n?t-n:t:0}function Nu(e){return e?mn(ue(e),0,ve):0}function yt(e){if(typeof e=="number")return e;if(at(e))return he;if(ke(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ke(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=na(e);var n=Kc.test(e);return n||zc.test(e)?wl(e.slice(2),n?2:8):Vc.test(e)?he:+e}function qu(e){return Rt(e,et(e))}function fh(e){return e?mn(ue(e),-J,J):e===0?e:0}function ye(e){return e==null?"":ot(e)}var gh=Mn(function(e,t){if(cr(t)||je(t)){Rt(t,qe(t),e);return}for(var n in t)_e.call(t,n)&&rr(e,n,t[n])}),Gu=Mn(function(e,t){Rt(t,et(t),e)}),si=Mn(function(e,t,n,i){Rt(t,et(t),e,i)}),hh=Mn(function(e,t,n,i){Rt(t,qe(t),e,i)}),mh=qt(ns);function vh(e,t){var n=En(e);return t==null?n:va(n,t)}var Ch=le(function(e,t){e=be(e);var n=-1,i=t.length,o=i>2?t[2]:u;for(o&&Je(t[0],t[1],o)&&(i=1);++n<i;)for(var l=t[n],d=et(l),f=-1,m=d.length;++f<m;){var A=d[f],w=e[A];(w===u||St(w,In[A])&&!_e.call(e,A))&&(e[A]=l[A])}return e}),yh=le(function(e){return e.push(u,nu),it(Fu,u,e)});function _h(e,t){return Zo(e,ee(t,3),Pt)}function bh(e,t){return Zo(e,ee(t,3),is)}function xh(e,t){return e==null?e:rs(e,ee(t,3),et)}function Th(e,t){return e==null?e:xa(e,ee(t,3),et)}function Sh(e,t){return e&&Pt(e,ee(t,3))}function Ah(e,t){return e&&is(e,ee(t,3))}function wh(e){return e==null?[]:Fr(e,qe(e))}function kh(e){return e==null?[]:Fr(e,et(e))}function Us(e,t,n){var i=e==null?u:vn(e,t);return i===u?n:i}function Ih(e,t){return e!=null&&su(e,t,Jp)}function Ns(e,t){return e!=null&&su(e,t,Xp)}var Ph=Xa(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=kr.call(t)),e[t]=n},Gs(tt)),Rh=Xa(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=kr.call(t)),_e.call(e,t)?e[t].push(n):e[t]=[n]},ee),Eh=le(sr);function qe(e){return je(e)?ha(e):us(e)}function et(e){return je(e)?ha(e,!0):ad(e)}function Mh(e,t){var n={};return t=ee(t,3),Pt(e,function(i,o,l){Ut(n,t(i,o,l),i)}),n}function Oh(e,t){var n={};return t=ee(t,3),Pt(e,function(i,o,l){Ut(n,o,t(i,o,l))}),n}var Lh=Mn(function(e,t,n){Br(e,t,n)}),Fu=Mn(function(e,t,n,i){Br(e,t,n,i)}),Dh=qt(function(e,t){var n={};if(e==null)return n;var i=!1;t=we(t,function(l){return l=rn(l,e),i||(i=l.length>1),l}),Rt(e,xs(e),n),i&&(n=mt(n,D|$|O,Id));for(var o=t.length;o--;)gs(n,t[o]);return n});function Uh(e,t){return Bu(e,ni(ee(t)))}var Nh=qt(function(e,t){return e==null?{}:cd(e,t)});function Bu(e,t){if(e==null)return{};var n=we(xs(e),function(i){return[i]});return t=ee(t),Ma(e,n,function(i,o){return t(i,o[0])})}function qh(e,t,n){t=rn(t,e);var i=-1,o=t.length;for(o||(o=1,e=u);++i<o;){var l=e==null?u:e[Et(t[i])];l===u&&(i=o,l=n),e=Ft(l)?l.call(e):l}return e}function Gh(e,t,n){return e==null?e:ar(e,t,n)}function Fh(e,t,n,i){return i=typeof i=="function"?i:u,e==null?e:ar(e,t,n,i)}var $u=eu(qe),Wu=eu(et);function Bh(e,t,n){var i=oe(e),o=i||on(e)||Dn(e);if(t=ee(t,4),n==null){var l=e&&e.constructor;o?n=i?new l:[]:ke(e)?n=Ft(l)?En(Rr(e)):{}:n={}}return(o?ft:Pt)(e,function(d,f,m){return t(n,d,f,m)}),n}function $h(e,t){return e==null?!0:gs(e,t)}function Wh(e,t,n){return e==null?e:Na(e,t,vs(n))}function Hh(e,t,n,i){return i=typeof i=="function"?i:u,e==null?e:Na(e,t,vs(n),i)}function Un(e){return e==null?[]:Yi(e,qe(e))}function Vh(e){return e==null?[]:Yi(e,et(e))}function Kh(e,t,n){return n===u&&(n=t,t=u),n!==u&&(n=yt(n),n=n===n?n:0),t!==u&&(t=yt(t),t=t===t?t:0),mn(yt(e),t,n)}function Qh(e,t,n){return t=Bt(t),n===u?(n=t,t=0):n=Bt(n),e=yt(e),Zp(e,t,n)}function zh(e,t,n){if(n&&typeof n!="boolean"&&Je(e,t,n)&&(t=n=u),n===u&&(typeof t=="boolean"?(n=t,t=u):typeof e=="boolean"&&(n=e,e=u)),e===u&&t===u?(e=0,t=1):(e=Bt(e),t===u?(t=e,e=0):t=Bt(t)),e>t){var i=e;e=t,t=i}if(n||e%1||t%1){var o=fa();return $e(e+o*(t-e+Al("1e-"+((o+"").length-1))),t)}return ps(e,t)}var Yh=On(function(e,t,n){return t=t.toLowerCase(),e+(n?Hu(t):t)});function Hu(e){return qs(ye(e).toLowerCase())}function Vu(e){return e=ye(e),e&&e.replace(Jc,ql).replace(hl,"")}function Jh(e,t,n){e=ye(e),t=ot(t);var i=e.length;n=n===u?i:mn(ue(n),0,i);var o=n;return n-=t.length,n>=0&&e.slice(n,o)==t}function Xh(e){return e=ye(e),e&&Rc.test(e)?e.replace(xo,Gl):e}function Zh(e){return e=ye(e),e&&Uc.test(e)?e.replace(Oi,"\\$&"):e}var jh=On(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),em=On(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),tm=za("toLowerCase");function nm(e,t,n){e=ye(e),t=ue(t);var i=t?kn(e):0;if(!t||i>=t)return e;var o=(t-i)/2;return Qr(Lr(o),n)+e+Qr(Or(o),n)}function rm(e,t,n){e=ye(e),t=ue(t);var i=t?kn(e):0;return t&&i<t?e+Qr(t-i,n):e}function im(e,t,n){e=ye(e),t=ue(t);var i=t?kn(e):0;return t&&i<t?Qr(t-i,n)+e:e}function sm(e,t,n){return n||t==null?t=0:t&&(t=+t),pp(ye(e).replace(Li,""),t||0)}function om(e,t,n){return(n?Je(e,t,n):t===u)?t=1:t=ue(t),ds(ye(e),t)}function am(){var e=arguments,t=ye(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var um=On(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function cm(e,t,n){return n&&typeof n!="number"&&Je(e,t,n)&&(t=n=u),n=n===u?ve:n>>>0,n?(e=ye(e),e&&(typeof t=="string"||t!=null&&!Ds(t))&&(t=ot(t),!t&&wn(e))?sn(xt(e),0,n):e.split(t,n)):[]}var lm=On(function(e,t,n){return e+(n?" ":"")+qs(t)});function pm(e,t,n){return e=ye(e),n=n==null?0:mn(ue(n),0,e.length),t=ot(t),e.slice(n,n+t.length)==t}function dm(e,t,n){var i=c.templateSettings;n&&Je(e,t,n)&&(t=u),e=ye(e),t=si({},t,i,tu);var o=si({},t.imports,i.imports,tu),l=qe(o),d=Yi(o,l),f,m,A=0,w=t.interpolate||Cr,M="__p += '",B=Xi((t.escape||Cr).source+"|"+w.source+"|"+(w===To?Hc:Cr).source+"|"+(t.evaluate||Cr).source+"|$","g"),X="//# sourceURL="+(_e.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++_l+"]")+`
`;e.replace(B,function(ne,pe,fe,ut,Xe,ct){return fe||(fe=ut),M+=e.slice(A,ct).replace(Xc,Fl),pe&&(f=!0,M+=`' +
__e(`+pe+`) +
'`),Xe&&(m=!0,M+=`';
`+Xe+`;
__p += '`),fe&&(M+=`' +
((__t = (`+fe+`)) == null ? '' : __t) +
'`),A=ct+ne.length,ne}),M+=`';
`;var te=_e.call(t,"variable")&&t.variable;if(!te)M=`with (obj) {
`+M+`
}
`;else if($c.test(te))throw new se(g);M=(m?M.replace(wc,""):M).replace(kc,"$1").replace(Ic,"$1;"),M="function("+(te||"obj")+`) {
`+(te?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(f?", __e = _.escape":"")+(m?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+M+`return __p
}`;var ce=Qu(function(){return Ce(l,X+"return "+M).apply(u,d)});if(ce.source=M,Ls(ce))throw ce;return ce}function fm(e){return ye(e).toLowerCase()}function gm(e){return ye(e).toUpperCase()}function hm(e,t,n){if(e=ye(e),e&&(n||t===u))return na(e);if(!e||!(t=ot(t)))return e;var i=xt(e),o=xt(t),l=ra(i,o),d=ia(i,o)+1;return sn(i,l,d).join("")}function mm(e,t,n){if(e=ye(e),e&&(n||t===u))return e.slice(0,oa(e)+1);if(!e||!(t=ot(t)))return e;var i=xt(e),o=ia(i,xt(t))+1;return sn(i,0,o).join("")}function vm(e,t,n){if(e=ye(e),e&&(n||t===u))return e.replace(Li,"");if(!e||!(t=ot(t)))return e;var i=xt(e),o=ra(i,xt(t));return sn(i,o).join("")}function Cm(e,t){var n=Y,i=W;if(ke(t)){var o="separator"in t?t.separator:o;n="length"in t?ue(t.length):n,i="omission"in t?ot(t.omission):i}e=ye(e);var l=e.length;if(wn(e)){var d=xt(e);l=d.length}if(n>=l)return e;var f=n-kn(i);if(f<1)return i;var m=d?sn(d,0,f).join(""):e.slice(0,f);if(o===u)return m+i;if(d&&(f+=m.length-f),Ds(o)){if(e.slice(f).search(o)){var A,w=m;for(o.global||(o=Xi(o.source,ye(So.exec(o))+"g")),o.lastIndex=0;A=o.exec(w);)var M=A.index;m=m.slice(0,M===u?f:M)}}else if(e.indexOf(ot(o),f)!=f){var B=m.lastIndexOf(o);B>-1&&(m=m.slice(0,B))}return m+i}function ym(e){return e=ye(e),e&&Pc.test(e)?e.replace(bo,Ql):e}var _m=On(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),qs=za("toUpperCase");function Ku(e,t,n){return e=ye(e),t=n?u:t,t===u?$l(e)?Jl(e):Ol(e):e.match(t)||[]}var Qu=le(function(e,t){try{return it(e,u,t)}catch(n){return Ls(n)?n:new se(n)}}),bm=qt(function(e,t){return ft(t,function(n){n=Et(n),Ut(e,n,Ms(e[n],e))}),e});function xm(e){var t=e==null?0:e.length,n=ee();return e=t?we(e,function(i){if(typeof i[1]!="function")throw new gt(p);return[n(i[0]),i[1]]}):[],le(function(i){for(var o=-1;++o<t;){var l=e[o];if(it(l[0],this,i))return it(l[1],this,i)}})}function Tm(e){return Qp(mt(e,D))}function Gs(e){return function(){return e}}function Sm(e,t){return e==null||e!==e?t:e}var Am=Ja(),wm=Ja(!0);function tt(e){return e}function Fs(e){return wa(typeof e=="function"?e:mt(e,D))}function km(e){return Ia(mt(e,D))}function Im(e,t){return Pa(e,mt(t,D))}var Pm=le(function(e,t){return function(n){return sr(n,e,t)}}),Rm=le(function(e,t){return function(n){return sr(e,n,t)}});function Bs(e,t,n){var i=qe(t),o=Fr(t,i);n==null&&!(ke(t)&&(o.length||!i.length))&&(n=t,t=e,e=this,o=Fr(t,qe(t)));var l=!(ke(n)&&"chain"in n)||!!n.chain,d=Ft(e);return ft(o,function(f){var m=t[f];e[f]=m,d&&(e.prototype[f]=function(){var A=this.__chain__;if(l||A){var w=e(this.__wrapped__),M=w.__actions__=Ze(this.__actions__);return M.push({func:m,args:arguments,thisArg:e}),w.__chain__=A,w}return m.apply(e,Xt([this.value()],arguments))})}),e}function Em(){return Ne._===this&&(Ne._=np),this}function $s(){}function Mm(e){return e=ue(e),le(function(t){return Ra(t,e)})}var Om=ys(we),Lm=ys(Xo),Dm=ys(Hi);function zu(e){return ws(e)?Vi(Et(e)):ld(e)}function Um(e){return function(t){return e==null?u:vn(e,t)}}var Nm=Za(),qm=Za(!0);function Ws(){return[]}function Hs(){return!1}function Gm(){return{}}function Fm(){return""}function Bm(){return!0}function $m(e,t){if(e=ue(e),e<1||e>J)return[];var n=ve,i=$e(e,ve);t=ee(t),e-=ve;for(var o=zi(i,t);++n<e;)t(n);return o}function Wm(e){return oe(e)?we(e,Et):at(e)?[e]:Ze(gu(ye(e)))}function Hm(e){var t=++ep;return ye(e)+t}var Vm=Kr(function(e,t){return e+t},0),Km=_s("ceil"),Qm=Kr(function(e,t){return e/t},1),zm=_s("floor");function Ym(e){return e&&e.length?Gr(e,tt,ss):u}function Jm(e,t){return e&&e.length?Gr(e,ee(t,2),ss):u}function Xm(e){return ea(e,tt)}function Zm(e,t){return ea(e,ee(t,2))}function jm(e){return e&&e.length?Gr(e,tt,cs):u}function ev(e,t){return e&&e.length?Gr(e,ee(t,2),cs):u}var tv=Kr(function(e,t){return e*t},1),nv=_s("round"),rv=Kr(function(e,t){return e-t},0);function iv(e){return e&&e.length?Qi(e,tt):0}function sv(e,t){return e&&e.length?Qi(e,ee(t,2)):0}return c.after=kg,c.ary=Au,c.assign=gh,c.assignIn=Gu,c.assignInWith=si,c.assignWith=hh,c.at=mh,c.before=wu,c.bind=Ms,c.bindAll=bm,c.bindKey=ku,c.castArray=Gg,c.chain=xu,c.chunk=Qd,c.compact=zd,c.concat=Yd,c.cond=xm,c.conforms=Tm,c.constant=Gs,c.countBy=ig,c.create=vh,c.curry=Iu,c.curryRight=Pu,c.debounce=Ru,c.defaults=Ch,c.defaultsDeep=yh,c.defer=Ig,c.delay=Pg,c.difference=Jd,c.differenceBy=Xd,c.differenceWith=Zd,c.drop=jd,c.dropRight=ef,c.dropRightWhile=tf,c.dropWhile=nf,c.fill=rf,c.filter=og,c.flatMap=cg,c.flatMapDeep=lg,c.flatMapDepth=pg,c.flatten=Cu,c.flattenDeep=sf,c.flattenDepth=of,c.flip=Rg,c.flow=Am,c.flowRight=wm,c.fromPairs=af,c.functions=wh,c.functionsIn=kh,c.groupBy=dg,c.initial=cf,c.intersection=lf,c.intersectionBy=pf,c.intersectionWith=df,c.invert=Ph,c.invertBy=Rh,c.invokeMap=gg,c.iteratee=Fs,c.keyBy=hg,c.keys=qe,c.keysIn=et,c.map=jr,c.mapKeys=Mh,c.mapValues=Oh,c.matches=km,c.matchesProperty=Im,c.memoize=ti,c.merge=Lh,c.mergeWith=Fu,c.method=Pm,c.methodOf=Rm,c.mixin=Bs,c.negate=ni,c.nthArg=Mm,c.omit=Dh,c.omitBy=Uh,c.once=Eg,c.orderBy=mg,c.over=Om,c.overArgs=Mg,c.overEvery=Lm,c.overSome=Dm,c.partial=Os,c.partialRight=Eu,c.partition=vg,c.pick=Nh,c.pickBy=Bu,c.property=zu,c.propertyOf=Um,c.pull=mf,c.pullAll=_u,c.pullAllBy=vf,c.pullAllWith=Cf,c.pullAt=yf,c.range=Nm,c.rangeRight=qm,c.rearg=Og,c.reject=_g,c.remove=_f,c.rest=Lg,c.reverse=Rs,c.sampleSize=xg,c.set=Gh,c.setWith=Fh,c.shuffle=Tg,c.slice=bf,c.sortBy=wg,c.sortedUniq=If,c.sortedUniqBy=Pf,c.split=cm,c.spread=Dg,c.tail=Rf,c.take=Ef,c.takeRight=Mf,c.takeRightWhile=Of,c.takeWhile=Lf,c.tap=Yf,c.throttle=Ug,c.thru=Zr,c.toArray=Uu,c.toPairs=$u,c.toPairsIn=Wu,c.toPath=Wm,c.toPlainObject=qu,c.transform=Bh,c.unary=Ng,c.union=Df,c.unionBy=Uf,c.unionWith=Nf,c.uniq=qf,c.uniqBy=Gf,c.uniqWith=Ff,c.unset=$h,c.unzip=Es,c.unzipWith=bu,c.update=Wh,c.updateWith=Hh,c.values=Un,c.valuesIn=Vh,c.without=Bf,c.words=Ku,c.wrap=qg,c.xor=$f,c.xorBy=Wf,c.xorWith=Hf,c.zip=Vf,c.zipObject=Kf,c.zipObjectDeep=Qf,c.zipWith=zf,c.entries=$u,c.entriesIn=Wu,c.extend=Gu,c.extendWith=si,Bs(c,c),c.add=Vm,c.attempt=Qu,c.camelCase=Yh,c.capitalize=Hu,c.ceil=Km,c.clamp=Kh,c.clone=Fg,c.cloneDeep=$g,c.cloneDeepWith=Wg,c.cloneWith=Bg,c.conformsTo=Hg,c.deburr=Vu,c.defaultTo=Sm,c.divide=Qm,c.endsWith=Jh,c.eq=St,c.escape=Xh,c.escapeRegExp=Zh,c.every=sg,c.find=ag,c.findIndex=mu,c.findKey=_h,c.findLast=ug,c.findLastIndex=vu,c.findLastKey=bh,c.floor=zm,c.forEach=Tu,c.forEachRight=Su,c.forIn=xh,c.forInRight=Th,c.forOwn=Sh,c.forOwnRight=Ah,c.get=Us,c.gt=Vg,c.gte=Kg,c.has=Ih,c.hasIn=Ns,c.head=yu,c.identity=tt,c.includes=fg,c.indexOf=uf,c.inRange=Qh,c.invoke=Eh,c.isArguments=_n,c.isArray=oe,c.isArrayBuffer=Qg,c.isArrayLike=je,c.isArrayLikeObject=Pe,c.isBoolean=zg,c.isBuffer=on,c.isDate=Yg,c.isElement=Jg,c.isEmpty=Xg,c.isEqual=Zg,c.isEqualWith=jg,c.isError=Ls,c.isFinite=eh,c.isFunction=Ft,c.isInteger=Mu,c.isLength=ri,c.isMap=Ou,c.isMatch=th,c.isMatchWith=nh,c.isNaN=rh,c.isNative=ih,c.isNil=oh,c.isNull=sh,c.isNumber=Lu,c.isObject=ke,c.isObjectLike=Ie,c.isPlainObject=pr,c.isRegExp=Ds,c.isSafeInteger=ah,c.isSet=Du,c.isString=ii,c.isSymbol=at,c.isTypedArray=Dn,c.isUndefined=uh,c.isWeakMap=ch,c.isWeakSet=lh,c.join=ff,c.kebabCase=jh,c.last=Ct,c.lastIndexOf=gf,c.lowerCase=em,c.lowerFirst=tm,c.lt=ph,c.lte=dh,c.max=Ym,c.maxBy=Jm,c.mean=Xm,c.meanBy=Zm,c.min=jm,c.minBy=ev,c.stubArray=Ws,c.stubFalse=Hs,c.stubObject=Gm,c.stubString=Fm,c.stubTrue=Bm,c.multiply=tv,c.nth=hf,c.noConflict=Em,c.noop=$s,c.now=ei,c.pad=nm,c.padEnd=rm,c.padStart=im,c.parseInt=sm,c.random=zh,c.reduce=Cg,c.reduceRight=yg,c.repeat=om,c.replace=am,c.result=qh,c.round=nv,c.runInContext=h,c.sample=bg,c.size=Sg,c.snakeCase=um,c.some=Ag,c.sortedIndex=xf,c.sortedIndexBy=Tf,c.sortedIndexOf=Sf,c.sortedLastIndex=Af,c.sortedLastIndexBy=wf,c.sortedLastIndexOf=kf,c.startCase=lm,c.startsWith=pm,c.subtract=rv,c.sum=iv,c.sumBy=sv,c.template=dm,c.times=$m,c.toFinite=Bt,c.toInteger=ue,c.toLength=Nu,c.toLower=fm,c.toNumber=yt,c.toSafeInteger=fh,c.toString=ye,c.toUpper=gm,c.trim=hm,c.trimEnd=mm,c.trimStart=vm,c.truncate=Cm,c.unescape=ym,c.uniqueId=Hm,c.upperCase=_m,c.upperFirst=qs,c.each=Tu,c.eachRight=Su,c.first=yu,Bs(c,function(){var e={};return Pt(c,function(t,n){_e.call(c.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),c.VERSION=r,ft(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){c[e].placeholder=c}),ft(["drop","take"],function(e,t){de.prototype[e]=function(n){n=n===u?1:De(ue(n),0);var i=this.__filtered__&&!t?new de(this):this.clone();return i.__filtered__?i.__takeCount__=$e(n,i.__takeCount__):i.__views__.push({size:$e(n,ve),type:e+(i.__dir__<0?"Right":"")}),i},de.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),ft(["filter","map","takeWhile"],function(e,t){var n=t+1,i=n==G||n==U;de.prototype[e]=function(o){var l=this.clone();return l.__iteratees__.push({iteratee:ee(o,3),type:n}),l.__filtered__=l.__filtered__||i,l}}),ft(["head","last"],function(e,t){var n="take"+(t?"Right":"");de.prototype[e]=function(){return this[n](1).value()[0]}}),ft(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");de.prototype[e]=function(){return this.__filtered__?new de(this):this[n](1)}}),de.prototype.compact=function(){return this.filter(tt)},de.prototype.find=function(e){return this.filter(e).head()},de.prototype.findLast=function(e){return this.reverse().find(e)},de.prototype.invokeMap=le(function(e,t){return typeof e=="function"?new de(this):this.map(function(n){return sr(n,e,t)})}),de.prototype.reject=function(e){return this.filter(ni(ee(e)))},de.prototype.slice=function(e,t){e=ue(e);var n=this;return n.__filtered__&&(e>0||t<0)?new de(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==u&&(t=ue(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},de.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},de.prototype.toArray=function(){return this.take(ve)},Pt(de.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),o=c[i?"take"+(t=="last"?"Right":""):t],l=i||/^find/.test(t);o&&(c.prototype[t]=function(){var d=this.__wrapped__,f=i?[1]:arguments,m=d instanceof de,A=f[0],w=m||oe(d),M=function(pe){var fe=o.apply(c,Xt([pe],f));return i&&B?fe[0]:fe};w&&n&&typeof A=="function"&&A.length!=1&&(m=w=!1);var B=this.__chain__,X=!!this.__actions__.length,te=l&&!B,ce=m&&!X;if(!l&&w){d=ce?d:new de(this);var ne=e.apply(d,f);return ne.__actions__.push({func:Zr,args:[M],thisArg:u}),new ht(ne,B)}return te&&ce?e.apply(this,f):(ne=this.thru(M),te?i?ne.value()[0]:ne.value():ne)})}),ft(["pop","push","shift","sort","splice","unshift"],function(e){var t=Sr[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);c.prototype[e]=function(){var o=arguments;if(i&&!this.__chain__){var l=this.value();return t.apply(oe(l)?l:[],o)}return this[n](function(d){return t.apply(oe(d)?d:[],o)})}}),Pt(de.prototype,function(e,t){var n=c[t];if(n){var i=n.name+"";_e.call(Rn,i)||(Rn[i]=[]),Rn[i].push({name:t,func:n})}}),Rn[Vr(u,F).name]=[{name:"wrapper",func:u}],de.prototype.clone=Cp,de.prototype.reverse=yp,de.prototype.value=_p,c.prototype.at=Jf,c.prototype.chain=Xf,c.prototype.commit=Zf,c.prototype.next=jf,c.prototype.plant=tg,c.prototype.reverse=ng,c.prototype.toJSON=c.prototype.valueOf=c.prototype.value=rg,c.prototype.first=c.prototype.head,Zn&&(c.prototype[Zn]=eg),c},jt=Xl();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Ne._=jt,define(function(){return jt})):dn?((dn.exports=jt)._=jt,Fi._=jt):Ne._=jt}).call(qn)});var xx=b(I(),1);var _x=b(I(),1);var iC=b(I(),1);var Ov=b(I(),1);var fv={English:"English",["Simplified Chinese"]:"\u7B80\u4F53\u4E2D\u6587",["Traditional Chinese"]:"\u7E41\u9AD4\u4E2D\u6587",Japanese:"\u65E5\u672C\u8A9E",Spanish:"Espa\xF1ol",French:"Fran\xE7ais",German:"Deutsch",Russian:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",Portuguese:"Portugu\xEAs",Italian:"Italiano",Korean:"\uD55C\uAD6D\uC5B4",Turkish:"T\xFCrk\xE7e",Dutch:"Nederlands",Arabic:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629",Thai:"\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22",Swedish:"Svenska",Danish:"Dansk",Vietnamese:"Ti\u1EBFng Vi\u1EC7t",Norwegian:"Norsk",Polish:"Polski",Finnish:"Suomi",Indonesian:"Bahasa Indonesia",Hebrew:"\u05E2\u05D1\u05E8\u05D9\u05EA",Greek:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",Romanian:"Rom\xE2n\u0103",Hungarian:"Magyar",Czech:"\u010Ce\u0161tina",Catalan:"Catal\xE0",Slovak:"Sloven\u010Dina",Ukrainian:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",Croatian:"Hrvatski",Malay:"Bahasa Melayu",Hindi:"\u0939\u093F\u0928\u094D\u0926\u0940"},Ev={auto:"Auto",...fv};var Ks={["chat_model"]:"gpt-3.5-turbo",["text_model"]:"text-davinci-003"};var Ju=`You are a large language model trained by OpenAI that generate human-like text based on the input you received.
Here is a conversation between human A and you:

`,Xu=`You are a large language model trained by OpenAI. Your job is to generate human-like text based on the input you received, allowing it to engage in natural-sounding conversations and provide responses that are coherent and relevant to the topic at hand.

If the input is a question, try your best to answer it. Otherwise, provide as much information as you can.
You should use "code blocks" syntax from markdown including programing language name to encapsulate any part in responses that's longer-format content such as poem, code, lyrics.
Provide programming language name in code blocks if possible.
You should also use bold syntax from markdown on the relevant parts of the responses to improve readability.
If your answer contains code, make sure to provide detailed explanations.
You can understand and communicate fluently in the user's language of choice such as English,\u4E2D\u6587,\u65E5\u672C\u543E,Espanol,Francais or Deutsch.

Here is a conversation between human A and you:

`,Zu=`You are a large language model trained by OpenAI. Answer as concisely as possible.
Knowledge cutoff: {knowledge_cutoff} Current date: {current_date}`,ju=`You are a large language model trained by OpenAI. Your job is to generate human-like text based on the input you received, allowing it to engage in natural-sounding conversations and provide responses that are coherent and relevant to the topic at hand.

If the input is a question, try your best to answer it. Otherwise, provide as much information as you can.
You should use "code blocks" syntax from markdown including programing language name to encapsulate any part in responses that's longer-format content such as poem, code, lyrics.
Provide programming language name in code blocks if possible.
You should also use bold syntax from markdown on the relevant parts of the responses to improve readability.
If your answer contains code, make sure to provide detailed explanations.

Knowledge cutoff: {knowledge_cutoff} Current date: {current_date}`;var an=b(ec(),1),ic=b(tc(),1);var zv=b(I());var Nv=b(I()),oi,gv=new Uint8Array(16);function Xs(){if(!oi&&(oi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!oi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return oi(gv)}var Gv=b(I());var Fe=[];for(let u=0;u<256;++u)Fe.push((u+256).toString(16).slice(1));function nc(u,r=0){return(Fe[u[r+0]]+Fe[u[r+1]]+Fe[u[r+2]]+Fe[u[r+3]]+"-"+Fe[u[r+4]]+Fe[u[r+5]]+"-"+Fe[u[r+6]]+Fe[u[r+7]]+"-"+Fe[u[r+8]]+Fe[u[r+9]]+"-"+Fe[u[r+10]]+Fe[u[r+11]]+Fe[u[r+12]]+Fe[u[r+13]]+Fe[u[r+14]]+Fe[u[r+15]]).toLowerCase()}var Kv=b(I());var Bv=b(I()),hv=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Zs={randomUUID:hv};function mv(u,r,s){if(Zs.randomUUID&&!r&&!u)return Zs.randomUUID();u=u||{};let a=u.random||(u.rng||Xs)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,r){s=s||0;for(let p=0;p<16;++p)r[s+p]=a[p];return r}return nc(a)}var js=mv;var Nn=b(rt(),1);var Zv=b(I(),1),to=class{envvars=globalThis.__aichat_envvars__;_isBackground=!1;get currentProject(){return this.envvars.project}get extensionPrefix(){return this.currentProject==="monica"?"monica":"c4g"}get isProd(){return this.envvars.prod}get isBackground(){return this._isBackground}get host(){return this.envvars.host}markIsBackground(){this._isBackground=!0}},me=new to;an.default.extend(ic.default);var no=class{getExtensionVersion(){return Nn.default.runtime.getManifest().version}async tryGetTab(r){try{return await Nn.default.tabs.get(parseInt(r))}catch{return null}}getOsType(){let r=navigator.userAgent,s=navigator.userAgentData?.platform||navigator.platform,a=["Macintosh","MacIntel","MacPPC","Mac68K","macOS"],p=["Win32","Win64","Windows","WinCE"],g=["iPhone","iPad","iPod"];return a.indexOf(s)!==-1?"OSX":g.indexOf(s)!==-1?"IOS":p.indexOf(s)!==-1?"Windows":/Android/.test(r)?"Android":/Linux/.test(s)?"Linux":(console.error("unable to detect os type, use Windows as default",s,r),"Windows")}isChrome(){let r=navigator.userAgent,s=r.includes("Chrome")&&r.includes("Safari"),a=r.includes("Edg"),p=r.includes("OPR");return s&&!a&&!p}detectSystemColorScheme(){return window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light"}isPromise(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}genUrl(r,s={},a=!0){let p=Object.keys(s);if(p.length===0)return r;let g=r;/:[a-zA-Z]/.test(r)&&r.split("/").forEach(x=>{if(x.startsWith(":")){let T=x.slice(1);g=g.replace(x,s[T]),delete s[T]}}),g+="?";for(let C of p){let x=s[C];x&&(x=a?encodeURIComponent(x):x,g+=`${C}=${x}&`)}return g.slice(0,-1)}getWebOrigin(){return me.host}getModKeyName(r=!1){return this.getOsType()==="OSX"?"\u2318":r?"Ctrl + ":"Ctrl"}getStaticFile(r){return Nn.default.runtime.getURL(`static/${r}`)}genId(r=!1){let s=js();return r?s.split("-")[0]:s}onDOMReady(r){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r()}getRootId(r){return`${me.extensionPrefix}-${r}`}camelizeKey(r,s=["-","_"]){let a=[],p=0,g=new Set(s);for(;p<r.length;)g.has(r[p])?(a.push(r[p+1].toUpperCase()),p++):a.push(r[p]),p++;return a.join("")}camelize(r){if(r==null)return null;if(r instanceof Array)return r.map(s=>this.camelize(s));if(typeof r=="object"){let s={};for(let a in r){let p=r[a];s[this.camelizeKey(a)]=this.camelize(p)}return s}return r}underlizeKey(r,s=!1){let a=[],p=0,g=r.toString().toLowerCase();for(;p<r.length;){if(r[p]!==g[p]&&(!s||p!==0)){a.push("_"),a.push(g[p]),p++;continue}a.push(r[p].toLocaleLowerCase()),p++}return a.join("")}underlize(r){if(r==null)return null;if(r instanceof Array)return r.map(s=>this.underlize(s));if(typeof r=="object"){let s={};for(let a in r){let p=r[a],g=this.underlizeKey(a),C=this.underlize(p);C!=null&&(s[g]=C)}return s}return r}capitalize(r){return r.charAt(0).toUpperCase()+r.slice(1)}async*streamAsyncIterable(r){let s=r.getReader();try{for(;;){let{done:a,value:p}=await s.read();if(a)return;yield p}}finally{s.releaseLock()}}isBraveBrowser(){return navigator.brave?.isBrave()}endsWithQuestionMark(r){return r.endsWith("?")||r.endsWith("\uFF1F")||r.endsWith("\u061F")||r.endsWith("\u2E2E")}copyToClipboard(r){let s=document.createElement("textarea");s.id="copy-to-clipboard";let a=document.body;a.appendChild(s),s.oncopy=p=>{p.stopPropagation()},s.value=r,s.select(),document.execCommand("copy"),a.removeChild(s)}getOffsetOfPageTop(r){return document.documentElement.clientHeight-(r.getBoundingClientRect().top-document.documentElement.getBoundingClientRect().top)}async delay(r){return new Promise(s=>{setTimeout(()=>{s()},r)})}async getContentFromClipboard(){try{let r=await navigator.clipboard.readText();return Nn.default.tabs.query({}),r}catch{return""}}fromNow(r){let s="MMM D, YYYY";return(0,an.default)().diff((0,an.default)(r),"day")>7?(0,an.default)((0,an.default)(r)).format(s):(0,an.default)((0,an.default)(r)).fromNow()}formatMonicaSdkError(r){let s=r.message||r.data.message||"server error",a=/请求失败\((\d+)\)/;return s.replace(a,"server error($1)")}addPromptLangSuffix(r,s){return s==="auto"?r:`${r}(in ${s})`}getProductName(){return me.currentProject==="monica"?"Monica":"ChatGPT for Google"}getChatTabUrl(){return Nn.default.runtime.getURL("chatTab.html")}getDefaultShortcutKey(){return me.currentProject==="monica"?"m":"b"}getChromeStoreUrl(){return me.currentProject==="monica"?"https://chrome.google.com/webstore/detail/monica-%E2%80%94-your-chatgpt-cop/ofpnmcalabcbjgholdjcjblkibolbppb":"https://chrome.google.com/webstore/detail/chatgpt-for-google/jgjaeacdkonaoafenlfkkkmbaopkbilf"}getLogo(r=!0){return me.currentProject==="monica"?this.getStaticFile("monicaLogo.png"):r?this.getStaticFile("logo.png"):this.getStaticFile("c4g/c4gTransparentLogo.png")}getFeedbackEmail(){return me.currentProject==="monica"?"mailto:contact@monica.im?subject=Monica feedback":"mailto:chatgpt4search@gmail.com?subject=ChatGPT for Google feedback"}getPricingUrl(){return me.currentProject==="c4g"?`${this.getWebOrigin()}/billing`:`${this.getWebOrigin()}/price`}getFaviconFromUrl(r){return`https://s2.googleusercontent.com/s2/favicons?domain=${r}`}getProductFavicon(){return me.currentProject==="monica"?this.getStaticFile("monicaLogo.png"):this.getStaticFile("logo.png")}isInChatTabPage(){let r=window.location.href;return/^chrome-extension:\/\/.*chatTab\.html$/.test(r)}},Z=new no;var aC=b(I(),1);var sc=["ServiceBase","BackgroundApp","MonicaService","ConfigService"],Cv=[],ro=class{console=console;loggers=[];enabledModules=me.isProd?new Set(Cv):new Set(sc);getLogger(r){let s=new io(this.enabledModules,r);return this.loggers.push(s),s}enableAllLoggers(){this.enabledModules=new Set(sc),this.loggers.forEach(r=>{r._enabledModules=this.enabledModules})}},io=class{constructor(r,s){this._enabledModules=r;this._module=s}get log(){return this._enabledModules.has(this._module)?console.log:oc}get debug(){return this._enabledModules.has(this._module)?console.debug:oc}get warn(){return console.warn}get error(){return console.error}};function oc(){}var Oe=new ro;var dC=b(I(),1),bn=b(rt(),1);var so=class{async sendToBackground(r,s,a){let p={type:r,data:s,id:a||Z.genId()};return bn.default.runtime.sendMessage(p)}async addListener(r,s){bn.default.runtime.onMessage.addListener((a,p,g)=>{if(a.type===r)return s(a.data,a.id,p,g)})}async addExternalListener(r,s){bn.default.runtime.onMessageExternal.addListener((a,p,g)=>{if(console.log("incoming external msg",a),a.type===r)return s(a.data,a.id,p,g)})}async sendToContent(r,s,a,p){let g={type:s,data:a,id:p||Z.genId()};return bn.default.tabs.sendMessage(r,g)}async sendToPopup(r,s,a){let p={type:r,data:s,id:a||Z.genId()};return bn.default.runtime.sendMessage(p)}broadcastFromBackground(r,s,a){if(!me.isBackground)throw new Error("only allowed in background");let p=a||Z.genId();bn.default.tabs.query({}).then(g=>{g.forEach(C=>{C.id&&this.sendToContent(C.id,r,s,p).catch(()=>{})})}),this.sendToPopup(r,s,p).catch(()=>{})}},He=new so;var qC=b(I(),1);var OC=b(I(),1);var kC=b(I(),1);var uc=b(ai(),1),Wt=b(rt(),1);var yC=b(I(),1);var ci=b(ai(),1),Gn=b(rt(),1),oo=Oe.getLogger("ServiceBase"),ao=class{constructor(r,s){this.prefix=r;this.defaultValues=s}async get(r){let s=this.encodeKey(r),p=(await Gn.default.storage.local.get(s))[s];return p===void 0&&(p=this.defaultValues[r]),p}async set(r,s){Gn.default.storage.local.set({[this.encodeKey(r)]:s})}async getAll(){let r=Object.keys(this.defaultValues).map(a=>this.encodeKey(a)),s=await Gn.default.storage.local.get(r);return s?(0,ci.defaults)(this.transformValues(s,!1),this.defaultValues):this.defaultValues}async update(r){await Gn.default.storage.local.set(this.transformValues(r,!0))}async removeDeprecated(r){await Gn.default.storage.local.remove(this.encodeKey(r))}encodeKey(r){return this.prefix?`${this.prefix}.${r}`:r}decodeKey(r){return this.prefix?r.replace(`${this.prefix}.`,""):r}transformValues(r,s){let a={},p=new Set(Object.keys(this.defaultValues));for(let g of Object.keys(r))if(s)p.has(g)&&(a[this.encodeKey(g)]=r[g]);else{let C=this.decodeKey(g);p.has(C)&&(a[C]=r[g])}return a}},Ve=class{_instance;_eventListeners={};constructor(r,s){this._instance=new s;let a=this._instance,p=this,g=Object.getPrototypeOf(a),C=Object.getPrototypeOf(g),x=[...Object.getOwnPropertyNames(g),...Object.getOwnPropertyNames(C)];for(let T of x)typeof a[T]=="function"&&(p[T]=(...$)=>{if(me.isBackground)return a._onCallMethod({type:"bg"},T,$);if(T.startsWith("_"))throw TypeError("method starting with _ can only be called from background");if(T==="on"){let[O,y]=$;return this._addEventListener(O,y)}return this._sendMethodCallToBackground(r,T,$)});me.isBackground||He.addListener("serviceEvent",T=>{let{serviceName:D,eventName:$,data:O}=T;if(r===D){let y=this._eventListeners[$];y&&y.forEach(v=>v.call(O))}}),oo.debug("service proxy created",r,this)}async _sendMethodCallToBackground(r,s,a){oo.debug("send event call",r,s,a);let p=Z.genId(),g=[];return a.forEach((C,x)=>{if(typeof C=="function"){let T=`__func:${p}:${x}`;g.push(T),this._addProxiedFunc(T,C)}else g.push(C)}),He.sendToBackground("callServiceMethod",{serviceName:r,methodName:s,finalArgs:g},p)}_addEventListener(r,s){this._eventListeners[r]||(this._eventListeners[r]=[]);let a=new ui(r,s,()=>{this._eventListeners[r]=this._eventListeners[r]?.filter(p=>p!==a)});return this._eventListeners[r].push(a),a}_addProxiedFunc(r,s){He.addListener("proxiedFuncCall",a=>{r===a.funcId&&s(...a.args)})}},ui=class{constructor(r,s,a){this.event=r;this.handler=s;this.onDestroy=a}destroy(){this.onDestroy()}call(r){this.handler(r)}},Ke=class{_serviceName="";storage;lastCaller;eventListeners={};_initService(r){this._serviceName=r;let s=this.storagePrefix;this.storage=new ao(s,this.defaultStorageValues),this.onInit()}on(r,s){this.eventListeners[r]||(this.eventListeners[r]=[]);let a=new ui(r,s,()=>{this.eventListeners[r]=this.eventListeners[r]?.filter(p=>p!==a)});return this.eventListeners[r].push(a),a}async _onCallMethod(r,s,a){let p=this;if(typeof p[s]!="function")throw new Error(`method ${s} not found`);let g=[];a.forEach(x=>{if(typeof x=="string"&&x.startsWith("__func:")){let T=x;g.push((...D)=>{let $=`${this._serviceName}.${s}`;oo.debug(`- call proxied func for ${$}:${T}`,{funcArgs:D}),r.tabId?He.sendToContent(r.tabId,"proxiedFuncCall",{funcId:T,args:D}):He.sendToPopup("proxiedFuncCall",{funcId:T,args:D})})}else g.push(x)}),this.lastCaller=r;let C=p[s](...g);if(C!==void 0&&!Z.isPromise(C))throw new TypeError("public service method must return a promise");return C}emit(r,s){let a=this.eventListeners[r];a&&a.forEach(p=>p.call(s)),He.broadcastFromBackground("serviceEvent",{serviceName:this._serviceName,eventName:r,data:s})}async _fetchWithCache(r,s,a){let{useCache:p=!0,autoUpdate:g=!0,cacheOnly:C=!1}=a||{},x=async()=>{let T=await s();return this.storage.set(r,T),T};if(p||C){let T=await this.storage.get(r);if(C)return T;if(T&&!(0,ci.isEmpty)(T))return g&&x(),T}return await x()}};var ac=Oe.getLogger("ConfigService"),Ht=class extends Ke{storagePrefix="";defaultStorageValues={permissionGranted:!1,triggerMode:"always",theme:"auto",language:"auto",provider:"chatgpt","provider:gpt3":null,"provider:chatgpt":null,"ui:popup:hideShortcutsTip":!1,ratingTipShowTimes:0,installTime:0,mainWindowMode:null,composeLanguage:null,shortCutEnableOption:{disabledAll:!1,disabledHosts:{}},buttonEnableOption:{disabledAll:!1,disabledHosts:{}},mainWindowSize:null,sidebarSize:null,speechLangs:[],contentFontSize:"normal",uiFlags:{}};onInit(){ac.log("config service init",this.storage),Wt.default.storage.local.onChanged.addListener(r=>{let s=(0,uc.pick)(r,Object.keys(this.defaultStorageValues));Object.keys(s).length&&(ac.log("config change"),this.emit("configChange",s))})}async get(r){return this.storage.get(r)}async set(r,s){this.storage.set(r,s)}async getAll(){return this.storage.getAll()}async update(r){return this.storage.update(r)}openShortcutsPage(){Wt.default.tabs.create({url:"chrome://extensions/shortcuts"})}openOptionsPage(){Wt.default.runtime.openOptionsPage()}openMonicaChatTabPage(){Wt.default.tabs.create({url:Wt.default.runtime.getURL("chatTab.html")})}async getCommands(){return await Wt.default.commands.getAll()}async keepAlive(){return"keep alive"}async getUiFlag(r){return(await this.get("uiFlags"))[r]}async setUiFlag(r,s){let a=await this.get("uiFlags");a[r]=s,await this.set("uiFlags",a)}async shouldShowRatingTip(){let r=await Wt.default.storage.local.get("ratingTipShowTimes");if(r){let a=r.ratingTipShowTimes;typeof a=="number"&&(await Wt.default.storage.local.remove("ratingTipShowTimes"),await this.set("ratingTipShowTimes",a))}let s=await this.get("ratingTipShowTimes");return s>=5?!1:(await this.set("ratingTipShowTimes",s+1),s>=2)}async getProviderConfigs(){let r=await this.get("provider");if(r==="gpt3"){let s=await this.get("provider:gpt3");return{provider:r,configs:s}}return{provider:r,configs:null}}};nt(Ht,"serviceName","ConfigService");var PC=b(I(),1);var Ee=new Ve(Ht.serviceName,Ht);var li=b(rt(),1),uo=class{permissions={origins:["<all_urls>"]};contains(){return li.default.permissions.contains(this.permissions)}async request(){let r=await li.default.permissions.request(this.permissions);return r&&Ee.set("permissionGranted",!0),r}registerContentScripts(){li.default.scripting.registerContentScripts([{id:"content",js:["content.js"],matches:["<all_urls>"]}])}checkAndRegisterContentScripts(){this.contains().then(r=>{r&&this.registerContentScripts()})}},cc=new uo;var QC=b(I(),1);var $C=b(I(),1);var Fn=b(rt(),1);var pi=Oe.getLogger("AuthTabService"),yv="https://chat.openai.com/chat",un=class extends Ke{storagePrefix="authTab";defaultStorageValues={pinnedTabId:null,authCaller:null};iframeLoadedCallback=null;onInit(){}async backToCallerPage(){let r=await this.storage.get("authCaller");if(r){let{type:s,tabId:a}=r;s==="tab"&&Fn.default.tabs.update(a,{active:!0})}}resolveChatGptAuthError(){return this.createChatGptTabForAuth()}async isThisTheAuthTab(){let r=this.lastCaller?.tabId,{pinnedTabId:s,authCaller:a}=await this.storage.getAll();return!!(a&&s===r)}async markAuthFinished(){return this.storage.update({authCaller:null})}async waitIframeLoaded(){return new Promise((r,s)=>{this.iframeLoadedCallback=()=>{r()},setTimeout(()=>{s("timeout")},8*1e3)})}async markIframeLoaded(){this.iframeLoadedCallback?.()}async createChatGptTabForAuth(){let r=this.lastCaller,s=await this.storage.get("pinnedTabId"),a=null;if(s){pi.log("focused to old tab",s);try{a=await Fn.default.tabs.get(s),Fn.default.tabs.reload(a.id),Fn.default.tabs.update(a.id,{active:!0,pinned:!0})}catch(p){pi.error(p)}}return a||(pi.log("create new tab",s),a=await Fn.default.tabs.create({url:yv,pinned:!0,active:!0})),pi.log("update storage",a.id,r),this.storage.update({pinnedTabId:a.id,authCaller:r})}};nt(un,"serviceName","AuthTabService");var lc=new Ve(un.serviceName,un);var i_=b(I(),1);var Zy=b(I(),1);var ly=b(I(),1);var oy=b(I(),1);var ny=b(I(),1);var jC=b(I(),1);var JC=b(I(),1),Bn;(p=>(p.RESP_FIELD_STATUS="code",p.RESP_FIELD_MESSAGE="msg",p.RESP_FIELD_ERROR_NAME="error",p.RESP_SUCCESS_STATUS=0))(Bn||={});var ae;($=>{let u="[CrepeSdk] ";class r{}$.ExceptionHandler=r,$.NameTransformers={snakeToCamel:O=>O.replace(/(_[a-z])/g,y=>y.toUpperCase().replace("_","")),camelToSnake:O=>O.replace(/([A-Z])/g,y=>`_${y.toLowerCase()}`).replace(/^_/,"")};class a{constructor(y,v,P,F,H,N,Q,j){this.reqInfo=y;this.httpError=v,this.httpStatus=P,this.httpStatusText=F,this.name=this.constructor.name,this.code=H,this.message=N,this.data=Q,this.originalError=j}name;httpError;httpStatus;httpStatusText;code;message;data;originalError;handled=!1}$.ApiRequestError=a;class p{constructor(y,v,P,F){this.reqInfo=y;this.name=this.constructor.name,this.originalError=P,this.cause=v,this.reason=F}name;cause;originalError;reason}$.ApiRequestAborted=p;class g{config;sessionMap=new WeakMap;idCounter=0;constructor(y){this.config=y,this.config.nameTransformers||(this.config.nameTransformers={toClientName:$.NameTransformers.snakeToCamel,toServerName:$.NameTransformers.camelToSnake})}nextId(){return++this.idCounter}expireSession(y,v){let P=this.sessionMap.get(y);return P?(v&&P.has(v)?(P.get(v)._expire(),P.delete(v)):(P.forEach(F=>{F._expire()}),P.clear()),!0):!1}convertObjectNames(y,v){return v&&(Array.isArray(v)?v.map(P=>this.convertObjectNames(y,P)):typeof v=="object"?Object.keys(v).reduce((P,F)=>{let H=v[F],N=this.convertNameKey(y,F);return P[N]=this.convertObjectNames(y,H),P},{}):v)}convertNameKey(y,v){return y==="client"?this.config.nameTransformers.toClientName(v):this.config.nameTransformers.toServerName(v)}getSession(y,v,P,F){let H=this.sessionMap.get(y);H||(H=new Map,this.sessionMap.set(y,H));let N=H.get(v);if(N)return N._checkConfigs(P),N;let Q=new F(y,v,P);return Q._initApis(this),H.set(v,Q),Q}}$.BaseSdk=g;class C{sdk;session;cachedData=new Map;constructor(y,v){if(this.sdk=y,v&&!(v instanceof T))throw new Error(`${u}session error`);this.session=v}async sendRequest(y,v,P,F,H,N={}){if(N.cacheMode==="localStorage")throw new Error(`${u}localStorage cache not supported yet`);let j={id:this.sdk.nextId(),method:y,path:v,cmd:P,otherParams:F,isLowLevelResp:H,config:N,cacheKey:null};if(N.onResolve&&!N.cacheMode&&console.warn(`${u}onResolve is usually combined with cacheMode`),N.useCache){N.cacheMode||console.error(`${u}useCache must combined with cacheMode`);let k=this.getSignature(y,v,P,F);if(console.log(k),j.cacheKey=k,this.cachedData.has(k)){this.handleSendRequest(j,!0);let L=this.cachedData.get(k);return N.onResolve?.(null,L,!0),L}}return this.handleSendRequest(j,!1)}handleSendRequest(y,v){let{sdk:P}=this,{method:F,config:H}=y,{body:N,query:Q}=this.getParams(F,y.cmd,y.otherParams),j=P.config.baseUrl+this.pathPrefix+y.path;Q&&(j+=`?${Q}`);let k=H.headers||{};P.config.globalSetHeader&&(k=P.config.globalSetHeader(k)),k["Content-Type"]||(k["Content-Type"]="application/json");let L=H.abortSignal||this.session?.abortSignal;this.onBeforeRequest(H,v);let V=fetch(j,{method:F,headers:k,signal:L,body:F==="GET"?null:JSON.stringify(N)});return this.handleRes(y,V,v)}async handleRes(y,v,P){let{config:F}=y;try{let H=await v;if(H.status!==200)throw new a(y,!0,H.status,H.statusText,0,`request fail(${H.status})`,null,new Error(H.statusText));if(y.isLowLevelResp)throw new Error("TODO: handle low level resp");{let N=await H.json(),Q=N[Bn.RESP_FIELD_STATUS],j=N[Bn.RESP_FIELD_MESSAGE],k=N[Bn.RESP_FIELD_ERROR_NAME],L=this.sdk.convertObjectNames("client",N);if(Q===Bn.RESP_SUCCESS_STATUS)return y.cacheKey&&this.cachedData.set(y.cacheKey,L),F.onResolve?.(null,L,!1),L;let V=a;throw k&&this.sdk.allExceptions[k]&&(V=this.sdk.allExceptions[k]),new V(y,!1,H.status,H.statusText,Q,j,L,new Error(j))}}catch(H){return P?(console.error(`${u} cache update fail`,H),null):this.handleError(y,H)}finally{this.onAfterRequest(F,P)}}handleError(y,v){let{config:P}=y;if(v instanceof DOMException&&v.code===v.ABORT_ERR)throw P.abortSignal?.aborted?new p(y,"manualCanceled",v,P.abortSignal.reason):new p(y,"autoCanceled",v);if(v instanceof TypeError&&v.message==="Failed to fetch"){let H=new a(y,!0,0,v.message,0,"network error(0)",null,v);if(this.triggerErrorHandlers(H,P),H.handled)throw new p(y,"handled",v)}if(v instanceof a&&(this.triggerErrorHandlers(v,P),v.handled))throw new p(y,"handled",v);y.cacheKey&&this.cachedData.delete(y.cacheKey);let F=v instanceof a?v:new a(y,!1,0,`${v.name}:${v.message}`,0,"network error(-1)",null,v);throw P.onResolve?.(F,null,!1),console.error(`${u} Unhandled api request error:`,F),F}triggerErrorHandlers(y,v){let P=!0;v.catch&&(P=v.catch(y)===!1),P&&this.session?.config.catch&&(P=this.session.config.catch(y)===!1),this.sdk.config.globalErrorHandler&&!v.ignoreGlobalErrorHandler&&P&&(P=this.sdk.config.globalErrorHandler(y)===!1),y.handled=!P}onBeforeRequest(y,v=!1){if(!v&&y.loadingProperties){let[P,...F]=y.loadingProperties;D(P,F,!0)}}onAfterRequest(y,v){if(!v&&y.loadingProperties){let[P,...F]=y.loadingProperties;D(P,F,!1)}}getParams(y,v,P){let F;return y==="GET"&&v?F=Object.keys(v).map(H=>[H,v[H]]):F=P,{body:v?this.sdk.convertObjectNames("server",v):{},query:F.filter(([H,N])=>N!==void 0).map(([H,N])=>`${this.sdk.convertNameKey("server",H)}=${encodeURIComponent(this.stringifyQuery(N))}`).join("&")}}stringifyQuery(y){if(y==="null")return"";let v=this.sdk.convertObjectNames("server",y);switch(typeof v){case"boolean":return v?"true":"false";case"bigint":case"number":case"string":return v.toString();case"undefined":return"";case"object":return Array.isArray(v)?v.map(P=>this.stringifyQuery(P)).join(","):Object.keys(v).map(P=>`${P}=${this.stringifyQuery(v[P])}`).join("&");default:return""}}getSignature(y,v,P,F){return y.slice(0,2)+v+this.stableJsonStringify(P)+this.stableJsonStringify(F)}stableJsonStringify(y){let v=new Set;return JSON.stringify(y,(P,F)=>(v.add(P),F)),JSON.stringify(y,Array.from(v).sort())}}$.BaseDomainApi=C;class x{session;wait;maxWait;leading=!1;trailing=!0;mutex=!0;status="idle";next=null;nextP=null;nextPResolve=null;nextPReject=null;timer=null;maxWaitTimer=null;abortController;expired=!1;get abortSignal(){return this.abortController.signal}constructor(y,v){if(this.session=y,typeof v=="number")this.wait=v;else{let{wait:P,leading:F,maxWait:H,trailing:N,mutex:Q}=v;this.wait=P,this.maxWait=H,F!==void 0&&(this.leading=F),N!==void 0&&(this.trailing=N),Q!==void 0&&(this.mutex=Q),this.maxWait&&this.maxWait<this.wait&&console.warn("maxWait must >= wait")}}add(y){if(this.expired)throw new Error(`${u}session has expired`);if(this.status==="idle"){if(this.leading){this.onBeforeRun();try{let v=y(this.session);return this.doWait(),v}finally{this.onAfterRun()}}return this.queueNext(y),this.doWait(),this.nextP}return this.queueNext(y),this.doWait(),this.nextP}expire(){clearInterval(this.timer),clearInterval(this.maxWaitTimer),this.abortController?.abort(),this.expired=!0}doWait(){this.status="waiting",this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.status="idle",this.timer=null,this.maxWaitTimer&&(clearTimeout(this.maxWaitTimer),this.maxWaitTimer=null),this.trailing&&this.run()},this.wait),this.maxWait&&!this.maxWaitTimer&&(this.maxWaitTimer=setTimeout(()=>{this.maxWaitTimer=null,this.run(),this.doWait()},this.maxWait))}async run(){if(!this.next)return;this.onBeforeRun();let y=this.next;this.next=null;try{let v=await y(this.session);this.nextPResolve?.(v)}catch(v){this.nextPReject?.(v)}finally{this.onAfterRun()}}queueNext(y){this.next=y,this.nextP=new Promise((v,P)=>{this.nextPResolve=v,this.nextPReject=P})}onBeforeRun(){this.mutex&&(this.abortController?.abort(),this.abortController=new AbortController),this.session?._onBeforeRun()}onAfterRun(){this.session?._onAfterRun()}}class T{static idCounter=0;get abortSignal(){return this.debounceManager?.abortSignal||this.abortController.signal}id;context;name;config;get expired(){return this._expired}_expired=!1;mode="normal";abortController;debounceManager;constructor(y,v,P){this.id=++T.idCounter,this.context=y,this.name=v,this.config=P,this.abortController=new AbortController,this.initConfig(P)}_checkConfigs(y){if(JSON.stringify(y)!==JSON.stringify(this.config))throw console.error({context:this.context,name:this.name,oldConfig:this.config,newConfig:y}),new Error(`${u}config inconsistent when calling same session`)}async _run(){if(this._expired)throw new Error(`${u}session has expired`);if(this.mode==="normal"){this._onBeforeRun();try{return this.config.handler(this)}finally{this._onAfterRun()}}if(this.mode==="mutex"){this.cancelUnfinished(),this._onBeforeRun();try{return this.config.handler(this)}finally{this._onAfterRun()}}if(this.mode==="debounce")return this.debounceManager.add(this.config.handler);if(this.mode==="polling"){this._onBeforeRun();try{return this.config.handler(this)}finally{this._onAfterRun()}}throw new Error(`${u} Unknown session mode: ${this.mode}`)}_expire(){this.cancelUnfinished(),this.debounceManager?.expire(),this._expired=!0}_onBeforeRun(){this.config.loadingProperties&&D(this.context,this.config.loadingProperties,!0)}_onAfterRun(){this.config.loadingProperties&&D(this.context,this.config.loadingProperties,!1)}cancelUnfinished(){this.abortController.abort(),this.abortController=new AbortController}initConfig(y){if(["mutex","debounce","pollingInterval"].filter(F=>y[F]!==void 0).length>1)throw new Error(`${u} Multiple control param are not supported (mutex/debounce/pollingInterval)`);if(this.config.debounce){this.mode="debounce",this.debounceManager=new x(this,this.config.debounce);return}if(this.config.pollingInterval)throw this.mode="polling",new Error(`${u}polling not implemented`);if(this.config.mutex){this.mode="mutex";return}}}$.BaseSession=T;function D(O,y,v){y.forEach(P=>{O[P]=v})}})(ae||={});var xn;(H=>{class u extends ae.ApiRequestError{errorName="exceptions.CommonError"}H.CommonError=u;class r extends ae.ApiRequestError{errorName="exceptions.InternalError"}H.InternalError=r;class s extends ae.ApiRequestError{errorName="exceptions.AuthError"}H.AuthError=s;class a extends ae.ApiRequestError{errorName="exceptions.UserAuthError"}H.UserAuthError=a;class p extends ae.ApiRequestError{errorName="exceptions.ResourceNotFoundError"}H.ResourceNotFoundError=p;class g extends ae.ApiRequestError{errorName="exceptions.ValidationError"}H.ValidationError=g;class C extends ae.ApiRequestError{errorName="exceptions.UnexpectedError"}H.UnexpectedError=C;class x extends ae.ApiRequestError{errorName="exceptions.NotImplementError"}H.NotImplementError=x;class T extends ae.ApiRequestError{errorName="exceptions.DomainError"}H.DomainError=T;let D;(Q=>{class N extends ae.BaseDomainApi{pathPrefix="/notification";async list(k,L){return this.sendRequest("GET","/list",k,[],!1,L)}async readAll(k,L){return this.sendRequest("POST","/read_all",k,[],!1,L)}async read(k,L){return this.sendRequest("POST","/read",k,[],!1,L)}async getOrCreateNotification(k,L){return this.sendRequest("POST","/get_or_create_notification",k,[],!1,L)}}Q.Api=N})(D=H.Notification||={});let $;(k=>{class N extends ae.ApiRequestError{errorName="skill.exceptions.SkillNotExistError"}k.SkillNotExistError=N;class Q extends ae.ApiRequestError{errorName="skill.exceptions.SkillNotOwnedError"}k.SkillNotOwnedError=Q;class j extends ae.BaseDomainApi{pathPrefix="/skill";async list(V,K){return this.sendRequest("GET","/list",V,[],!1,K)}async create(V,K){return this.sendRequest("POST","/create",V,[],!1,K)}async detail(V,K){return this.sendRequest("GET","/detail",V,[],!1,K)}async editDetail(V,K){return this.sendRequest("GET","/edit_detail",V,[],!1,K)}async update(V,K){return this.sendRequest("POST","/update",V,[],!1,K)}async delete(V,K){return this.sendRequest("POST","/delete",V,[],!1,K)}async userAction(V,K){return this.sendRequest("POST","/user_action",V,[],!1,K)}async report(V,K){return this.sendRequest("POST","/report",V,[],!1,K)}}k.Api=j})($=H.Skill||={});let O;(G=>{class N extends ae.ApiRequestError{errorName="task.exceptions.ChatError"}G.ChatError=N;class Q extends ae.ApiRequestError{errorName="task.exceptions.QuotaExceededError"}G.QuotaExceededError=Q;class j extends ae.ApiRequestError{errorName="task.exceptions.UidDuplicateError"}G.UidDuplicateError=j;class k extends ae.ApiRequestError{errorName="task.exceptions.CustomPromptError"}G.CustomPromptError=k;class L extends ae.ApiRequestError{errorName="task.exceptions.ConversationNotExistError"}G.ConversationNotExistError=L;class V extends ae.ApiRequestError{errorName="task.exceptions.SharedConversationNotExistError"}G.SharedConversationNotExistError=V;class K extends ae.ApiRequestError{errorName="task.exceptions.ReadEnhanceIndexNotPreparedError"}G.ReadEnhanceIndexNotPreparedError=K;class Y extends ae.ApiRequestError{errorName="task.exceptions.ConversationAlreadyExistReadEnhanceIndexError"}G.ConversationAlreadyExistReadEnhanceIndexError=Y;class W extends ae.ApiRequestError{errorName="task.exceptions.ReadingQuotaExceededError"}G.ReadingQuotaExceededError=W;class ie extends ae.ApiRequestError{errorName="task.exceptions.ReadingColdDownError"}G.ReadingColdDownError=ie;class q extends ae.BaseDomainApi{pathPrefix="/task";async generatePrompt(U,R){return this.sendRequest("POST","/generate_prompt",U,[],!1,R)}async generateOpenaiParam(U,R){return this.sendRequest("POST","/generate_openai_param",U,[],!1,R)}async onOpenaiResult(U,R){return this.sendRequest("POST","/on_openai_result",U,[],!1,R)}async feedbackGenResult(U,R){return this.sendRequest("POST","/feedback_gen_result",U,[],!1,R)}async getTemplateList(U){return this.sendRequest("GET","/get_template_list",null,[],!1,U)}async getToneList(U){return this.sendRequest("GET","/get_tone_list",null,[],!1,U)}async shareConversation(U,R){return this.sendRequest("POST","/share_conversation",U,[],!1,R)}async getSharedConversation(U,R){return this.sendRequest("GET","/get_shared_conversation",null,[["shortId",U]],!1,R)}async getConversationList(U,R){return this.sendRequest("GET","/get_conversation_list",U,[],!1,R)}async getConversationInfo(U,R){return this.sendRequest("GET","/get_conversation_info",U,[],!1,R)}async getChatItemList(U,R){return this.sendRequest("GET","/get_chat_item_list",U,[],!1,R)}async searchConversation(U,R){return this.sendRequest("GET","/search_conversation",U,[],!1,R)}async delConversation(U,R){return this.sendRequest("POST","/del_conversation",U,[],!1,R)}async updateConversation(U,R){return this.sendRequest("POST","/update_conversation",U,[],!1,R)}async generateReadEnhanceIndex(U,R){return this.sendRequest("POST","/generate_read_enhance_index",U,[],!1,R)}async cancelGenerateReadEnhanceIndex(U,R){return this.sendRequest("POST","/cancel_generate_read_enhance_index",U,[],!1,R)}async readEnhanceIndexStatus(U,R){return this.sendRequest("GET","/read_enhance_index_status",U,[],!1,R)}async testGenerateIndex(U){return this.sendRequest("GET","/test_generate_index",null,[],!1,U)}}G.Api=q})(O=H.Task||={});let y;(K=>{class N extends ae.ApiRequestError{errorName="user.exceptions.UserNotExistsError"}K.UserNotExistsError=N;class Q extends ae.ApiRequestError{errorName="user.exceptions.OauthCallbackError"}K.OauthCallbackError=Q;class j extends ae.ApiRequestError{errorName="user.exceptions.UserAlreadyExistsError"}K.UserAlreadyExistsError=j;class k extends ae.ApiRequestError{errorName="user.exceptions.PasswordError"}K.PasswordError=k;class L extends ae.ApiRequestError{errorName="user.exceptions.UserRegisterAfterLogoffError"}K.UserRegisterAfterLogoffError=L;class V extends ae.BaseDomainApi{pathPrefix="/user";async superAccount(W,ie){return this.sendRequest("GET","/super_account",null,[["superId",W]],!1,ie)}async logout(W){return this.sendRequest("GET","/logout",null,[],!1,W)}async loginToken(W,ie){return this.sendRequest("GET","/login_token",null,[["token",W]],!1,ie)}async authSession(W){return this.sendRequest("GET","/auth_session",null,[],!1,W)}async me(W){return this.sendRequest("GET","/me",null,[],!1,W)}async updateLanguagePreferences(W,ie){return this.sendRequest("POST","/update_language_preferences",W,[],!1,ie)}async updateTel(W,ie){return this.sendRequest("POST","/update_tel",W,[],!1,ie)}async oauth2Revoke(W){return this.sendRequest("GET","/oauth2_revoke",null,[],!1,W)}async clearCredentials(W){return this.sendRequest("GET","/clear_credentials",null,[],!1,W)}async updateUserInfo(W,ie){return this.sendRequest("POST","/update_user_info",W,[],!1,ie)}async uninstallReasons(W){return this.sendRequest("GET","/uninstall_reasons",null,[],!1,W)}async uninstallFeedback(W,ie){return this.sendRequest("POST","/uninstall_feedback",W,[],!1,ie)}async logoff(W){return this.sendRequest("POST","/logoff",null,[],!1,W)}async customPromptList(W,ie){return this.sendRequest("GET","/custom_prompt_list",W,[],!1,ie)}async createCustomPrompt(W,ie){return this.sendRequest("POST","/create_custom_prompt",W,[],!1,ie)}async updateCustomPrompt(W,ie){return this.sendRequest("POST","/update_custom_prompt",W,[],!1,ie)}async deleteCustomPrompt(W,ie){return this.sendRequest("POST","/delete_custom_prompt",W,[],!1,ie)}async updateCustomPromptPosition(W,ie){return this.sendRequest("POST","/update_custom_prompt_position",W,[],!1,ie)}async inviteList(W,ie){return this.sendRequest("GET","/invite_list",W,[],!1,ie)}}K.Api=V})(y=H.User||={});let v;(K=>{class N extends ae.ApiRequestError{errorName="vip.exceptions.NoCustomerError"}K.NoCustomerError=N;class Q extends ae.ApiRequestError{errorName="vip.exceptions.SubscriptionStatusError"}K.SubscriptionStatusError=Q;class j extends ae.ApiRequestError{errorName="vip.exceptions.StripeError"}K.StripeError=j;class k extends ae.ApiRequestError{errorName="vip.exceptions.FrequentlyError"}K.FrequentlyError=k;class L extends ae.ApiRequestError{errorName="vip.exceptions.TrialError"}K.TrialError=L;class V extends ae.BaseDomainApi{pathPrefix="/vip";async test(W){return this.sendRequest("GET","/test",null,[],!1,W)}async getVipStatus(W){return this.sendRequest("GET","/get_vip_status",null,[],!1,W)}async getSubscriptionPlans(W){return this.sendRequest("GET","/get_subscription_plans",null,[],!1,W)}async createSubscriptionCheckout(W,ie){return this.sendRequest("POST","/create_subscription_checkout",W,[],!1,ie)}async cancelSubscription(W){return this.sendRequest("POST","/cancel_subscription",null,[],!1,W)}async resubscribeSubscription(W){return this.sendRequest("POST","/resubscribe_subscription",null,[],!1,W)}async checkoutStatus(W,ie){return this.sendRequest("GET","/checkout_status",W,[],!1,ie)}}K.Api=V})(v=H.Vip||={});class P extends ae.BaseSession{notificationApi;skillApi;taskApi;userApi;vipApi;_initApis(Q){this.notificationApi=new D.Api(Q,this),this.skillApi=new $.Api(Q,this),this.taskApi=new O.Api(Q,this),this.userApi=new y.Api(Q,this),this.vipApi=new v.Api(Q,this)}}class F extends ae.BaseSdk{notificationApi;skillApi;taskApi;userApi;vipApi;allExceptions={"exceptions.CommonError":u,"exceptions.InternalError":r,"exceptions.AuthError":s,"exceptions.UserAuthError":a,"exceptions.ResourceNotFoundError":p,"exceptions.ValidationError":g,"exceptions.UnexpectedError":C,"exceptions.NotImplementError":x,"exceptions.DomainError":T,"skill.exceptions.SkillNotExistError":$.SkillNotExistError,"skill.exceptions.SkillNotOwnedError":$.SkillNotOwnedError,"task.exceptions.ChatError":O.ChatError,"task.exceptions.QuotaExceededError":O.QuotaExceededError,"task.exceptions.UidDuplicateError":O.UidDuplicateError,"task.exceptions.CustomPromptError":O.CustomPromptError,"task.exceptions.ConversationNotExistError":O.ConversationNotExistError,"task.exceptions.SharedConversationNotExistError":O.SharedConversationNotExistError,"task.exceptions.ReadEnhanceIndexNotPreparedError":O.ReadEnhanceIndexNotPreparedError,"task.exceptions.ConversationAlreadyExistReadEnhanceIndexError":O.ConversationAlreadyExistReadEnhanceIndexError,"task.exceptions.ReadingQuotaExceededError":O.ReadingQuotaExceededError,"task.exceptions.ReadingColdDownError":O.ReadingColdDownError,"user.exceptions.UserNotExistsError":y.UserNotExistsError,"user.exceptions.OauthCallbackError":y.OauthCallbackError,"user.exceptions.UserAlreadyExistsError":y.UserAlreadyExistsError,"user.exceptions.PasswordError":y.PasswordError,"user.exceptions.UserRegisterAfterLogoffError":y.UserRegisterAfterLogoffError,"vip.exceptions.NoCustomerError":v.NoCustomerError,"vip.exceptions.SubscriptionStatusError":v.SubscriptionStatusError,"vip.exceptions.StripeError":v.StripeError,"vip.exceptions.FrequentlyError":v.FrequentlyError,"vip.exceptions.TrialError":v.TrialError};constructor(Q){super(Q),this.notificationApi=new D.Api(this),this.skillApi=new $.Api(this),this.taskApi=new O.Api(this),this.userApi=new y.Api(this),this.vipApi=new v.Api(this)}async session(Q,j,k){return this.getSession(Q,j,k,P)._run()}}H.Sdk=F})(xn||={});var gr=`${Z.getWebOrigin()}/api`,co=()=>({"Content-Type":"application/json","X-Client-Version":Z.getExtensionVersion(),"X-Product-Name":Z.getProductName()}),_v={baseUrl:gr,globalSetHeader(u){let r=co();return{...u,...r}},globalErrorHandler:u=>(console.warn("ApiRequestError",u.code,`(${u.httpStatus}, ${u.httpStatusText})`),!1)},ge=new xn.Sdk(_v);var bv="https://chatgpt4google.com/api",lo=class{async createShare(r){return await fetch(`${this.getFullUrl("/share/create")}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:JSON.stringify({messages:r.messages,modelName:r.modelName})})}).then(s=>s.json())}async getUserVersion(r){let a=await(await fetch(this.getFullUrl("/version/get"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Z.underlize(r))})).json();return Z.camelize(a)}fetchPromotion=async()=>await(await fetch(this.getFullUrl("/p","old"),{headers:{"x-version":Z.getExtensionVersion()}})).json();getFullUrl(r,s="new"){return`${s==="old"?bv:gr}${r}`}},di=new lo;var vc=b(rt(),1);var Dy=b(I(),1);var dy=b(I(),1);var gy=b(I(),1),fi=class{emitter;event;handler;destroyed=!1;listenBy;constructor(r,s,a,p){this.event=r,this.handler=s,this.emitter=a,this.listenBy=p}unregister(){this.emitter.off(this.event,this),this._destroy()}_destroy(){return this.destroyed?!1:(this.handler=null,this.emitter=null,this.destroyed=!0,!0)}},$n=class{_events={};on(r,s){if(!s)throw new TypeError("invalid handler! --EventEmitter");this._events[r]||(this._events[r]=[]);let a=new fi(r,s,this,null);return this._events[r]?.push(a),a}listenBy(r,s,a){if(!a)throw new TypeError("invalid handler! --EventEmitter");this._events[s]||(this._events[s]=[]);let p=new fi(s,a,this,r);return this._events[s]?.push(p),p}once(r,s){let a=this.on(r,p=>{s(p),a.unregister()});return a}emit(r,s=null){if(!this._events[r])return!1;let a=[];for(let p of this._events[r])p.destroyed||(a.push(p),p.handler.call(this,s));return!0}off(r,s){if(!this._events[r])return!1;if(s){for(let a=this._events[r],p=0;p<a.length;p++){let g=a[p];if(g===s)return this._events[r]=this._events[r]?.filter(C=>C!==g),this._events[r]?.length===0&&delete this._events[r],!0}return console.error(s,this),console.error(`Cannot find listener of ${r} --EventEmitter`),!1}for(let a=this._events[r],p=0;p<a.length;p++){let g=a[p];this._events[r][p]=null,g._destroy()}return delete this._events[r],!0}stopListenBy(r){for(let s in this._events)this._events[s]=this._events[s]?.filter(a=>a.listenBy===r?(a._destroy(),!1):!0)}removeAllListeners(){for(let r in this._events){let s=this._events[r];for(let a=s,p=0;p<a.length;p++)s[p]=null;this._events[r]=null}}};var wy=b(I(),1);var my=b(I());function pc(u){let r,s,a,p,g,C,x;return T(),{feed:D,reset:T};function T(){r=!0,s="",a=0,p=-1,g=void 0,C=void 0,x=""}function D(O){s=s?s+O:O,r&&xv(s)&&(s=s.slice(dc.length)),r=!1;let y=s.length,v=0,P=!1;for(;v<y;){P&&(s[v]===`
`&&++v,P=!1);let F=-1,H=p,N;for(let Q=a;F<0&&Q<y;++Q)N=s[Q],N===":"&&H<0?H=Q-v:N==="\r"?(P=!0,F=Q-v):N===`
`&&(F=Q-v);if(F<0){a=y-v,p=H;break}else a=0,p=-1;$(s,v,H,F),v+=F+1}v===y?s="":v>0&&(s=s.slice(v))}function $(O,y,v,P){if(P===0){x.length>0&&(u({type:"event",id:g,event:C||void 0,data:x.slice(0,-1)}),x="",g=void 0),C=void 0;return}let F=v<0,H=O.slice(y,y+(F?P:v)),N=0;F?N=P:O[y+v+1]===" "?N=v+2:N=v+1;let Q=y+N,j=P-N,k=O.slice(Q,Q+j).toString();if(H==="data")x+=k?"".concat(k,`
`):`
`;else if(H==="event")C=k;else if(H==="id"&&!k.includes("\0"))g=k;else if(H==="retry"){let L=parseInt(k,10);Number.isNaN(L)||u({type:"reconnect-interval",value:L})}}}var dc=[239,187,191];function xv(u){return dc.every((r,s)=>u.charCodeAt(s)===r)}var po=Oe.getLogger("ChatService"),hr=class{onData=null},gi=class{constructor(r){this.chatService=r}baseUrl="https://chat.openai.com/backend-api";taskMap={};modelNameMap={};async getToken(){let r=await fetch("https://chat.openai.com/api/auth/session");if(r.status===403)throw"CLOUDFLARE";let s=await r.json();if(s.accessToken)return s.accessToken;throw"UNAUTHORIZED"}async fetchModels(r){return(await this.fetch({method:"GET",path:`${this.baseUrl}/models`,headers:this.getRequestHeader(r)})).models}async feedback(r,s){return await this.fetch({method:"POST",path:`${this.baseUrl}/conversation/message_feedback`,headers:this.getRequestHeader(r),data:s})}cancelTask(r,s){let a=this.taskMap[s.taskId];a&&(a.abortController.abort(),delete this.taskMap[a.taskId])}async updateTitle(r,s){return await this.fetch({method:"POST",path:`${this.baseUrl}/conversation/gen_title/${s.chatGptConvId}`,headers:this.getRequestHeader(r),data:{message_id:s.messageId,model:await this.getModelName(r,s.conversationId)}})}async getAnswer(r,s){let a=new hr,p=new AbortController,g={taskId:s.taskId,abortController:p,conversationId:s.conversationId};return this.doGetAnswer({token:r,taskInfo:g,params:s,resp:a}).catch(C=>{a.onData?.(null,!0,C)}),a}async deleteConversation(r,s){let{conversationId:a}=s;for(let C of Object.keys(this.taskMap))this.taskMap[C].conversationId===a&&this.cancelTask(r,{taskId:C});let g=(await this.chatService.getChatGptConversationMap())[a];if(!g)throw"CONVERSATION_NOT_FOUND";return this.chatService.removeChatGptConversationData(a),await this.fetch({path:`${this.baseUrl}/conversation/${g.chatGptConvId}`,method:"PATCH",headers:this.getRequestHeader(r),data:{isVisible:!1}})}async doGetAnswer(r){let{token:s,taskInfo:a,params:p,resp:g}=r;this.taskMap[a.taskId]=a;let C=null,x=Z.genId();await this.fetchCompletions({question:p,messageId:x,token:s,taskInfo:a,onMessage:T=>{if(T==="[DONE]"){this.chatService.getChatGptConversationMap().then(D=>{po.log("chat gpt resp msg:",{...C,chatGptConvId:D[p.conversationId].chatGptConvId})}),g.onData?.(C,!0),this.cancelTask(s,{taskId:a.taskId});return}try{let D=JSON.parse(T);if(D.message?.author?.role!=="assistant")return;let $=D.message?.content?.parts?.[0];$&&(this.chatService.getChatGptConversationMap().then(O=>{let y=p.conversationId;O[y]||this.chatService.addChatGptConversationData(y,{chatGptConvId:D.conversation_id,createdAt:Date.now()})}),C={content:$,parentMessageId:x,type:"answer",messageId:D.message.id,conversationId:p.conversationId},g.onData?.(C,!1))}catch(D){po.error("unsupported streaming msg:",D)}}})}async getModelName(r,s){try{if(!this.modelNameMap[s]){let p=(await Ee.get("provider:chatgpt"))?.modelType??"GPT-3.5 Turbo",g=await this.fetchModels(r),C;if(p==="Auto"){let x=g.find(T=>T.slug==="gpt-4");C=x?x.slug:g[0].slug}else C=g[0].slug;this.modelNameMap[s]=C}return this.modelNameMap[s]}catch(a){return po.error(a),"text-davinci-002-render-sha"}}getRequestHeader(r){return{"Content-Type":"application/json",Authorization:`Bearer ${r}`}}async fetchCompletions(r){let{onMessage:s,taskInfo:a,question:p,messageId:g,token:C}=r,x=await this.chatService.getChatGptConversationMap(),T=await this.getModelName(C,p.conversationId),D=x[p.conversationId],$=a.abortController.signal;if($.aborted)return;let O=await this.fetch({method:"POST",path:`${this.baseUrl}/conversation`,headers:this.getRequestHeader(C),returnOriginResponse:!0,signal:a.abortController.signal,data:{action:"next",messages:[{id:g,role:"user",content:{contentType:"text",parts:[p.content]}}],conversationId:D?D.chatGptConvId:void 0,model:T,parentMessageId:p.parentMessageId||Z.genId()}});if(!O.ok){let P=await O.json().catch();throw this.openApiErrorHandler(P)}let y=pc(P=>{P.type==="event"&&s(P.data)}),v=O.body.getReader();try{for(;!$.aborted;){let{done:P,value:F}=await v.read();if(P)return;let H=new TextDecoder().decode(F);y.feed(H)}}catch{v.releaseLock()}}async fetch(r){let s=Z.underlize(r.data),a=await fetch(r.path,{method:r.method,headers:r.headers,body:s==null?void 0:JSON.stringify(s),signal:r.signal});if(a.status===403)throw"CLOUDFLARE";if(r.returnOriginResponse)return a;if(a.ok){let g=await a.json();return Z.camelize(g)}let p=await a.json().catch(()=>({}));throw r.errorHandler?r.errorHandler(p):this.openApiErrorHandler(p)}openApiErrorHandler(r){let s="",a="";if(r?.detail){let p=r.detail;typeof p=="string"?s=p:p.message&&typeof p.message=="string"&&(s=p.message,a=p.code)}return s?s.includes("Too many requests")?"TOO_MANY_REQUESTS":s.includes("Unauthorized")||s.includes("expired")||a==="invalid_jwt"?"UNAUTHORIZED":s.includes("Not Found")?"OPENAI_NOT_FOUND":s:"UNKNOWN"}};var lt=b(rt(),1),hi=Oe.getLogger("ChatService"),Tv=3600*1e3*72,mi=class{constructor(r,s){this.storage=r;this.service=s;this.init().then(()=>{this.chatGptRequester=new gi(this.service)}).catch(a=>{hi.error("ChatGptProvider init error",a)})}currentSenderPort;get currentSenderTabId(){return this.currentSenderPort?.sender?.tab?.id}pendingRequests={};chatGptRequester;conversationMap;initReady=!1;events=new $n;async init(){this.storage.removeDeprecated("chatGpt"),this.conversationMap=await this.loadConversationMap(),await this.removeOutdatedConversations(),me.isProd&&this.initRequestSenderForProd(),lt.default.runtime.onConnect.addListener(r=>{r.name==="ChatGptRequestSender"&&(hi.log("ChatGptRequestSender connected"),this.currentSenderPort&&this.disposeCurrentSenderPort(),this.currentSenderPort=r,r.onMessage.addListener(s=>{this.pendingRequests[s.reqId](s)}),r.onDisconnect.addListener(()=>{r===this.currentSenderPort&&(this.currentSenderPort=void 0)}))}),this.initReady=!0,this.events.emit("initReady")}async loadConversationMap(){let r=await this.storage.get("chatGptConversationMap");return r||hi.error("No conversationMap when init"),r||{}}initRequestSenderForProd(){this.searchAndInsertRequestSender(),lt.default.tabs.onUpdated.addListener((r,s)=>{lt.default.tabs.get(r).then(a=>{this.isTargetHost(a.url)&&s.status==="complete"&&(this.disposeCurrentSenderPort(),this.insertScriptToTab(r))})}),lt.default.tabs.onRemoved.addListener(r=>{r===this.currentSenderTabId&&(this.disposeCurrentSenderPort(),this.searchAndInsertRequestSender())})}async createConversation(){return`conv:${Z.genId()}`}async addConversationData(r,s){this.conversationMap[r]=s,await this.saveConversationMap()}async removeConversationData(r){delete this.conversationMap[r],await this.saveConversationMap()}async feedback(r){return this.callRequestMethod("feedback",r)}async deleteConversation(r){let s=this.conversationMap[r];!s||s.kept||this.callRequestMethod("deleteConversation",{conversationId:r})}cancelTask(r){return this.callRequestMethod("cancelTask",{taskId:r})}getAnswer(r,s){let a=`task:${Z.genId()}`;return(async()=>{let g=await Ee.get("language");r.parentMessageId||(r.content=Z.addPromptLangSuffix(r.content,g)),this.callRequestMethod("getAnswer",{taskId:a,...r},s)})(),{taskId:a}}hasChatGptTab(){return!!this.currentSenderPort?.sender?.tab}focusChatGptTab(r=!1){if(!this.hasChatGptTab())return!1;let s=this.currentSenderPort.sender.tab;return lt.default.windows.update(s.windowId,{focused:!0}),lt.default.tabs.update(s.id,{active:!0}),r&&lt.default.tabs.reload(s.id),!0}createChatGptTab(){return lt.default.windows.create({url:"https://chat.openai.com/chat",type:"normal",width:200,focused:!0}),!0}async getConversationMap(){return this.initReady?this.conversationMap:new Promise(r=>{this.events.once("initReady",()=>{r(this.conversationMap)})})}async saveConversationMap(){return this.storage.update({chatGptConversationMap:this.conversationMap})}async openInChatGptWebApp(r){if(!this.conversationMap[r])return;let s=this.conversationMap[r];lt.default.tabs.create({url:`https://chat.openai.com/chat/${s.chatGptConvId}`,active:!0})}async keepConversation(r,s){if(!this.conversationMap[r])return;let a=this.conversationMap[r];a.kept=!0,this.saveConversationMap();let p=a.chatGptConvId,g={conversationId:r,chatGptConvId:p,messageId:s};this.callRequestMethod("updateTitle",g)}async unKeepConversation(r){this.conversationMap[r]&&(this.conversationMap[r].kept=!1,this.saveConversationMap())}async updateToken(r){await this.storage.set("chatGptToken",r)}isTargetHost(r){return r?.includes("https://chat.openai.com")}isTargetTab(r){return this.isTargetHost(r.url)&&r.id}disposeCurrentSenderPort(){this.currentSenderPort&&(this.currentSenderPort.disconnect(),this.currentSenderPort=void 0)}searchAndInsertRequestSender(){this.currentSenderPort||lt.default.tabs.query({}).then(r=>{for(let s of r)if(this.isTargetTab(s)){this.insertScriptToTab(s.id);break}})}async insertScriptToTab(r){lt.default.scripting.executeScript({target:{tabId:r},files:["chatGptInjection.js"]}),lt.default.scripting.insertCSS({target:{tabId:r},files:["chatGptInjection.css"]})}async callRequestMethod(r,s,a){if(this.currentSenderPort){let p=Z.genId();return new Promise((g,C)=>{this.pendingRequests[p]=T=>{let{respType:D,data:$,finished:O,error:y}=T;D==="data"?(a?.($,O,this.normalizeError(y)),O&&(g(null),delete this.pendingRequests[p])):D==="resp"?(g($),delete this.pendingRequests[p]):(C($),delete this.pendingRequests[p])};let x={event:"callMethod",reqId:p,data:{method:r,params:s}};this.currentSenderPort.postMessage(x)}).catch(g=>{throw a?.(null,!0,this.normalizeError(g)),g})}else try{let p=await this.getToken(),g=await this.chatGptRequester[r](p,s);return g instanceof hr?(g.onData=(C,x,T)=>{a?.(C,x,this.normalizeError(T))},null):g}catch(p){throw a?.(null,!0,this.normalizeError(p)),p}}normalizeError(r){return r===void 0?r:(hi.error(r,JSON.stringify(r)),typeof r=="string"?r:"UNKNOWN_OPENAI_ERROR")}async getToken(r=!0){if(r){let a=await this.storage.get("chatGptToken");if(a)return a}let s=await this.chatGptRequester.getToken();return await this.storage.update({chatGptToken:s}),s}async removeOutdatedConversations(){let r=this.conversationMap,s=Date.now();for(let a of Object.keys(r)){let{createdAt:p=0}=r[a];s-p>Tv&&delete r[a]}await this.saveConversationMap()}};var Hy=b(I(),1);var fo=Oe.getLogger("ChatService"),gc=800,Sv=3600*1e3*72,mc="A",hc="You",Av=`
${mc}: `,vi=class{constructor(r){this.storage=r;this.removeOutdatedConversations()}host="https://api.openai.com/v1";pendingTasks={};async createConversation(){return`conv:${Z.genId()}`}async getAnswer(r,s){let a=`task:${Z.genId()}`,p=`msg:${Z.genId()}`,g=r.conversationId;await this.addConversationMessage({...r,messageId:p,type:"question"});let C={conversationId:g,messageId:`msg:${Z.genId()}`,type:"answer",content:""},x=new AbortController,T={taskId:a,conversationId:g,abortController:x};this.pendingTasks[a]=T;let D=!1;return this.fetchCompletions({convId:g,taskInfo:T,onData:$=>{C.content+=$.text||"",s(C,$.finished,$.error),$.finished&&(D=!0,fo.debug("answer finished",C),this.addConversationMessage(C))},onAbort:()=>{!D&&C.content.trim()&&(fo.debug("aborted, save partial message",C),this.addConversationMessage(C))}}).catch($=>{throw s(null,!0,`${$}`),$}),{taskId:a}}async cancelTask(r){let s=this.pendingTasks[r];fo.debug("cancel task",s),s&&await this.handleTaskFinish(s)}async deleteConversation(r){for(let a of Object.keys(this.pendingTasks))this.pendingTasks[a].conversationId===r&&this.cancelTask(a);let s=await this.getStore();delete s.conversations[r],this.saveStore(s)}async feedback(r){return!0}async addConversationMessage(r){let s=await this.getStore(),a=r.conversationId;s.conversations[a]||(s.conversations[a]={messages:[],createdAt:Date.now()}),s.conversations[a].messages.push(r),await this.saveStore(s)}async getStore(){return this.storage.get("gpt3")}async saveStore(r){return this.storage.set("gpt3",r)}async fetchCompletions(r){let{taskInfo:s,onData:a,onAbort:p}=r;if(s.abortController.signal.aborted)return;let C=await this.getProviderConfigs(),{apiKey:x,modelType:T="chat_model"}=C||{},D;if(T==="chat_model"?D=await this.fetchChatCompletions(r,x):D=await this.fetchTextCompletions(r,x),D.status!==200)throw`${D.statusText}(${D.status})`;let $=D.body?.pipeThrough(new TextDecoderStream).getReader(),O=!1;for(;;){let y;try{y=await $?.read()}catch{p();return}if(!y||y.done)return;let P=y.value.split(/\r?\n\r?\n/);for(let F of P){let H=F.replace(/^data: /,""),N;T==="chat_model"?N=k=>{let L=k.choices[0];return L.finish_reason?{text:"",finished:!0}:{text:L.delta?.content||"",finished:!1}}:N=k=>{let L=k.choices[0];return L.finish_reason?{text:"",finished:!0}:{text:L.text,finished:!1}};let Q=this.parseStreamResult(H,N),{text:j}=Q;if(O||(j=j.replace(/^\n*/,"")),j.length>0&&(O=!0),a({text:j,finished:Q.finished}),Q.finished){this.handleTaskFinish(s);return}}}}async fetchTextCompletions(r,s){let a=await this.createPrompt(r.convId);return fetch(`${this.host}/completions`,{headers:this.getHeaders(s),method:"POST",signal:r.taskInfo.abortController.signal,body:JSON.stringify({model:Ks["text_model"],prompt:a,stream:!0,temperature:.3,stop:Av,max_tokens:gc})})}async fetchChatCompletions(r,s){return fetch(`${this.host}/chat/completions`,{headers:this.getHeaders(s),method:"POST",signal:r.taskInfo.abortController.signal,body:JSON.stringify({model:Ks["chat_model"],messages:await this.createPromptMessages(r.convId),stream:!0,temperature:.5,max_tokens:gc})})}async createPrompt(r){let s=await this.getStore(),a=await Ee.getAll(),p=a.language,x=(a["provider:gpt3"]?.guideType||"default")==="default"?Xu:Ju;return s.conversations[r].messages.forEach((T,D)=>{let $=T.type==="question"?mc:hc,O=T.content.trim();D===0&&(O=Z.addPromptLangSuffix(O,p)),x+=`${$}: ${O}
`}),x+=`${hc}:`,x}async createPromptMessages(r){let s=await this.getStore(),a=await Ee.getAll(),p=a.language,x=[{role:"system",content:(a["provider:gpt3"]?.guideType||"default")==="default"?ju:Zu}];return s.conversations[r].messages.forEach((T,D)=>{let $=T.type==="question"?"user":"assistant",O=T.content.trim();D===0&&(O=Z.addPromptLangSuffix(O,p)),x.push({role:$,content:O})}),x}getHeaders(r){return{"Content-Type":"application/json",Authorization:`Bearer ${r}`}}parseStreamResult(r,s){if(!r)return{text:"",finished:!1};if(r==="[DONE]")return{text:"",finished:!0};let a=JSON.parse(r);if(a.error)throw typeof a.error=="string"?a.error:a.error?.message||"UNKNOWN_OPENAI_ERROR";return s(a)}async handleTaskFinish(r){r.abortController.abort(),delete this.pendingTasks[r.taskId]}async getProviderConfigs(){let{configs:r}=await Ee.getProviderConfigs();return r}async removeOutdatedConversations(){let r=await this.getStore(),s=Date.now();for(let a of Object.keys(r.conversations)){let{createdAt:p=0}=r.conversations[a];s-p>Sv&&delete r.conversations[a]}await this.saveStore(r)}};var cn=class extends Ke{storagePrefix="chat";defaultStorageValues={tabConversationMap:{},gpt3:{conversations:{}},chatGptToken:null,chatGptConversationMap:{}};providers;onInit(){this.providers={chatGpt:new mi(this.storage,this),gpt3:new vi(this.storage)},vc.default.tabs.onRemoved.addListener(async r=>{this.onTabUnload(r)})}async createConversation(){let r=this.lastCaller?.tabId,s;if(await this.getProviderType()==="gpt3"&&(s=await this.providers.gpt3.createConversation()),s=await this.providers.chatGpt.createConversation(),r){let a=await this.storage.get("tabConversationMap");a[r]=s,await this.storage.update({tabConversationMap:a})}return s}async getAnswer(r,s){return await this.getProviderType()==="gpt3"?this.providers.gpt3.getAnswer(r,s):this.providers.chatGpt.getAnswer(r,s)}async feedback(r){return await this.getProviderType()==="gpt3"?this.providers.gpt3.feedback(r):this.providers.chatGpt.feedback(r)}createShare(r,s){return di.createShare({messages:r,modelName:s})}async cancelTask(r){return await this.getProviderType()==="gpt3"?this.providers.gpt3.cancelTask(r):this.providers.chatGpt.cancelTask(r)}async addChatGptConversationData(r,s){return this.providers.chatGpt.addConversationData(r,s)}async removeChatGptConversationData(r){return this.providers.chatGpt.removeConversationData(r)}async deleteConversation(r){await Promise.all([this.providers.gpt3.deleteConversation(r),this.providers.chatGpt.deleteConversation(r)])}async getChatGptConversationMap(){return this.providers.chatGpt.getConversationMap()}async clearChatGptToken(){await this.storage.update({chatGptToken:null})}openInChatGptWebApp(r){this.providers.chatGpt.openInChatGptWebApp(r)}async keepChatGptConversation(r,s){this.providers.chatGpt.keepConversation(r,s)}async unKeepChatGptConversation(r){this.providers.chatGpt.unKeepConversation(r)}updateChatGptToken(r){return this.providers.chatGpt.updateToken(r)}async onTabUnload(r){let s=await this.storage.get("tabConversationMap"),a=s[r];a&&(this.deleteConversation(a),delete s[r]);for(let p of Object.keys(s))await Z.tryGetTab(p)||(this.deleteConversation(a),delete s[p]);await this.storage.update({tabConversationMap:s})}async getProviderType(){return Ee.get("provider")}};nt(cn,"serviceName","ChatService");var e_=b(I(),1);var Ci=new Ve(cn.serviceName,cn);var Pb=b(I(),1);var u_=b(I(),1),yi;(x=>{function u(T){return T.itemType==="reply"&&T.data.type==="error"}x.isErrorReply=u;function r(T){return T.itemType==="guide"}x.isGuide=r;function s(T){return T.itemType==="intent"}x.isIntent=s;function a(T){return T.itemType==="reply"}x.isReply=a;function p(T){return T.itemType==="question"}x.isQuestion=p;function g(T){return T.itemType==="reply"||T.itemType==="question"}x.isChatMessage=g;function C(T){return T.itemType==="reply"&&T.data.type==="read_enhance"}x.isReadReply=C})(yi||={});var xb=b(I(),1);var ho=b(rt(),1);var tb=b(I(),1);var M_=b(I(),1);var w_=b(I(),1);var f_=b(I(),1);var{ApiRequestError:l_,ApiRequestAborted:p_}=ae;var Wn=b(rt(),1);var Vt=class extends Ke{storagePrefix="user";defaultStorageValues={userInfo:null,userVipStatus:null,myPrompts:[],selectionActions:[],userBatch:null,clientId:"",token:null};onInit(){Wn.default.storage.local.onChanged.addListener(r=>{let s=r[this.storage.encodeKey("userInfo")],a=r[this.storage.encodeKey("userVipStatus")],p=r[this.storage.encodeKey("myPrompts")],g=r[this.storage.encodeKey("selectionActions")];s&&this.emit("userInfoChange",{userInfo:s.newValue||null}),a?.newValue&&this.emit("userVipStatusChange",{userVipStatus:a.newValue}),p&&this.emit("myPromptsChange",{items:p.newValue}),g&&this.emit("selectionActionsChange",{items:g.newValue})}),He.addExternalListener("webEvent",(r,s,a,p)=>{if(r.event==="markAuth"){let g=r.payload;a.tab?.id&&g.loginEntry==="extension"&&Wn.default.tabs.remove(a.tab.id),He.broadcastFromBackground("webEvent",r),this.markAuthComplete(g)}if(r.event==="getUserInfo")return this.sendUserInfo(p),!0;if(r.event==="logout"&&(this.logout(),He.broadcastFromBackground("webEvent",r)),r.event==="markPaid"&&He.broadcastFromBackground("webEvent",r),r.event==="openShortcuts"&&Ee.openShortcutsPage(),r.event==="openOptions"){let g=r.payload;a.tab?.id&&!g.newTab?Wn.default.tabs.update(a.tab.id,{url:Wn.default.runtime.getURL("options.html")}):Ee.openOptionsPage()}r.event==="showSkills"&&a.tab?.id&&He.sendToContent(a.tab?.id,"webEvent",r)}),this.initClientId()}async markAuthComplete(r){await this.storage.update({userInfo:r.userInfo,userVipStatus:r.userVipStatus,myPrompts:[],selectionActions:[],token:r.token}),this.getCustomPrompts("my_prompt"),this.getCustomPrompts("selection_action")}async getUserInfo(r){return this._fetchWithCache("userInfo",async()=>{try{return(await ge.userApi.me()).user}catch(s){if(s instanceof xn.UserAuthError||s instanceof xn.AuthError)return await this.handleLogout(),null;throw s}},r)}async getVipStatus(r){return this._fetchWithCache("userVipStatus",async()=>(await ge.vipApi.getVipStatus()).vipStatus,r)}async getUserStatus(){let r=await this.storage.getAll(),[s,a]=await Promise.all([async()=>{if(r.userInfo)return Promise.resolve(r.userInfo);let{user:p}=await ge.userApi.me();return this.storage.set("userInfo",p),p},async()=>{if(r.userVipStatus)return Promise.resolve(r.userVipStatus);let{vipStatus:p}=await ge.vipApi.getVipStatus();return this.storage.set("userVipStatus",p),p}]);return{userInfo:s,vipStatus:a}}async getUserVersion(){let{clientId:r,userBatch:s}=await this.storage.getAll();return di.getUserVersion({clientId:r,userBatch:s})}async logout(){await ge.userApi.logout(),await this.clearUserInfo()}async clearUserInfo(){await this.storage.update({userInfo:null,userVipStatus:null,myPrompts:[],selectionActions:[],token:null})}async openGoogleAuthWindow(r){let s=Z.getWebOrigin(),a=`${s}/api/user/oauth2_authorize?redirect_url=`,p=`${s}/auth-landing?from=extension`,g=`${a}${p}`,C=500,x=600,{availLeft:T,availTop:D,height:$,width:O}=r,y=Math.round((O-C)/2)+T,v=Math.round(($-x)/2)+D;Wn.default.windows.create({url:g,focused:!0,width:C,height:x,type:"popup",left:y,top:v})}async getUserLanguages(){let r=await this.getUserInfo();return r?r.languagePreferences||[]:[]}async updateUserLanguages(r){await ge.userApi.updateLanguagePreferences({languagePreferences:r.filter(s=>s.toLowerCase()!=="auto")}),await this.getUserInfo()}async getCustomPrompts(r,s){let a=this.getCustomPromptStorageKey(r);return this._fetchWithCache(a,async()=>(await ge.userApi.customPromptList({type:r})).items,s)}async updateCustomPrompt(r,s){return await ge.userApi.updateCustomPrompt(s),await this.getCustomPrompts(r,{useCache:!1}),!0}async deleteCustomPrompt(r,s){return await ge.userApi.deleteCustomPrompt({id:s}),await this.getCustomPrompts(r,{useCache:!1}),!0}async addCustomPrompt(r,s){return await ge.userApi.createCustomPrompt({...s,type:r}),await this.getCustomPrompts(r,{useCache:!1}),!0}async sortCustomPrompt(r,s,a){return await ge.userApi.updateCustomPromptPosition({id:s,position:a}),await this.getCustomPrompts(r,{useCache:!1}),!0}async setUserBatch(r){await this.storage.get("userBatch")||await this.storage.set("userBatch",r)}getToken(r){return this._fetchWithCache("token",async()=>{let{token:s}=await ge.userApi.authSession();return s},r)}getCustomPromptStorageKey(r){if(r==="selection_action")return"selectionActions";if(r==="my_prompt")return"myPrompts";throw new Error("Invalid custom prompt type")}async handleLogout(){this.clearUserInfo(),this.emit("userLogout",{})}async initClientId(){if(!await this.storage.get("clientId")){let s=Z.genId();await this.storage.set("clientId",s)}}async sendUserInfo(r){let s=await this.storage.getAll(),a=await this.getToken(),p={userInfo:s.userInfo,userVipStatus:s.userVipStatus,token:a};r(p)}};nt(Vt,"serviceName","UserService");var I_=b(I(),1);var Qe=new Ve(Vt.serviceName,Vt);var bi=b(ai(),1),yc=b(rt(),1);var $_=b(I(),1);var Hn=Oe.getLogger("MonicaService"),ln=class{constructor(r){this.context=r;this.init().then(()=>{this.initReady=!0,this.events.emit("initReady")})}events=new $n;initReady=!1;get host(){return this.context.apiHost}get storage(){return this.context.storage}pendingTasks={};async onTabUnload(r){}genTaskId(){return`task:${Z.genId()}`}async cancelTask(r){let s=this.pendingTasks[r];Hn.debug("cancel task",s),s&&await this.markTaskFinished(s)}async createGenerationTask(r){let{taskInfo:s,onData:a,onAbort:p}=r;this.pendingTasks[s.taskId]=s;let g=s.abortController.signal;if(g.aborted)return;let C,x;if(r.taskData?(x="server",C=await this.fetchServerGeneration({...r.taskData,taskUid:s.taskId,language:r.language,abortSignal:g})):(x="openAi",C=await this.fetchOpenAiCompletion({...r.openAiParams,abortSignal:g})),C.status!==200)throw`${C.statusText}(${C.status})`;let T=C.body?.pipeThrough(new TextDecoderStream).getReader(),D=!1,$="",O=/\r?\n\r?\n/,y=/\r?\n\r?\n$/;for(;;){let v;try{v=await T?.read(),Hn.debug("got message",v)}catch{p();return}if(!v||v.done)return;if($+=v.value,!y.test($))continue;Hn.debug("[Value Received]"),Hn.debug($);let P=$.split(O);$="";for(let F of P){let H=F.replace(/^data: /,"");Hn.debug({chunk:F,data:H});let N=this.parseStreamResult(H,x),{text:Q}=N;if(D||(Q=Q.replace(/^\n*/,"")),Q.length>0&&(D=!0),a({text:Q,finished:N.finished,sources:N.sources}),N.finished){this.markTaskFinished(s);return}}}}async fetchOpenAiCompletion(r){let s="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",a="text-davinci-003";return fetch("https://api.openai.com/v1/completions",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},method:"POST",signal:r.abortSignal,body:JSON.stringify(Z.underlize({model:a,stream:!0,prompt:r.prompt,temperature:r.temperature,stop:r.stopWord,maxTokens:r.maxTokens}))})}async fetchServerGeneration(r){let s=`${this.context.apiHost}/generate/gen`,a={taskType:r.taskType,taskUid:r.taskUid,language:r.language,data:r.data};return fetch(s,{headers:co(),method:"POST",signal:r.abortSignal,body:JSON.stringify(Z.underlize(a))})}findAndCancelTasks(r){for(let s of Object.keys(this.pendingTasks))r(this.pendingTasks[s])&&this.cancelTask(s)}parseStreamResult(r,s){if(!r)return{text:"",finished:!1};if(r==="[DONE]")return{text:"",finished:!0};let a;try{a=JSON.parse(r)}catch(p){throw Hn.error(p),"INVALID_MESSAGE_CONTENT"}if(s==="openAi"){if(a.error)throw typeof a.error=="string"?a.error:a.error?.message||"UNKNOWN_OPENAI_ERROR";let p=a.choices[0];if(!p.finish_reason)return{text:p.text,finished:!1}}else{let p=Z.camelize(a);if(p.error)throw p.error.code===10002?"QUOTA_EXCEEDED":p.error.msg;return{text:p.text,finished:p.finished||!1,sources:p.sources}}return{text:"",finished:!0}}async markTaskFinished(r){r.abortController.abort(),delete this.pendingTasks[r.taskId],setTimeout(()=>{Qe.getVipStatus()},1e3)}};var Vn=Oe.getLogger("MonicaService"),kv=7*24*3600*1e3,_i=class extends ln{conversations;tabActiveConversationMap;async init(){this.conversations=await this.storage.get("conversations")||{},this.tabActiveConversationMap=await this.storage.get("tabActiveConversationMap")||{},await this.removeOutdatedConversations()}async onTabUnload(r){let s=await this.storage.get("tabConversationMap"),a=s[r];a&&(await this.deleteConversation(a),delete s[r],await this.storage.update({tabConversationMap:s})),this.tabActiveConversationMap[r]&&(delete this.tabActiveConversationMap[r],await this.saveTabActiveConversationMap(),await this.emitActiveConversationCountChange())}async createConversation(r,s,a){let p=`conv:${Z.genId()}`;if(Vn.log("on create conversation",p),r){let C=await this.storage.get("tabConversationMap");C[r]=p,await this.storage.update({tabConversationMap:C})}let g={id:p,items:this.createWelcomeItems(p),createdAt:Date.now(),tabInfo:r?{id:r,title:s,url:a}:void 0};return this.conversations[p]=g,await this.saveConversations(),g}async retryQuestion(r,s){let{conversationId:a,questionId:p}=r,g=await this.getConversation(a),C=g?.items.find(x=>yi.isQuestion(x)&&x.itemId===p)||null;if(!C)throw"QUESTION_NOT_FOUND";return g.items=g.items.filter(x=>!(x===C||yi.isReply(x)&&x.data.questionId===p)),this.askQuestion({content:C.data.content,conversationId:C.conversationId,tabInfo:r.tabInfo,questionId:p},s)}async askQuestion(r,s){if(!r.content.trim())throw"MESSAGE_IS_EMPTY";let a=this.createQuestion(r.conversationId,r.content);r.questionId&&(a.itemId=r.questionId);let{taskId:p}=await this.doAskQuestion(a,r.tabInfo,s);return{taskId:p,question:a}}async continueQuickActionInConversation(r){let{conversationId:s,promptContent:a,result:p,selectedText:g}=r,C=await this.getConversation(s);if(!C)throw"CONVERSATION_NOT_FOUND";let x=await this.createIntentCandidate({conversationId:s,type:"selection",content:g}),T=this.createQuestion(x.conversationId,a);T.data.intentId=x.itemId;let D=this.createReply(s,p),$=[x,...x.data.replies,T,D];return C.items.push(...$),await this.saveConversations(),$}async getActiveConversations(){let r=[],s=Z.getProductName(),a=Z.getChatTabUrl(),p=Z.getProductFavicon();for(let g in this.tabActiveConversationMap){let C=await Z.tryGetTab(g);if(!C)continue;let x=await this.getConversation(this.tabActiveConversationMap[g]);r.push({conversationId:x.id,createdAt:x.createdAt,tabInfo:{id:parseInt(g),title:C.title||x.tabInfo?.title||s,url:C.url||x.tabInfo?.url||a,favicon:C.favIconUrl||p},lastMessage:x.items.filter(T=>T.itemType==="reply").pop()?.summary||"",title:x.title||""})}return r.sort((g,C)=>C.createdAt-g.createdAt)}async switchToActiveConversation(r,s){if(!this.conversations[s])throw"CONVERSATION_NOT_FOUND";await yc.default.tabs.update(r,{active:!0}),this.events.emit("activateConversation",{conversationId:s})}async markConversationActive(r,s,a){a?this.tabActiveConversationMap[r]=s:this.tabActiveConversationMap[r]===s&&delete this.tabActiveConversationMap[r],await this.saveTabActiveConversationMap(),this.emitActiveConversationCountChange()}async fetchConversationList(r){let s=await ge.taskApi.getConversationList(r);return s.conversationList.itemList.forEach(a=>{let p=this.conversations[a.conversationId];p&&(p.title=a.title)}),this.saveConversations(),s}async generateReadEnhanceIndex(r){let{conversationId:s,tabInfo:a}=r;try{return ge.taskApi.generateReadEnhanceIndex({content:r.content,fullContent:r.fullContent,conversationId:r.conversationId,title:r.title,url:r.url,chatItems:await this.getNewItemsForSync(s),origin:a.url,originPageTitle:a.title})}catch(p){throw p instanceof ge.allExceptions["task.exceptions.ReadingQuotaExceededError"]?"READING_QUOTA_EXCEEDED":p}}async getReadEnhanceStatus(r){let s=await this.getConversation(r);if(!s)throw"CONVERSATION_NOT_FOUND";let a=await ge.taskApi.readEnhanceIndexStatus({conversationId:r}),p=null;return a.status==="indexed"&&a.reply&&(p={conversationId:r,itemId:a.reply.itemId,itemType:"reply",data:a.reply.data,summary:a.reply.summary,synced:!0},s.items.push(p),this.saveConversations(),Qe.getVipStatus()),{status:a.status,progressPercentage:a.progressPercentage,reply:p||void 0}}async updateConversationTitle(r,s){await ge.taskApi.updateConversation({conversationId:r,title:s}),this.conversations[r]&&(this.conversations[r].title=s,this.saveConversations())}clearConversationCache(){this.conversations={},this.tabActiveConversationMap={}}async saveTabActiveConversationMap(){await this.storage.update({tabActiveConversationMap:this.tabActiveConversationMap})}async doAskQuestion(r,s,a){let p=this.genTaskId(),g=r.conversationId,C=this.createReply(g,""),x=T=>{Vn.error(T);let D=`${T}`;a(this.createErrorReply(C,D),!0,D)};try{await this.addChatItem(r);let T="";C.data.questionId=r.itemId;let D=!1,$=await this.getNewItemsForSync(g);this.createGenerationTask({language:"auto",taskData:{taskType:"chat",data:{conversationId:g,items:$,preGeneratedReplyId:C.itemId,origin:s.url,originPageTitle:s.title.trim().slice(0,120)}},taskInfo:{taskId:p,conversationId:g,abortController:new AbortController},onData:O=>{if(T+=O.text||"",C.data.content=T,C.summary=C.data.content,O.sources&&(C.data.sources=O.sources),O.error){a(this.createErrorReply(C,O.error),!0,O.error);return}a(C,O.finished),O.finished&&(D=!0,Vn.debug("reply finished successfully",C),$.forEach(y=>y.synced=!0),this.addChatItem(C))},onAbort:()=>{!D&&C.data.content.trim()&&(Vn.debug("aborted, save partial message",C),$.forEach(O=>O.synced=!0),this.addChatItem(C))}}).catch(x)}catch(T){x(T)}return{taskId:p}}async getNewItemsForSync(r){return(await this.getConversation(r)).items.filter(a=>!a.synced)}createErrorReply(r,s){let a=(0,bi.clone)(r);return a.data.type="error",a.summary=s,a.data.content=s,a}createQuestion(r,s){return{conversationId:r,itemId:`msg:${Z.genId()}`,itemType:"question",summary:s,data:{type:"text",content:s}}}async createIntentCandidate(r){let s=`intent:${Z.genId()}`,a="What would you like to do with the text?",p={itemId:s,itemType:"intent",conversationId:r.conversationId,summary:r.content,data:{type:r.type,content:r.content,replies:[this.createReply(r.conversationId,a)]}};return p.data.replies.forEach(g=>g.data.intentId=s),p}async triggerIntentAction(r,s){let{actionId:a,customQuestion:p,intent:g}=r,C;if(a){let y=(await Qe.getCustomPrompts("selection_action",{autoUpdate:!1})).find(v=>v.id===a);if(!y)throw"INTENT_ACTION_NOT_FOUND";C=y.content}else{if(!p)throw"INTENT_ACTION_REQUIRED";C=p}(await this.getConversation(g.conversationId)).items.push(g,...g.data.replies);let T=this.createQuestion(g.conversationId,C);T.data.intentId=g.itemId;let D=[g,...g.data.replies,T],{taskId:$}=await this.doAskQuestion(T,r.tabInfo,s);return{newItems:D,question:T,taskId:$}}async deleteConversation(r){this.findAndCancelTasks(s=>s.conversationId===r),delete this.conversations[r],await this.saveConversations()}async feedback(r){return ge.taskApi.feedbackGenResult(r)}async shareConversation(r){return ge.taskApi.shareConversation(r)}async getConversations(){return this.initReady?this.conversations:new Promise(r=>{this.events.once("initReady",()=>{r(this.conversations)})})}async getChatItemList(r){return await ge.taskApi.getChatItemList(r)}createConversationTitle(r){let s=this.genTaskId(),a="";return this.createGenerationTask({language:"auto",taskData:{taskType:"gen_title",data:{conversationId:r}},taskInfo:{taskId:s,conversationId:r,abortController:new AbortController},onData:p=>{if(a+=p.text||"",p.finished){let g=this.conversations[r];g&&(g.title=a,this.saveConversations())}},onAbort:()=>{}}).catch(p=>{Vn.error(p)}),{taskId:s}}async saveConversations(){return this.storage.update({conversations:this.conversations})}async addChatItem(r){let s=r.conversationId;(await this.getConversation(s)).items.push(r),await this.saveConversations()}createWelcomeItems(r){let s=[this.createGuide(r,"\u{1F914} Ask complex questions","How do I make an HTTP request in Javascript?"),this.createGuide(r,"\u{1F44F} Get amazing inspiration","Come up with 5 brand names and slogans for a Pizza restaurant.")],a=this.createReply(r,"Welcome back! What would you like to chat about?");return a.data.suggestions=(0,bi.shuffle)(["Write a poem about the color blue.","Write a headline for a newspaper article about the climate crisis.","How to deal with a difficult boss?","How do I make an HTTP request in Javascript?","How to make a good cup of coffee?","Highest mountain in the world","What are large language models?",'Translate "Today is a good day" into French.',"Come up with 5 brand names and slogans for a Pizza restaurant."]).slice(0,3).map(p=>({text:p})).sort((p,g)=>g.text.length-p.text.length),[...s,a]}createReply(r,s){return{itemId:`msg:${Z.genId()}`,conversationId:r,itemType:"reply",summary:s,data:{type:"text",content:s,questionId:null}}}createGuide(r,s,a){return{itemId:`guide:${Z.genId()}`,conversationId:r,itemType:"guide",summary:s,synced:!0,data:{title:s,content:a}}}async removeOutdatedConversations(){let r=!1;for(let p of Object.keys(this.tabActiveConversationMap))if(!await Z.tryGetTab(p)){r=!0;let C=this.tabActiveConversationMap[p];delete this.tabActiveConversationMap[p],delete this.conversations[C]}await this.saveTabActiveConversationMap(),r&&this.emitActiveConversationCountChange();let s=await this.storage.get("tabConversationMap")||{};for(let p of Object.keys(s))if(!await Z.tryGetTab(p)){let C=s[p];delete s[p],delete this.conversations[C]}await this.storage.update({tabConversationMap:s});let a=Date.now();for(let p of Object.keys(this.conversations)){let{createdAt:g=0}=this.conversations[p];if(a-g>kv){if(this.findConvInMap(p,this.tabActiveConversationMap)||this.findConvInMap(p,s))continue;delete this.conversations[p]}}await this.saveConversations()}findConvInMap(r,s){for(let a of Object.keys(s))if(s[a]===r)return a;return null}async getConversation(r){let s=this.conversations[r];if(s)return s;try{let{chatItemList:a,conversation:p}=await this.getChatItemList({conversationId:r});return this.conversations[r]={id:r,items:a.itemList.map(g=>({...g,synced:!0})),title:p.title,createdAt:p.createdAt},this.saveConversations(),this.conversations[r]}catch(a){throw Vn.error(a),"CONVERSATION_NOT_FOUND"}}async emitActiveConversationCountChange(){let r=await this.getActiveConversations();this.events.emit("activeConversationChange",{count:r.length,conversationList:r})}};var cb=b(I(),1);var rb=b(I(),1),go={length:[{key:"auto",name:"Auto"},{key:"short",name:"Short"},{key:"medium",name:"Medium"},{key:"long",name:"Long"}],format:[{key:"text",name:"Auto",quantity:"some"},{name:"Email",key:"email",quantity:"an"},{key:"message",name:"Message",quantity:"a"},{key:"comment",name:"Comment",quantity:"a"},{key:"paragraph",name:"Paragraph",quantity:"a"},{key:"article",name:"Article",quantity:"an"},{key:"blog post",name:"Blog Post",quantity:"a"},{key:"ideas",name:"Ideas",quantity:"few"},{key:"outline",name:"Outline",quantity:"an"},{key:"twitter",name:"Twitter",quantity:"a"}],tone:[{key:"auto",name:"Auto"},{key:"amicable",name:"Amicable"},{key:"casual",name:"Casual"},{key:"friendly",name:"Friendly"},{key:"professional",name:"Professional"},{key:"witty",name:"Witty"},{key:"funny",name:"Funny"},{key:"formal",name:"Formal"}],language:[{key:"auto",name:"Auto"}]};var xi=class extends ln{async init(){}async onTabUnload(r){this.findAndCancelTasks(s=>s.tabId===r)}async compose(r,s,a){let p=this.genTaskId();return console.log(s,a),this.createGenerationTask({language:s.language.key,taskData:{taskType:"compose",data:{command:s.command,tone:s.tone.key,format:s.format.key,length:s.length.key}},taskInfo:{taskId:p,tabId:r,abortController:new AbortController},onData:({text:g,finished:C,error:x})=>{a(g,C,x)},onAbort:()=>{console.log("generation aborted")}}).catch(g=>{console.error(g);let C=`${g}`;a(null,!0,C)}),{taskId:p}}composeWithTemplate(r,s,a){let p=this.genTaskId();return this.createGenerationTask({language:"auto",taskData:{taskType:"compose_with_template",data:{count:1,...s}},taskInfo:{taskId:p,tabId:r,abortController:new AbortController},onData:({text:g,finished:C,error:x})=>{a(g,C,x)},onAbort:()=>{console.log("generation aborted")}}).catch(g=>{console.error(g);let C=`${g}`;a(null,!0,C)}),{taskId:p}}async getComposeOptions(){let r=await Qe.getUserInfo({autoUpdate:!1}),s=["English"],a=r?.languagePreferences||s;return{...go,language:[...go.language,...a.filter(p=>p.toLowerCase()!=="auto").map(p=>({key:p,name:p}))]}}};var fb=b(I(),1);var Ti=class extends ln{async init(){}triggerSelectionQuickAction(r,s,a){let p=this.genTaskId();return this.createGenerationTask({language:"auto",taskData:{taskType:"quick_action",data:{actionType:"selection",actionPrompt:s.promptContent,reference:s.selectedText}},taskInfo:{taskId:p,tabId:r,abortController:new AbortController},onData:({text:g,finished:C,error:x})=>{a(g,C,x)},onAbort:()=>{console.log("quick action aborted")}}).catch(g=>{console.error(g);let C=`${g}`;a(null,!0,C)}),{taskId:p}}async onTabUnload(r){this.findAndCancelTasks(s=>s.tabId===r)}};var Kt=class extends Ke{storagePrefix="ai";defaultStorageValues={templateList:[],tabConversationMap:{},tabActiveConversationMap:{},conversations:{}};context;chatProvider;composeProvider;quickActionProvider;onInit(){this.context={apiHost:gr,storage:this.storage,service:this},this.chatProvider=new _i(this.context),this.composeProvider=new xi(this.context),this.quickActionProvider=new Ti(this.context),this.chatProvider.events.on("activeConversationChange",r=>{this.emit("activeConversationChange",r)}),this.chatProvider.events.on("activateConversation",r=>{this.emit("activateConversation",r)}),ho.default.tabs.onRemoved.addListener(async r=>{this.chatProvider.onTabUnload(r),this.composeProvider.onTabUnload(r)}),ho.default.storage.local.onChanged.addListener(r=>{let s=r[this.storage.encodeKey("templateList")];s?.newValue&&this.emit("templateListChange",{templateList:s.newValue})})}async onContentAppCreated(){if(this.lastCaller?.tabId){let{tabId:r}=this.lastCaller;this.chatProvider.onTabUnload(r),this.composeProvider.onTabUnload(r),me.currentProject==="c4g"&&Ci.onTabUnload(r)}}async createConversation(r,s){return this.chatProvider.createConversation(this.lastCaller?.tabId,r,s)}async switchToActiveConversation(r,s){await this.chatProvider.switchToActiveConversation(r,s)}async deleteConversation(r){return this.chatProvider.deleteConversation(r)}async retryQuestion(r,s){return this.chatProvider.retryQuestion(r,s)}async askQuestion(r,s){return this.chatProvider.askQuestion(r,s)}async createConversationTitle(r){return this.chatProvider.createConversationTitle(r)}async triggerIntentAction(r,s){return this.chatProvider.triggerIntentAction(r,s)}async triggerSelectionQuickAction(r,s){return this.quickActionProvider.triggerSelectionQuickAction(this.lastCaller?.tabId,r,s)}async continueQuickActionInConversation(r){return this.chatProvider.continueQuickActionInConversation(r)}async cancelTask(r,s="chat"){return s==="quickAction"?this.quickActionProvider.cancelTask(r):s==="compose"?this.composeProvider.cancelTask(r):this.chatProvider.cancelTask(r)}async createIntentCandidate(r){return this.chatProvider.createIntentCandidate(r)}async chatFeedback(r){return this.chatProvider.feedback(r)}async shareConversation(r){return this.chatProvider.shareConversation(r)}async generateReadEnhanceIndex(r){return this.chatProvider.generateReadEnhanceIndex(r)}async cancelGenerateReadEnhanceIndex(r){return ge.taskApi.cancelGenerateReadEnhanceIndex(r)}async compose(r,s){return this.composeProvider.compose(this.lastCaller?.tabId,r,s)}async composeWithTemplate(r,s){return this.composeProvider.composeWithTemplate(this.lastCaller?.tabId,r,s)}async getComposeTemplates(r=!0){return this._fetchWithCache("templateList",async()=>(await ge.taskApi.getTemplateList()).templateList,{useCache:r})}async getComposeOptions(){return this.composeProvider.getComposeOptions()}async fetchConversationList(r){return this.chatProvider.fetchConversationList(r)}async getConversationInfo(r){return await ge.taskApi.getConversationInfo({conversationId:r})}async getReadEnhanceStatus(r){return this.chatProvider.getReadEnhanceStatus(r)}async getActiveConversationList(){return await this.chatProvider.getActiveConversations()}async getActiveConversationCount(){return(await this.chatProvider.getActiveConversations()).length}async searchConversation(r){return await ge.taskApi.searchConversation(r)}async removeConversationHistory(r){return await ge.taskApi.delConversation(r)}async updateConversationTitle(r,s){return await this.chatProvider.updateConversationTitle(r,s)}async getChatItemList(r){return this.chatProvider.getChatItemList(r)}async markConversationActive(r,s){let a=this.lastCaller?.tabId;a&&await this.chatProvider.markConversationActive(a,r,s)}async clearConversationCache(){return this.chatProvider.clearConversationCache()}};nt(Kt,"serviceName","MonicaService");var Sb=b(I(),1);var Ab=b(I(),1);var mo=new Ve(Kt.serviceName,Kt);var Hb=b(I(),1);var qb=b(I(),1);var _c=b(rt(),1);var Qt=class extends Ke{storagePrefix="request";defaultStorageValues={notificationData:null};onInit(){_c.default.storage.local.onChanged.addListener(r=>{let s=r[this.storage.encodeKey("notificationData")];s?.newValue&&this.emit("notificationDataChange",s.newValue)})}async getSubscriptionPlans(){return ge.vipApi.getSubscriptionPlans()}async createSubscriptionCheckout(r){return ge.vipApi.createSubscriptionCheckout(r)}async getNotificationData(r,s){return this._fetchWithCache("notificationData",async()=>(await ge.notificationApi.list(r)).data,s)}async readNotification(r){return ge.notificationApi.read(r)}async readAllNotification(r){return ge.notificationApi.readAll(r)}};nt(Qt,"serviceName","RequestService");var Fb=b(I(),1);var mr=new Ve(Qt.serviceName,Qt);var sx=b(I(),1);var ex=b(I(),1);var bc=15*60*1e3,zt=class extends Ke{storagePrefix="sync";defaultStorageValues={lastSyncTime:0};nextCheckTimeout=null;onInit(){this.checkSync()}async checkSync(){let r=await this.storage.get("lastSyncTime");(!r||Date.now()-r>bc)&&this.sync(),this.nextCheckTimeout||(this.nextCheckTimeout=setTimeout(()=>{this.checkSync()},bc))}async sync(){if(this.storage.set("lastSyncTime",Date.now()),me.currentProject==="c4g"&&!await Ee.get("permissionGranted"))return;let r=await Qe.getUserInfo({useCache:!1});r&&(Qe.getVipStatus({useCache:!1}),Qe.getCustomPrompts("my_prompt"),Qe.getCustomPrompts("selection_action"),mr.getNotificationData({userCreatedAt:r.createdAt}))}};nt(zt,"serviceName","syncService");var vo=new Ve(zt.serviceName,zt);var Te=b(rt(),1),ze=Oe.getLogger("BackgroundApp");me.markIsBackground();var Co=class{services;constructor(){me.currentProject==="monica"?this.services={[Ht.serviceName]:Ee,[Kt.serviceName]:mo,[Vt.serviceName]:Qe,[zt.serviceName]:vo,[Qt.serviceName]:mr}:this.services={[Ht.serviceName]:Ee,[Kt.serviceName]:mo,[Vt.serviceName]:Qe,[zt.serviceName]:vo,[cn.serviceName]:Ci,[un.serviceName]:lc,[Qt.serviceName]:mr},this.connectToDevServer(),this.init(),this.addDebugTools()}init(){ze.log("init background",new Date);for(let r of Object.keys(this.services))ze.debug("init service",r),this.services[r]._initService(r);Te.default.runtime.onStartup.addListener(()=>{ze.log("on startup")}),Te.default.runtime.onSuspend.addListener(()=>{ze.log("on suspend")}),Te.default.runtime.onSuspendCanceled.addListener(()=>{ze.log("on suspend canceled")}),Te.default.runtime.onInstalled.addListener(r=>{ze.log("on install hook executed"),r.reason==="install"&&(ze.log("extension first install"),this.onFirstInstall(),Ee.set("installTime",Date.now())),me.isProd&&me.currentProject==="monica"&&Te.default.tabs.query({}).then(s=>{s.forEach(a=>{a.id&&Te.default.scripting.executeScript({files:["content.js"],target:{tabId:a.id}}).catch(()=>{})})}),ze.log("extension installed or updated")}),Te.default.commands.onCommand.addListener((r,s)=>{s?.id&&He.sendToContent(s.id,"command",{command:r})}),Te.default.runtime.onMessage.addListener((r,s)=>{let{tab:a,url:p}=s;if(r.type==="callServiceMethod"){let{serviceName:g,methodName:C,finalArgs:x}=r.data,T=`${g}.${C}`;ze.debug(`[RemoteServiceCall] ${T}`,{msgId:r.id,finalArgs:x,senderTab:s?.tab?.id});let D={type:p?.startsWith("http")||p?.startsWith("file")?"tab":"popup",tabId:a?.id,url:p};return this.services[g]._onCallMethod(D,C,x).then(O=>(ze.debug(`- ${T} success`,{msgId:r.id,data:O}),O)).catch(O=>{throw ze.error(`- ${T} error:`,{msgId:r.id,error:O}),O})}return ze.debug("background on message",r,{senderTab:s?.tab?.id}),Promise.resolve()}),Te.default.runtime.setUninstallURL(`${Z.getWebOrigin()}/uninstall-success`),me.currentProject==="monica"&&Te.default.action.onClicked.addListener(r=>{r.id&&He.sendToContent(r.id,"runMonica",{})}),me.currentProject==="c4g"&&(cc.checkAndRegisterContentScripts(),Te.default.scripting.registerContentScripts([{id:"ChatGptIframeChecker",js:["iframeChecker.js"],matches:["https://chat.openai.com/chat"],allFrames:!0,runAt:"document_start"},{id:"ChatGptShare",js:["chatGptShare.js"],css:["chatGptShare.css"],matches:["https://chat.openai.com/chat/*"],runAt:"document_end"}]))}addDebugTools(){let r=Oe.console;globalThis.debugTools={showStorage:async()=>{let s=await Te.default.storage.local.get();r.log(s)},clearStorage:async()=>{await this.services.MonicaService.clearConversationCache(),await Te.default.storage.local.clear(),r.log("success")},clearChatGptToken:async()=>{await this.services.ChatService.clearChatGptToken(),r.log("done")},enableAllLogs(){Oe.enableAllLoggers()},enableBeta:async()=>{let s=await Te.default.storage.local.get("user.clientId");if(s){let a=`${s["user.clientId"].slice(0,-1)}1`;await Te.default.storage.local.set({"user.clientId":a,"user.userBatch":1})}}}}onFirstInstall(){if(me.currentProject==="monica"){let r=()=>{Te.default.tabs.create({url:`${Z.getWebOrigin()}/login?from=extension_install`})},s=()=>{Te.default.tabs.create({url:`${Z.getWebOrigin()}/welcome?from=extension_reinstall`})};Qe.getUserInfo({useCache:!1}).then(a=>{a||r()}).catch(a=>{ze.error("init user info when install got error",a),r()})}me.currentProject==="c4g"&&this.services.UserService.setUserBatch(1).finally(()=>{Te.default.tabs.create({url:`${Z.getWebOrigin()}/first-install?extId=${Te.default.runtime.id}`})})}connectToDevServer(){if(me.isProd)return;let r="monica:dev:reload",s=["figma.com","modao.cc"];Te.default.storage.local.get().then(p=>{p?.[r]&&(Te.default.tabs.query({active:!0,currentWindow:!0}).then(g=>{g.forEach(C=>{if(C.id){if(s.some(x=>C.url?.includes(x)))return;ze.log("reload tab",C.id),Te.default.tabs.reload(C.id)}})}),Te.default.storage.local.set({[r]:!1}))});let a=new WebSocket("ws://localhost:8085");a.onopen=()=>{ze.log("dev server connected")},a.onmessage=p=>{ze.log("dev server message",p.data),p.data==="reload"&&Te.default.storage.local.set({[r]:!0}).then(()=>{Te.default.runtime.reload()})}}};new Co;})();
/*! Bundled license information:

lodash/lodash.js:
  (**
   * @license
   * Lodash <https://lodash.com/>
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)
*/
